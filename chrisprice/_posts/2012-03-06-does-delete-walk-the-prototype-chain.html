---
author: Chris Price
tags: 
permalink: /2012/03/does-delete-walk-the-prototype-chain/index.html
layout: blog
---
<div class="entry"><p><a style="float: right; margin-left: 16px;" href="http://www.scottlogic.co.uk/blog/chris/"><img style="border: 1px solid black;" src="http://www.scottlogic.co.uk/wp-content/uploads/2012/03/me1.png" alt="" title="Chris Price" class="aligncenter size-full wp-image-145833" /></a><em>This is a quick post relating to a Rhino bug I’ve just fallen foul of. This probably isn’t very interesting for most folk, but if you’ve come here from Google then hopefully I can help you out!</em></p><p style="clear: both;">Let’s start with a <a href="https://developer.mozilla.org/en/JavaScript/Reference/Operators/delete">definition</a> (from the excellent MDN) of how the delete operator should behave in relation to properties found on the prototype</p><blockquote><p>“You cannot delete a property on an object that it inherits from a prototype (although you can delete it directly on the prototype).”</p></blockquote><p>It even goes on to give an example -</p><div class="wp_syntax"><div class="code"><pre class="javascript" style="font-family: monospace;"><span style="color: #003366; font-weight: bold;">function</span> Foo<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span><span style="color: #009900;">}</span>
Foo.<span style="color: #660066;">prototype</span>.<span style="color: #660066;">bar</span> <span style="color: #339933;">=</span> <span style="color: #CC0000;">42</span><span style="color: #339933;">;</span>
<span style="color: #003366; font-weight: bold;">var</span> foo <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">new</span> Foo<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
<span style="color: #000066; font-weight: bold;">delete</span> foo.<span style="color: #660066;">bar</span><span style="color: #339933;">;</span> <span style="color: #006600; font-style: italic;">// but doesn't do anything</span>
<span style="color: #000066;">alert</span><span style="color: #009900;">(</span>foo.<span style="color: #660066;">bar</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span> <span style="color: #006600; font-style: italic;">// alerts 42, property inherited</span>
<span style="color: #000066; font-weight: bold;">delete</span> Foo.<span style="color: #660066;">prototype</span>.<span style="color: #660066;">bar</span><span style="color: #339933;">;</span> <span style="color: #006600; font-style: italic;">// deletes property on prototype</span>
<span style="color: #000066;">alert</span><span style="color: #009900;">(</span>foo.<span style="color: #660066;">bar</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span> <span style="color: #006600; font-style: italic;">// alerts "undefined", property no longer inherited</span></pre></div></div><p>Unfortunately, after lots of head scratching, it turns out this is not how things work in Rhino (&lt;=1.7R2). The above code, modified to print rather than alert, prints “undefined”, “undefined”. Rhino is walking the prototype chain to find the property and then deleting it from the prototype. This is because of the following bug <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=510504">Bug 510504 – delete foo.prop should not walk the property chain to find prop</a>.</p><p>The bug was fixed and released in 1.7R3 which can be found at a slightly different location from 1.7R2 -</p><div class="wp_syntax"><div class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;dependency<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
	<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;groupId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>org.mozilla<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/groupId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
	<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;artifactId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>rhino<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/artifactId<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
	<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;version<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>1.7R3<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/version<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/dependency<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></div></div><p>Upgrading to that version prints “42″, “undefined” – success!</p></div>