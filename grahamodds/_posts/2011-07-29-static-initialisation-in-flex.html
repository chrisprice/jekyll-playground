---
author: Graham Odds
tags: Flash, Flex
permalink: /blog/graham/2011/07/static-initialisation-in-flex/index.html
layout: blog
---
<div class="entry"><div class="topsy_widget_data topsy_theme_blue" style="float: right; margin-left: 0.75em; background: url(data:,%7B%20%22url%22%3A%20%22http%253A%252F%252Fwww.scottlogic.co.uk%252Fblog%252Fgraham%252F2011%252F07%252Fstatic-initialisation-in-flex%252F%22%2C%20%22shorturl%22%3A%20%22http%3A%2F%2Fbit.ly%2FoOquvg%22%2C%20%22style%22%3A%20%22big%22%2C%20%22title%22%3A%20%22Static%20Initialisation%20in%20Flex%22%20%7D);"></div><p>For reasons best ignored I recently investigated the different ways in which static initialisation code can be run in Flex.  As well as a direct equivalent to the static initialiser blocks available in <a href="http://java.sun.com/docs/books/jls/third_edition/html/classes.html#39245" target="_blank">Java</a> and <a href="http://msdn.microsoft.com/en-us/library/aa645612(v=vs.71).aspx" target="_blank">C#</a>, Flex has a couple of subtle variants that can prove useful in different circumstances.</p><p>First up, the “standard” static initialisation technique, the direct equivalent to that found in <a href="http://java.sun.com/docs/books/jls/third_edition/html/classes.html#39245" target="_blank">Java</a> and <a href="http://msdn.microsoft.com/en-us/library/aa645612(v=vs.71).aspx" target="_blank">C#</a>.  The block of code shown below will execute once, the first time an instance of <code>MyClass</code> is created before that first constructor call is executed.</p><div class="wp_syntax"><table><tr><td class="code"><pre class="actionscript" style="font-family: monospace;"><span style="color: #0066CC;">public</span> <span style="color: #000000; font-weight: bold;">class</span> MyClass
<span style="color: #66cc66;">{</span>
    <span style="color: #0066CC;">private</span> <span style="color: #0066CC;">static</span> <span style="color: #000000; font-weight: bold;">var</span> initialised:<span style="color: #0066CC;">Boolean</span> = initialise<span style="color: #66cc66;">(</span><span style="color: #66cc66;">)</span>;
    <span style="color: #0066CC;">private</span> <span style="color: #0066CC;">static</span> <span style="color: #000000; font-weight: bold;">function</span> initialise<span style="color: #66cc66;">(</span><span style="color: #66cc66;">)</span>:<span style="color: #0066CC;">Boolean</span>
    <span style="color: #66cc66;">{</span>
        <span style="color: #0066CC;">trace</span><span style="color: #66cc66;">(</span><span style="color: #ff0000;">"static initialisation block that will execute"</span> +
              <span style="color: #ff0000;">" the first time 'new MyClass()' is called anywhere"</span><span style="color: #66cc66;">)</span>;
    <span style="color: #66cc66;">}</span>
<span style="color: #66cc66;">}</span></pre></td></tr></table></div><p>If the intention of your code block is to create and initialise a static variable then this approach is clear and obvious.  However, if you want to run some general initialisation code you still require a dummy variable and a return type on the static function.  This is because the variable initialisation is the hook required to execute the function.  This technique was used throughout the Flex 3 Framework code for style initialisation on components (an approach no longer in Flex 4 because of the <a href="{{ site.url }}/blog/graham/2011/04/updating-flex-sparkline-to-flex-4/ target=_" blank="blank">improvements to style initialisation</a>).</p><p>The second technique is that used by the <a href="http://help.adobe.com/en_US/flex/using/WS2db454920e96a9e51e63e3d11c0bf69084-7ec5.html" target="_blank">Automation framework</a> that is included with the SDK.  This approach allows code to be executed when an application or module is loaded.  The code would look as follows:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="actionscript" style="font-family: monospace;"><span style="color: #66cc66;">[</span>Mixin<span style="color: #66cc66;">]</span>
<span style="color: #0066CC;">public</span> <span style="color: #000000; font-weight: bold;">class</span> MyClass
<span style="color: #66cc66;">{</span>
    <span style="color: #0066CC;">public</span> <span style="color: #0066CC;">static</span> <span style="color: #000000; font-weight: bold;">function</span> init<span style="color: #66cc66;">(</span>root:DisplayObject<span style="color: #66cc66;">)</span>:<span style="color: #0066CC;">void</span>
    <span style="color: #66cc66;">{</span>
        <span style="color: #0066CC;">trace</span><span style="color: #66cc66;">(</span><span style="color: #ff0000;">"static initialisation block that will execute"</span> +
              <span style="color: #ff0000;">" when the application or module first loads"</span><span style="color: #66cc66;">)</span>;
    <span style="color: #66cc66;">}</span>
<span style="color: #66cc66;">}</span></pre></td></tr></table></div><p>The <code>root</code> argument will be an <a href="http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/mx/managers/ISystemManager.html" target="_blank">ISystemManager</a> or <a href="http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/mx/core/IFlexModuleFactory.html" target="_blank">IFlexModuleFactory</a> instance depending on whether the class was loaded as part of an application or module.  Note that for the <code>[Mixin]</code> to be picked up the class must be included in the application or module, i.e. it must be referenced elsewhere in code or explicitly added using appropriate compiler arguments</p><p>The final technique comes from <a href="http://en.wikipedia.org/wiki/ActionScript" target="_blank">ActionScript’s</a> <a href="http://en.wikipedia.org/wiki/ECMAScript" target="_blank">ECMAScript</a> heritage, in particular its <a href="http://en.wikipedia.org/wiki/Prototype-based_programming" target="_blank">prototype-based</a> object model.  In this case, code is written directly into the <code>class</code> scope, i.e. not inside a <code>function</code> block.  This code will be executed the first time the class is executed in any way.  That is, if the class uses the <code>[Mixin]</code> technique then it will execute along with the mix-ins <code>static init</code> function, otherwise it will be the equivalent to the “standard” approach and execute the first time the class is instantiated.</p><div class="wp_syntax"><table><tr><td class="code"><pre class="actionscript" style="font-family: monospace;"><span style="color: #0066CC;">public</span> <span style="color: #000000; font-weight: bold;">class</span> MyClass
<span style="color: #66cc66;">{</span>
    <span style="color: #0066CC;">trace</span><span style="color: #66cc66;">(</span><span style="color: #ff0000;">"static initialisation taking advantage of prototype-based object model"</span><span style="color: #66cc66;">)</span>;
<span style="color: #66cc66;">}</span></pre></td></tr></table></div><p><em>I know it looks odd, but it genuinely is valid!</em></p><p>So putting it all together in the most artificial of examples, the following class would produce the trace output 1, 2, 3, 4 (with 3 and 4 only appearing when an instance of the class is instantiated):</p><div class="wp_syntax"><table><tr><td class="code"><pre class="actionscript" style="font-family: monospace;"><span style="color: #66cc66;">[</span>Mixin<span style="color: #66cc66;">]</span>
<span style="color: #0066CC;">public</span> <span style="color: #000000; font-weight: bold;">function</span> MyClass
<span style="color: #66cc66;">{</span>
    <span style="color: #0066CC;">trace</span><span style="color: #66cc66;">(</span><span style="color: #ff0000;">"1"</span><span style="color: #66cc66;">)</span>;
&nbsp;
    <span style="color: #0066CC;">public</span> <span style="color: #0066CC;">static</span> <span style="color: #000000; font-weight: bold;">function</span> init<span style="color: #66cc66;">(</span>root:DisplayObject<span style="color: #66cc66;">)</span>:<span style="color: #0066CC;">void</span>
    <span style="color: #66cc66;">{</span>
        <span style="color: #0066CC;">trace</span><span style="color: #66cc66;">(</span><span style="color: #ff0000;">"2"</span><span style="color: #66cc66;">)</span>;
    <span style="color: #66cc66;">}</span>
&nbsp;
    <span style="color: #0066CC;">private</span> <span style="color: #000000; font-weight: bold;">var</span> initialised:<span style="color: #0066CC;">Boolean</span> = initialise<span style="color: #66cc66;">(</span><span style="color: #66cc66;">)</span>;
    <span style="color: #0066CC;">private</span> <span style="color: #000000; font-weight: bold;">function</span> initialise<span style="color: #66cc66;">(</span><span style="color: #66cc66;">)</span>:<span style="color: #0066CC;">Boolean</span>
    <span style="color: #66cc66;">{</span>
        <span style="color: #0066CC;">trace</span><span style="color: #66cc66;">(</span><span style="color: #ff0000;">"3"</span><span style="color: #66cc66;">)</span>;
    <span style="color: #66cc66;">}</span>
&nbsp;
    <span style="color: #0066CC;">public</span> <span style="color: #000000; font-weight: bold;">function</span> MyClass<span style="color: #66cc66;">(</span><span style="color: #66cc66;">)</span>
    <span style="color: #66cc66;">{</span>
        <span style="color: #0066CC;">trace</span><span style="color: #66cc66;">(</span><span style="color: #ff0000;">"4"</span><span style="color: #66cc66;">)</span>;
    <span style="color: #66cc66;">}</span>
<span style="color: #66cc66;">}</span></pre></td></tr></table></div></div>