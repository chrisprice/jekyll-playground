---
author: Graham Odds
tags: Charts, Flex
permalink: /blog/graham/2009/03/custom-data-tips-in-stacked-flex-charts/index.html
layout: blog
---
<div class="entry"><div class="topsy_widget_data topsy_theme_blue" style="float: right; margin-left: 0.75em; background: url(data:,%7B%20%22url%22%3A%20%22http%253A%252F%252Fwww.scottlogic.co.uk%252Fblog%252Fgraham%252F2009%252F03%252Fcustom-data-tips-in-stacked-flex-charts%252F%22%2C%20%22style%22%3A%20%22big%22%2C%20%22title%22%3A%20%22Custom%20data%20tips%20in%20stacked%20Flex%20charts%22%20%7D);"></div><p>The number of frustrating decisions in Flex’s charting API is minimal, but high up on my list is a strange decision that prevents developers from accessing information that is frequently desirable for custom data tips in stacked area, bar and column charts.  The default data tips for stacked charts display, amongst other things, the total of the values for all the series at a specific point along the x-axis and the percentage the highlighted segment forms of this total, as shown in the following example (<a href="{{ site.url }}/blog/graham/wp-content/uploads/2009/03/chartsettotals.zip">source code</a>):<br />

    <object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" id="stacked_default" width="400" height="300" align="center" name="stacked_default">
      <param name="movie" value="http://www.scottlogic.co.uk/blog/graham/wp-content/uploads/2009/03/chartsettotals.swf" />
      <param name="align" value="center" />
      <param name="name" value="stacked_default" />
      <!--[if !IE]>-->
      <object type="application/x-shockwave-flash" data="http://www.scottlogic.co.uk/blog/graham/wp-content/uploads/2009/03/chartsettotals.swf" width="400" height="300" align="center" name="stacked_default">
      <!--<![endif]-->
        
      <!--[if !IE]>-->
      </object>
      <!--<![endif]-->
    </object>
<br />
If you wanted to customise the data tips and still include information such as the total and percentage values then you would be out of luck.  This why I consider the decision to give the necessary information protected scope in the relevant classes in the charting API as strange.  Fortunately circumnavigating this issue only requires a little bit of dirty work…</p><p>But first, a brief diversion to provide a little background…<br />
The code used to create a stacked column chart generally takes the following form:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;mx:ColumnChart</span> <span style="color: #000066;">type</span>=<span style="color: #ff0000;">"stacked"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;mx:series<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;mx:ColumnSeries</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span>
        ...
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/mx:series<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/mx:ColumnChart<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>This is in fact a shortcut syntax.  The ColumnChart automatically wraps the array of series into a ColumnSet with type “stacked”, as it is the ColumnSet class that takes care of the stacking and associated behaviour rather than the ColumnChart class.  The same pattern occurs in stacked AreaChart or BarChart.  Consequently, the following MXML produces the same end result:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;mx:ColumnChart<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;mx:series<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;mx:ColumnSet</span> <span style="color: #000066;">type</span>=<span style="color: #ff0000;">"stacked"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;mx:ColumnSeries</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span>
            ...
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/mx:ColumnSet<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/mx:series<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/mx:ColumnChart<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>When wanting to create more complex combinations of stacking, clustering and overlaying in charts, this can only be achieved by explicitly introducing (and nesting) sets – as in the second code snippet.  For further details on this see Adobe’s <a href="http://livedocs.adobe.com/flex/3/html/help.html?content=charts_displayingdata_11.html" target="_blank">Stacking Charts</a> article.<br />
Diversion over…</p><p>To be able to display customised data tips that include information relating to the stacking in a stacked ColumnChart, BarChart or AreaChart we can take one of two approaches.  Both approaches involve extending the <a href="http://livedocs.adobe.com/flex/3/langref/mx/charts/series/ColumnSet.html" target="_blank">ColumnSet</a>, <a href="" target="_blank">BarSet</a> or <a href="" target="_blank">AreaSet</a> class (depending on the desired chart type) as it is the protected-scoped <a href="http://livedocs.adobe.com/flex/3/langref/mx/charts/chartClasses/StackedSeries.html#negTotalsByPrimaryAxis" target="_blank">negTotalsByPrimaryAxis</a>, <a href="http://livedocs.adobe.com/flex/3/langref/mx/charts/chartClasses/StackedSeries.html#posTotalsByPrimaryAxis" target="_blank">posTotalsByPrimaryAxis</a>, <a href="http://livedocs.adobe.com/flex/3/langref/mx/charts/chartClasses/StackedSeries.html#stackedMaximum" target="_blank">stackedMaximum</a> and <a href="http://livedocs.adobe.com/flex/3/langref/mx/charts/chartClasses/StackedSeries.html#stackedMinimum" target="_blank">stackedMinimum</a> properties that contain the interesting information.  The first approach is to override the <a href="http://livedocs.adobe.com/flex/3/langref/mx/charts/chartClasses/StackedSeries.html#formatDataTip()" target="_blank">formatDataTip</a> method in the extended class, resulting in something along the following lines:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="actionscript3" style="font-family: monospace;"><span style="color: #3f5fbf;">/**
 * ColumnSet extension to introduce custom data tips.
 */</span>
<span style="color: #0033ff; font-weight: bold;">public</span> <span style="color: #9900cc; font-weight: bold;">class</span> ColumnSet <span style="color: #0033ff; font-weight: bold;">extends</span> mx<span style="color: #000066; font-weight: bold;">.</span>charts<span style="color: #000066; font-weight: bold;">.</span>series<span style="color: #000066; font-weight: bold;">.</span>ColumnSet
<span style="color: #000000;">{</span>
    <span style="color: #3f5fbf;">/**
     * @inheritDoc
     */</span>
    <span style="color: #0033ff; font-weight: bold;">override</span> <span style="color: #0033ff; font-weight: bold;">protected</span> <span style="color: #339966; font-weight: bold;">function</span> formatDataTip<span style="color: #000000;">(</span>hd<span style="color: #000066; font-weight: bold;">:</span>HitData<span style="color: #000000;">)</span><span style="color: #000066; font-weight: bold;">:</span><span style="color: #004993;">String</span>
    <span style="color: #000000;">{</span>
        <span style="color: #009900; font-style: italic;">// build up the custom data tip</span>
        <span style="color: #6699cc; font-weight: bold;">var</span> tip<span style="color: #000066; font-weight: bold;">:</span><span style="color: #004993;">String</span> = <span style="color: #990000;">""</span><span style="color: #000066; font-weight: bold;">;</span>
        <span style="color: #000066; font-weight: bold;">...</span>
        <span style="color: #0033ff; font-weight: bold;">return</span> tip<span style="color: #000066; font-weight: bold;">;</span>
    <span style="color: #000000;">}</span>
<span style="color: #000000;">}</span></pre></td></tr></table></div><p>However, I think that this approach is slightly short-sighted because it means that for every customisation of the data tips you would create a new extension.  The other, and in my opinion more reusable, approach is to expose the aforementioned properties publicly in extensions to the <a href="http://livedocs.adobe.com/flex/3/langref/mx/charts/series/ColumnSet.html" target="_blank">ColumnSet</a>, <a href="" target="_blank">BarSet</a> and <a href="" target="_blank">AreaSet</a> classes.  By creating these extensions, the standard approach to customising data tips can be used, i.e. a method with the appropriate signature is passed to the chart’s <a href="http://livedocs.adobe.com/flex/3/langref/mx/charts/chartClasses/ChartBase.html#dataTipFunction" target="_blank">dataTipFunction</a> property.  The classes resulting from this approach would be something along the following lines:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="actionscript3" style="font-family: monospace;"><span style="color: #3f5fbf;">/**
 * ColumnSet extension to expose the stack totals for public 
 * use, e.g. in a data tip function.
 */</span>
<span style="color: #0033ff; font-weight: bold;">public</span> <span style="color: #9900cc; font-weight: bold;">class</span> ColumnSet <span style="color: #0033ff; font-weight: bold;">extends</span> mx<span style="color: #000066; font-weight: bold;">.</span>charts<span style="color: #000066; font-weight: bold;">.</span>series<span style="color: #000066; font-weight: bold;">.</span>ColumnSet
<span style="color: #000000;">{</span>        
    <span style="color: #3f5fbf;">/**
     * @see StackedSeries.posTotalsByPrimaryAxis
     */</span>
    <span style="color: #0033ff; font-weight: bold;">public</span> <span style="color: #339966; font-weight: bold;">function</span> <span style="color: #0033ff; font-weight: bold;">get</span> positiveTotalsByAxis<span style="color: #000000;">(</span><span style="color: #000000;">)</span><span style="color: #000066; font-weight: bold;">:</span><span style="color: #004993;">Dictionary</span>
    <span style="color: #000000;">{</span>
        <span style="color: #0033ff; font-weight: bold;">return</span> posTotalsByPrimaryAxis<span style="color: #000066; font-weight: bold;">;</span>
    <span style="color: #000000;">}</span>
&nbsp;
    <span style="color: #000066; font-weight: bold;">...</span>
<span style="color: #000000;">}</span></pre></td></tr></table></div><p>The minor downside to this approach is that the shortcut syntax for achieving stacked series, as used in the first example and explained above, cannot be used.  The explicit syntax must be used to ensure that the extended version of the relevant <a href="http://livedocs.adobe.com/flex/3/langref/mx/charts/chartClasses/StackedSeries.html" target="_blank">StackedSeries</a> extension is used.</p><p>The following example uses the approach presented above to provide customised data tips in the chart.  The <a href="{{ site.url }}/blog/graham/wp-content/uploads/2009/03/chartsettotals1.zip">source code</a> for the example includes the necessary extensions to the <a href="http://livedocs.adobe.com/flex/3/langref/mx/charts/series/ColumnSet.html" target="_blank">ColumnSet</a>, <a href="" target="_blank">BarSet</a> and <a href="" target="_blank">AreaSet</a> classes, so feel free to use them.<br />

    <object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" id="stacked_custom" width="400" height="300" align="center" name="stacked_custom">
      <param name="movie" value="http://www.scottlogic.co.uk/blog/graham/wp-content/uploads/2009/03/chartsettotalscustom.swf" />
      <param name="align" value="center" />
      <param name="name" value="stacked_custom" />
      <!--[if !IE]>-->
      <object type="application/x-shockwave-flash" data="http://www.scottlogic.co.uk/blog/graham/wp-content/uploads/2009/03/chartsettotalscustom.swf" width="400" height="300" align="center" name="stacked_custom">
      <!--<![endif]-->
        
      <!--[if !IE]>-->
      </object>
      <!--<![endif]-->
    </object>
 </p></div>