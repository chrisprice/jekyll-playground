---
author: Colin Eberhardt
tags: DataGrid, WPF
permalink: /blog/colin/2008/11/multiselect-datagrid-with-checkboxes/index.html
layout: colineberhardt-blog
---
<div class="entry"><div class="topsy_widget_data topsy_theme_light-green" style="float: right; margin-left: 0.75em; background: url(data:,%7B%20%22url%22%3A%20%22http%253A%252F%252Fwww.scottlogic.co.uk%252Fblog%252Fcolin%252F2008%252F11%252Fmultiselect-datagrid-with-checkboxes%252F%22%2C%20%22style%22%3A%20%22big%22%2C%20%22title%22%3A%20%22Multiselect%20DataGrid%20with%20CheckBoxes%20%23%22%20%7D);"></div><p>I am currently very interested in the new WPF DataGrid which was released on <a href="http://www.codeplex.com/wpf">codeplex</a> recently. Someone posted an interesting question in the <a href="http://www.codeplex.com/wpf/Thread/View.aspx">codeplex forums</a> asking about whether it would be possible to configure the DataGrid so that a user can make multiple row selections via checkboxes which are associated with each row. I thought that this sounded like an excellent idea – afterall, the standard behaviour of ctrl-leftclick might be intuitive to the computer savvy, however you can bet the average user (which is certainly the majority) does not know this.</p><p>Fortunately the solution is quite simple to implement in WPF:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;dg:DataGrid</span> <span style="color: #000066;">ItemsSource</span>=<span style="color: #ff0000;">"{Binding}"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;dg:DataGrid.RowHeaderTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;DataTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;CheckBox</span> <span style="color: #000066;">IsChecked</span>=<span style="color: #ff0000;">"{Binding Path=IsSelected, Mode=TwoWay,</span>
<span style="color: #009900;">                  RelativeSource={RelativeSource FindAncestor,</span>
<span style="color: #009900;">                  AncestorType={x:Type dg:DataGridRow}}}"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/DataTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/dg:DataGrid.RowHeaderTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/dg:DataGrid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>The above code provides a DataTemplate for the RowHeader allowing us to render a CheckBox for each row. The IsChecked property uses a RelativeSource binding which navigates the Visual Tree to locate the first ancestor of type DataGridRow. From here the IsSelected property which dictates that the selected state of the row is available. The binding is TwoWay so that ctrl-leftclick behaviour is still visible.</p><p>The result is illustrated below:</p><p><a href="http://wpfadventures.files.wordpress.com/2008/11/multiselect.png"><img class="alignnone size-full wp-image-8" title="multiselect" src="http://wpfadventures.files.wordpress.com/2008/11/multiselect.png" alt="multiselect" width="215" height="196" /></a></p><p>The above example is a concise illustration of the beauty of WPF. Performing the above customisation of the DataGridView in Windows Forms would be at least an afternoons work. However the solution is not without its problems, if you try the above you will find that the checkboxes are rather difficult to click on because the mouse cursor will be displaying the up-down arrow that indicates that it is currently over the gripper that allows you to specify the row height.</p><p>Finding the cause of this means delving deep into the DataGrid control templates …</p><p>The template for the DataGridRowHeader is given below (in edited form):</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Style</span> <span style="color: #000066;">x:Key</span>=<span style="color: #ff0000;">"{x:Type dgp:DataGridRowHeader}"</span></span>
<span style="color: #009900;">       <span style="color: #000066;">TargetType</span>=<span style="color: #ff0000;">"{x:Type dgp:DataGridRowHeader}"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Setter</span> <span style="color: #000066;">Property</span>=<span style="color: #ff0000;">"Template"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Setter.Value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ControlTemplate</span> <span style="color: #000066;">TargetType</span>=<span style="color: #ff0000;">"{x:Type dgp:DataGridRowHeader}"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
          ... snipped header content + validation error indicator ...
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Thumb</span> <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">"PART_TopHeaderGripper"</span></span>
<span style="color: #009900;">                 <span style="color: #000066;">VerticalAlignment</span>=<span style="color: #ff0000;">"Top"</span></span>
<span style="color: #009900;">                 <span style="color: #000066;">Style</span>=<span style="color: #ff0000;">"{StaticResource RowHeaderGripperStyle}"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Thumb</span> <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">"PART_BottomHeaderGripper"</span></span>
<span style="color: #009900;">                 <span style="color: #000066;">VerticalAlignment</span>=<span style="color: #ff0000;">"Bottom"</span></span>
<span style="color: #009900;">                 <span style="color: #000066;">Style</span>=<span style="color: #ff0000;">"{StaticResource RowHeaderGripperStyle}"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ControlTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Setter.Value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Setter<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Style<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>The header template includes a pair of grippers. The visible state of these is toggled depending on the row’s location (i.e. there is no top gripper on the first row), and whether the DataGrid CanResizeRows is true.</p><p>The RowHeaderGripperStyle specifies a Transparent background for the grippers which renders them invisible. If we change this to Green we can see the culprits:</p><p><a href="http://wpfadventures.files.wordpress.com/2008/11/datagridselectproblem.png"><img class="alignnone size-full wp-image-9" title="datagridselectproblem" src="http://wpfadventures.files.wordpress.com/2008/11/datagridselectproblem.png" alt="datagridselectproblem" width="214" height="210" /></a></p><p>In order to allow our Checkboxes to be clickable, we simply reduce the height of the grippers as follows:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Style</span> <span style="color: #000066;">x:Key</span>=<span style="color: #ff0000;">"RowHeaderGripperStyle"</span> <span style="color: #000066;">TargetType</span>=<span style="color: #ff0000;">"{x:Type Thumb}"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Setter</span> <span style="color: #000066;">Property</span>=<span style="color: #ff0000;">"Height"</span> <span style="color: #000066;">Value</span>=<span style="color: #ff0000;">"2"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Setter</span> <span style="color: #000066;">Property</span>=<span style="color: #ff0000;">"Background"</span> <span style="color: #000066;">Value</span>=<span style="color: #ff0000;">"Green"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Setter</span> <span style="color: #000066;">Property</span>=<span style="color: #ff0000;">"Cursor"</span> <span style="color: #000066;">Value</span>=<span style="color: #ff0000;">"SizeNS"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Setter</span> <span style="color: #000066;">Property</span>=<span style="color: #ff0000;">"Template"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Setter.Value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ControlTemplate</span> <span style="color: #000066;">TargetType</span>=<span style="color: #ff0000;">"{x:Type Thumb}"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Border</span> <span style="color: #000066;">Padding</span>=<span style="color: #ff0000;">"{TemplateBinding Padding}"</span></span>
<span style="color: #009900;">                <span style="color: #000066;">Background</span>=<span style="color: #ff0000;">"{TemplateBinding Background}"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ControlTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Setter.Value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Setter<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Style<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>Unfortunately this means that we have to duplicate the DataGrid parts; the DataGridRowHeader template and the above style, in order to perform this customisation. The Beauty of XAML and a Beast of a control template!</p><p>You can download the demo project, <a href="http://wpfadventures.files.wordpress.com/2008/11/wpfdatagridmultiselect.doc">wpfdatagridmultiselect</a>, changing the file extension from .doc to .zip.</p><p>Regards, Colin E.</p><p>P.S. You can achieve the same effect with a ListView as detailed in <a href="http://weblogs.asp.net/marianor/archive/2008/02/04/multiselect-listview-with-checkboxes-in-wpf.aspx">this blog post</a>.</p></div>