---
author: Colin Eberhardt
tags: charts, silverlight
permalink: /blog/colin/2009/02/adding-a-location-crosshair-to-silverlight-charts/index.html
layout: colineberhardt-blog
---
<div class="entry"><div class="topsy_widget_data topsy_theme_light-green" style="float: right; margin-left: 0.75em; background: url(data:,%7B%20%22url%22%3A%20%22http%253A%252F%252Fwww.scottlogic.co.uk%252Fblog%252Fcolin%252F2009%252F02%252Fadding-a-location-crosshair-to-silverlight-charts%252F%22%2C%20%22style%22%3A%20%22big%22%2C%20%22title%22%3A%20%22Adding%20a%20Location%20Crosshair%20to%20Silverlight%20Charts%20%23%22%20%7D);"></div><div style="background-color: #fdd; margin: 5px; padding: 5px; border: solid 2px red;"><b>UPDATE</b> – The March09 update of the Silverlight toolkit is incompatible with the code detailed below. For an up-to-date version see the <a href="{{ site.url }}/blog/colin/2009/03/adding-a-location-crosshair-to-silverlight-charts-again/">following blog post</a>.</div><p>This blog post describes how to add a location crosshair to your Silverlight charts as shown below:</p><div id="slPluginHost"> <object id="SilverlightPlugin" width="400" height="300" data="data:application/x-silverlight," type="application/x-silverlight-2"><param name="source" value="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2009/02/sllinechartcrosshair1.xap" /><a href="http://go.microsoft.com/fwlink/?LinkID=124807" style="text-decoration: none;"> <img src="http://go.microsoft.com/fwlink/?LinkId=108181" alt="Get Microsoft Silverlight" style="border-style: none;" /></a></object></div><p>The chart itself is rendered using the charting component of the recently release <a href="http://www.codeplex.com/Silverlight">Silverlight Toolkit</a>. Creating and displaying a simple line chart is as simple as referencing the correct silverlight toolkit namespaces and placing a chart with an associated lineseries into the XAML for your page:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;charting:Chart</span> <span style="color: #000066;">Name</span>=<span style="color: #ff0000;">"Chart"</span> <span style="color: #000066;">PlotAreaStyle</span>=<span style="color: #ff0000;">"{StaticResource PlotAreaStyle}"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;charting:LineSeries</span></span>
<span style="color: #009900;">		<span style="color: #000066;">IndependentValueBinding</span>=<span style="color: #ff0000;">"{Binding Path=Key}"</span></span>
<span style="color: #009900;">		<span style="color: #000066;">DependentValueBinding</span>=<span style="color: #ff0000;">"{Binding Path=Value}"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/charting:Chart<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>In this example, the data is provided in the form of an XML file as shown in the snippet below:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">"1.0"</span> <span style="color: #000066;">encoding</span>=<span style="color: #ff0000;">"UTF-8"</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;history</span> <span style="color: #000066;">generated</span>=<span style="color: #ff0000;">"2009/02/03 10:51:02 GMT+0000"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;dataPoints<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;dataPoint</span> <span style="color: #000066;">date</span>=<span style="color: #ff0000;">"2009/02/03 08:01:00 GMT+0000"</span> <span style="color: #000066;">change</span>=<span style="color: #ff0000;">"21.61"</span> <span style="color: #000066;">changePercent</span>=<span style="color: #ff0000;">"0.36"</span> <span style="color: #000066;">value</span>=<span style="color: #ff0000;">"6073.99"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;dataPoint</span> <span style="color: #000066;">date</span>=<span style="color: #ff0000;">"2009/02/03 08:02:45 GMT+0000"</span> <span style="color: #000066;">change</span>=<span style="color: #ff0000;">"16.11"</span> <span style="color: #000066;">changePercent</span>=<span style="color: #ff0000;">"0.27"</span> <span style="color: #000066;">value</span>=<span style="color: #ff0000;">"6068.49"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    ...
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;dataPoint</span> <span style="color: #000066;">date</span>=<span style="color: #ff0000;">"2009/02/03 10:50:45 GMT+0000"</span> <span style="color: #000066;">change</span>=<span style="color: #ff0000;">"0.4"</span> <span style="color: #000066;">changePercent</span>=<span style="color: #ff0000;">"0.01"</span> <span style="color: #000066;">value</span>=<span style="color: #ff0000;">"6052.78"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/dataPoints<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/history<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>This data shows the performance of the FTSE 100 index on a relatively uneventful morning. The XML file is read using LINQ to XML into a collection of KeyValuePairs. The LineSeries’ ItemsSource is set to the result of this query, with the bindings in the above XAML binding the Key and Value properties of each KeyValuePair instance.</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">protected</span> LineSeries LineSeries
<span style="color: #008000;">{</span>
    <span style="color: #0600FF; font-weight: bold;">get</span>
    <span style="color: #008000;">{</span>
        <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #008000;">(</span><span style="color: #008000;">(</span>LineSeries<span style="color: #008000;">)</span>Chart<span style="color: #008000;">.</span><span style="color: #0000FF;">Series</span><span style="color: #008000;">[</span><span style="color: #FF0000;">0</span><span style="color: #008000;">]</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">public</span> Page<span style="color: #008000;">(</span><span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
    InitializeComponent<span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
    XDocument doc <span style="color: #008000;">=</span> XDocument<span style="color: #008000;">.</span><span style="color: #0000FF;">Load</span><span style="color: #008000;">(</span><span style="color: #666666;">"chartData.xml"</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
    <span style="color: #0600FF; font-weight: bold;">var</span> elements <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">from</span> dataPoint <span style="color: #0600FF; font-weight: bold;">in</span> doc<span style="color: #008000;">.</span><span style="color: #0000FF;">Descendants</span><span style="color: #008000;">(</span><span style="color: #666666;">"dataPoint"</span><span style="color: #008000;">)</span>                           
                   <span style="color: #0600FF; font-weight: bold;">select</span> <span style="color: #008000;">new</span> KeyValuePair<span style="color: #008000;">&lt;</span>DateTime, <span style="color: #6666cc; font-weight: bold;">double</span><span style="color: #008000;">&gt;</span>
                   <span style="color: #008000;">(</span>
                       DateTime<span style="color: #008000;">.</span><span style="color: #0000FF;">Parse</span><span style="color: #008000;">(</span>dataPoint<span style="color: #008000;">.</span><span style="color: #0000FF;">Attribute</span><span style="color: #008000;">(</span><span style="color: #666666;">"date"</span><span style="color: #008000;">)</span><span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Value</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Substring</span><span style="color: #008000;">(</span><span style="color: #FF0000;">0</span>, <span style="color: #FF0000;">19</span><span style="color: #008000;">)</span><span style="color: #008000;">)</span>,
                       <span style="color: #6666cc; font-weight: bold;">Double</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Parse</span><span style="color: #008000;">(</span>dataPoint<span style="color: #008000;">.</span><span style="color: #0000FF;">Attribute</span><span style="color: #008000;">(</span><span style="color: #666666;">"value"</span><span style="color: #008000;">)</span><span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Value</span><span style="color: #008000;">)</span>
                   <span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
    LineSeries<span style="color: #008000;">.</span><span style="color: #0000FF;">ItemsSource</span> <span style="color: #008000;">=</span> elements<span style="color: #008000;">;</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>This results in the following (rather ugly!) chart:</p><p><a href="{{ site.url }}/blog/colin/wp-content/uploads/2009/02/ftse100.png"><img class="alignnone size-full wp-image-107" title="ftse100" src="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2009/02/ftse100.png" alt="ftse100" width="400" height="167" /></a></p><p>Whilst the background fade effect and line series datapoints can be modified by styling the chart, the removal of unwanted elements such as the legend require us to delve into the the Chart’s control template. The modified control template is given below:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;charting:Chart.Template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ControlTemplate</span> <span style="color: #000066;">TargetType</span>=<span style="color: #ff0000;">"charting:Chart"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid</span> <span style="color: #000066;">Name</span>=<span style="color: #ff0000;">"ChartArea"</span> <span style="color: #000066;">Style</span>=<span style="color: #ff0000;">"{TemplateBinding ChartAreaStyle}"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
&nbsp;
            <span style="color: #808080; font-style: italic;">&lt;!-- NOTE: the chart legend and title have been removed --&gt;</span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"250"</span> <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">"PlotArea"</span> <span style="color: #000066;">Style</span>=<span style="color: #ff0000;">"{TemplateBinding PlotAreaStyle}"</span></span>
<span style="color: #009900;">                  <span style="color: #000066;">MouseMove</span>=<span style="color: #ff0000;">"PlotArea_MouseMove"</span> <span style="color: #000066;">MouseEnter</span>=<span style="color: #ff0000;">"PlotArea_MouseEnter"</span> <span style="color: #000066;">MouseLeave</span>=<span style="color: #ff0000;">"PlotArea_MouseLeave"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
&nbsp;
                <span style="color: #808080; font-style: italic;">&lt;!-- the standard chart template components --&gt;</span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid</span> <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">"GridLinesContainer"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid</span> <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">"SeriesContainer"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Border</span> <span style="color: #000066;">BorderBrush</span>=<span style="color: #ff0000;">"#FF919191"</span> <span style="color: #000066;">BorderThickness</span>=<span style="color: #ff0000;">"1"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span>
&nbsp;
                <span style="color: #808080; font-style: italic;">&lt;!-- a location crosshair --&gt;</span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid</span> <span style="color: #000066;">Name</span>=<span style="color: #ff0000;">"Crosshair"</span> <span style="color: #000066;">Visibility</span>=<span style="color: #ff0000;">"Collapsed"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
                    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Line</span> <span style="color: #000066;">Name</span>=<span style="color: #ff0000;">"Vertical"</span> <span style="color: #000066;">X1</span>=<span style="color: #ff0000;">"{Binding Path=X}"</span> <span style="color: #000066;">Y1</span>=<span style="color: #ff0000;">"0"</span> <span style="color: #000066;">X2</span>=<span style="color: #ff0000;">"{Binding Path=X}"</span> <span style="color: #000066;">Y2</span>=<span style="color: #ff0000;">"250"</span> <span style="color: #000066;">Stroke</span>=<span style="color: #ff0000;">"Black"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
                    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Line</span> <span style="color: #000066;">Name</span>=<span style="color: #ff0000;">"Horizontal"</span> <span style="color: #000066;">X1</span>=<span style="color: #ff0000;">"0"</span> <span style="color: #000066;">Y1</span>=<span style="color: #ff0000;">"{Binding Path=Y}"</span> <span style="color: #000066;">X2</span>=<span style="color: #ff0000;">"400"</span> <span style="color: #000066;">Y2</span>=<span style="color: #ff0000;">"{Binding Path=Y}"</span> <span style="color: #000066;">Stroke</span>=<span style="color: #ff0000;">"Black"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
                <span style="color: #808080; font-style: italic;">&lt;!-- a location 'legend' --&gt;</span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Border</span> <span style="color: #000066;">Name</span>=<span style="color: #ff0000;">"LocationIndicator"</span> <span style="color: #000066;">Visibility</span>=<span style="color: #ff0000;">"Collapsed"</span> <span style="color: #000066;">Style</span>=<span style="color: #ff0000;">"{StaticResource LocationLegendStyle}"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
                    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;StackPanel</span> <span style="color: #000066;">Orientation</span>=<span style="color: #ff0000;">"Horizontal"</span> <span style="color: #000066;">Margin</span>=<span style="color: #ff0000;">"5"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
                        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBlock</span> <span style="color: #000066;">Text</span>=<span style="color: #ff0000;">"Location: "</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
                        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBlock</span> <span style="color: #000066;">Text</span>=<span style="color: #ff0000;">"{Binding Path=Key}"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
                        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBlock</span> <span style="color: #000066;">Text</span>=<span style="color: #ff0000;">", "</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
                        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBlock</span> <span style="color: #000066;">Text</span>=<span style="color: #ff0000;">"{Binding Path=Value}"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
                    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/StackPanel<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Border<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ControlTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/charting:Chart.Template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>In the above template you can see a couple of Grids, one named GridLinesContainer, and the other names SeriesContainer. When constructing the chart, the chart control will navigate the visual tree constructed from its control template to find elements of these names. It will then add the grid lines and series to these containers accordingly. This gives us the freedom to modify the chart’s control template whilst still allowing it to function normally. In the above template I have added two new elements, a cross hair and a location indicator. I have also added handlers for a few of the mouse events on the plot area.</p><p>The mouse move event handler in the code behind finds the current mouse position within the PlotArea grid. Firstly, the coordinates of this point are found within the chart coordinate system (more on this later), following this, the DataContexts for the Crosshair and PlotArea are set to the mouse position and location within the chart coordinate system respectively. Looking in the above XAML we can see that the Crosshair contains a pair of lines which are bound to the X and Y properties of their DataContext, ensuring that the two lines intersect at the current mouse location. The LocationIndicator will inherit the PlotArea’s DataContext, allowing it to output the current location in the chart coordinate system.</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> PlotArea_MouseMove<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">object</span> sender, MouseEventArgs e<span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
    <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">(</span>LineSeries<span style="color: #008000;">.</span><span style="color: #0000FF;">ItemsSource</span> <span style="color: #008000;">==</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">)</span>
        <span style="color: #0600FF; font-weight: bold;">return</span><span style="color: #008000;">;</span>
&nbsp;
    Point mousePos <span style="color: #008000;">=</span> e<span style="color: #008000;">.</span><span style="color: #0000FF;">GetPosition</span><span style="color: #008000;">(</span>PlotArea<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
    KeyValuePair<span style="color: #008000;">&lt;</span>DateTime, <span style="color: #6666cc; font-weight: bold;">double</span><span style="color: #008000;">&gt;</span> crosshairLocation <span style="color: #008000;">=</span> GetPlotAreaCoordinates<span style="color: #008000;">(</span>mousePos<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
    PlotArea<span style="color: #008000;">.</span><span style="color: #0000FF;">DataContext</span> <span style="color: #008000;">=</span> crosshairLocation<span style="color: #008000;">;</span>
    Crosshair<span style="color: #008000;">.</span><span style="color: #0000FF;">DataContext</span> <span style="color: #008000;">=</span> mousePos<span style="color: #008000;">;</span>
    PlotArea<span style="color: #008000;">.</span><span style="color: #0000FF;">Cursor</span> <span style="color: #008000;">=</span> Cursors<span style="color: #008000;">.</span><span style="color: #0000FF;">None</span><span style="color: #008000;">;</span>
<span style="color: #008000;">}</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">protected</span> Grid PlotArea
<span style="color: #008000;">{</span>
    <span style="color: #0600FF; font-weight: bold;">get</span> <span style="color: #008000;">{</span> <span style="color: #0600FF; font-weight: bold;">return</span> ChartArea<span style="color: #008000;">.</span><span style="color: #0000FF;">FindName</span><span style="color: #008000;">(</span><span style="color: #666666;">"PlotArea"</span><span style="color: #008000;">)</span> <span style="color: #0600FF; font-weight: bold;">as</span> Grid<span style="color: #008000;">;</span> <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">protected</span> Grid Crosshair
<span style="color: #008000;">{</span>
    <span style="color: #0600FF; font-weight: bold;">get</span> <span style="color: #008000;">{</span> <span style="color: #0600FF; font-weight: bold;">return</span> ChartArea<span style="color: #008000;">.</span><span style="color: #0000FF;">FindName</span><span style="color: #008000;">(</span><span style="color: #666666;">"Crosshair"</span><span style="color: #008000;">)</span> <span style="color: #0600FF; font-weight: bold;">as</span> Grid<span style="color: #008000;">;</span> <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">protected</span> Grid ChartArea
<span style="color: #008000;">{</span>
    <span style="color: #0600FF; font-weight: bold;">get</span>
    <span style="color: #008000;">{</span>
        <span style="color: #008080; font-style: italic;">// chart area is within a different namescope to this page, therefore</span>
        <span style="color: #008080; font-style: italic;">// we must navigate the visual tree to locate it</span>
        <span style="color: #0600FF; font-weight: bold;">return</span> VisualTreeHelper<span style="color: #008000;">.</span><span style="color: #0000FF;">GetChild</span><span style="color: #008000;">(</span>Chart, <span style="color: #FF0000;">0</span><span style="color: #008000;">)</span> <span style="color: #0600FF; font-weight: bold;">as</span> Grid<span style="color: #008000;">;</span>
    <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>One thing worth noting in the above code is that way in which the PlotArea and Crosshair elements are located. Usually it is possible to simply name elements within your XAML using their Name attribute then refer to them directly in the code-behind or locate them via the <a href="msdn.microsoft.com/en-us/library/bb979952(VS.95).aspx">DependencyObject.FindName</a> method. However, FindName relies on the named element being in the same namescope. Control template are in a different namescope to the XAML page which they are defined within, therefore we have to navigate the visual tree to find the root element of the chart control, then invoke FindName from there. See the MSDN page on <a href="http://msdn.microsoft.com/en-us/library/cc189026(VS.95).aspx#NamescopesinTemplates">XAML namescopes</a> for more details.</p><p>The GetPlotAreaCoordinates method is given below:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">private</span> KeyValuePair<span style="color: #008000;">&lt;</span>DateTime, <span style="color: #6666cc; font-weight: bold;">double</span><span style="color: #008000;">&gt;</span> GetPlotAreaCoordinates<span style="color: #008000;">(</span>Point position<span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
    Range<span style="color: #008000;">&lt;</span>IComparable<span style="color: #008000;">&gt;</span> yAxisHit <span style="color: #008000;">=</span> <span style="color: #008000;">(</span><span style="color: #008000;">(</span>IRangeAxis<span style="color: #008000;">)</span>YAxis<span style="color: #008000;">)</span><span style="color: #008000;">.</span><span style="color: #0000FF;">GetPlotAreaCoordinateValueRange</span><span style="color: #008000;">(</span>PlotArea<span style="color: #008000;">.</span><span style="color: #0000FF;">Height</span> <span style="color: #008000;">-</span> position<span style="color: #008000;">.</span><span style="color: #0000FF;">Y</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
    Range<span style="color: #008000;">&lt;</span>IComparable<span style="color: #008000;">&gt;</span> xAxisHit <span style="color: #008000;">=</span> <span style="color: #008000;">(</span><span style="color: #008000;">(</span>IRangeAxis<span style="color: #008000;">)</span>XAxis<span style="color: #008000;">)</span><span style="color: #008000;">.</span><span style="color: #0000FF;">GetPlotAreaCoordinateValueRange</span><span style="color: #008000;">(</span>position<span style="color: #008000;">.</span><span style="color: #0000FF;">X</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
    <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #008000;">new</span> KeyValuePair<span style="color: #008000;">&lt;</span>DateTime, <span style="color: #6666cc; font-weight: bold;">double</span><span style="color: #008000;">&gt;</span><span style="color: #008000;">(</span><span style="color: #008000;">(</span>DateTime<span style="color: #008000;">)</span>xAxisHit<span style="color: #008000;">.</span><span style="color: #0000FF;">Minimum</span>, <span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">double</span><span style="color: #008000;">)</span>yAxisHit<span style="color: #008000;">.</span><span style="color: #0000FF;">Minimum</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>The silverlight chart axes actually provides methods which can be used to translate from screen coordinates to chart coordinates via the IRangeAxis interface, however they are hidden by <a href="http://msdn.microsoft.com/en-us/library/aa288461(VS.71).aspx">explicit interface implementation</a> of these interface methods by the concrete axis classes. It is a shame that such useful methods are hidden! I have never really seen the value of explicit interface implementation.</p><p>In conclusion, this blog post has shown how simple it is to add a crosshair to your silverlight linecharts. What I personally find interesting is the way in which you can not only customise the appearance of Silverlight (and WPF) controls, but also add behaviour without the need to subclass the controls themselves. I think that this makes life easier for the users of Silverlight/WPF controls, in that they can use the same techniques to extend any control rather than relying on the control having built in extension points (it is often a source of frustration when developing with Windows Forms (or similar technologies) when you wish to customise some aspect of an existing control, however the control author has not provided events, or virtual methods for this purpose). It also of course makes life easier for the control developer in that they do not have to spend so much time thinking about how their control might be extended and adapted by its users. </p><p>You can download a visual studio project with the code from this blog post, <a href="{{ site.url }}/blog/colin/wp-content/uploads/2009/02/sllinechartcrosshair.zip">sllinechartcrosshair.zip</a>.</p><p>Regards, Colin E.</p></div>