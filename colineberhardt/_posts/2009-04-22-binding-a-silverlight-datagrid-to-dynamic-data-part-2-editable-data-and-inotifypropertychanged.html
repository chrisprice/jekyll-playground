---
author: Colin Eberhardt
tags: binding, DataGrid, silverlight
permalink: /blog/colin/2009/04/binding-a-silverlight-datagrid-to-dynamic-data-part-2-editable-data-and-inotifypropertychanged/index.html
layout: colineberhardt-blog
---
<div class="entry"><div class="topsy_widget_data topsy_theme_light-green" style="float: right; margin-left: 0.75em; background: url(data:,%7B%20%22url%22%3A%20%22http%253A%252F%252Fwww.scottlogic.co.uk%252Fblog%252Fcolin%252F2009%252F04%252Fbinding-a-silverlight-datagrid-to-dynamic-data-part-2-editable-data-and-inotifypropertychanged%252F%22%2C%20%22style%22%3A%20%22big%22%2C%20%22title%22%3A%20%22Binding%20a%20Silverlight%20DataGrid%20to%20dynamic%20data%20Part%202%20-%20editable%20data%20and%20INotifyPropertyChanged%20%23%22%20%7D);"></div><p><strong>UPDATE</strong>: This blog post was written with a SL2 DataGrid, for SL3, please see my <a href="{{ site.url }}/blog/colin/2010/03/binding-a-silverlight-3-datagrid-to-dynamic-data-via-idictionary-updated/">updated blog post</a>.</p><p>In my <a href="{{ site.url }}/blog/colin/2009/04/binding-a-silverlight-datagrid-to-dynamic-data-via-idictionary/">previous blog post</a> I described a method for solving the commonly faced problem of binding a Silverlight DataGrid to dynamic data, the form of which is not know at compile time. This blog post extends on the method previously described, adding change notification, allowing the DataGrid to synchronise the UI with changes to the bound data and to allow the user to edit the DataGrid’s contents.</p><p>To briefly recap my previous post, the dynamic data is copied to a collection of Rows:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> Row
<span style="color: #008000;">{</span>
  <span style="color: #0600FF; font-weight: bold;">private</span> Dictionary<span style="color: #008000;">&lt;</span><span style="color: #6666cc; font-weight: bold;">string</span>, <span style="color: #6666cc; font-weight: bold;">object</span><span style="color: #008000;">&gt;</span> _data <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> Dictionary<span style="color: #008000;">&lt;</span><span style="color: #6666cc; font-weight: bold;">string</span>, <span style="color: #6666cc; font-weight: bold;">object</span><span style="color: #008000;">&gt;</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
  <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">object</span> <span style="color: #0600FF; font-weight: bold;">this</span> <span style="color: #008000;">[</span><span style="color: #6666cc; font-weight: bold;">string</span> index<span style="color: #008000;">]</span>
  <span style="color: #008000;">{</span>
    <span style="color: #0600FF; font-weight: bold;">get</span> <span style="color: #008000;">{</span> <span style="color: #0600FF; font-weight: bold;">return</span> _data<span style="color: #008000;">[</span>index<span style="color: #008000;">]</span><span style="color: #008000;">;</span> <span style="color: #008000;">}</span>
    <span style="color: #0600FF; font-weight: bold;">set</span> <span style="color: #008000;">{</span> _data<span style="color: #008000;">[</span>index<span style="color: #008000;">]</span> <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">value</span><span style="color: #008000;">;</span> <span style="color: #008000;">}</span>
  <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>Where the row ‘properties’ which are implemented via the string indexer bound to the grid via a ValueConverter. The XAML for the DataGrid looks like the following:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;data:DataGrid</span> <span style="color: #000066;">Name</span>=<span style="color: #ff0000;">"_dataGrid"</span> <span style="color: #000066;">AutoGenerateColumns</span>=<span style="color: #ff0000;">"False"</span>  <span style="color: #000066;">IsReadOnly</span>=<span style="color: #ff0000;">"False"</span> <span style="color: #000066;">Margin</span>=<span style="color: #ff0000;">"5"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;data:DataGrid.Columns<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;data:DataGridTextColumn</span> <span style="color: #000066;">Header</span>=<span style="color: #ff0000;">"Forename"</span></span>
<span style="color: #009900;">                                 <span style="color: #000066;">Binding</span>=<span style="color: #ff0000;">"{Binding Converter={StaticResource RowIndexConverter},</span>
<span style="color: #009900;">                                    ConverterParameter=Forename}"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;data:DataGridTextColumn</span> <span style="color: #000066;">Header</span>=<span style="color: #ff0000;">"Surname"</span> </span>
<span style="color: #009900;">                                 <span style="color: #000066;">Binding</span>=<span style="color: #ff0000;">"{Binding Converter={StaticResource RowIndexConverter},</span>
<span style="color: #009900;">                                    ConverterParameter=Surname}"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
        ...               
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/data:DataGrid.Columns<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/data:DataGrid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>Where the ValueConverter takes the ConverterParameter and uses it to index the bound Row instance:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> RowIndexConverter <span style="color: #008000;">:</span> IValueConverter
<span style="color: #008000;">{</span>
  <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">object</span> Convert<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">object</span> <span style="color: #0600FF; font-weight: bold;">value</span>, Type targetType, <span style="color: #6666cc; font-weight: bold;">object</span> parameter, CultureInfo culture<span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    Row row <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">value</span> <span style="color: #0600FF; font-weight: bold;">as</span> Row<span style="color: #008000;">;</span>
    <span style="color: #6666cc; font-weight: bold;">string</span> index <span style="color: #008000;">=</span> parameter <span style="color: #0600FF; font-weight: bold;">as</span> <span style="color: #6666cc; font-weight: bold;">string</span><span style="color: #008000;">;</span>
    <span style="color: #0600FF; font-weight: bold;">return</span> row<span style="color: #008000;">[</span>index<span style="color: #008000;">]</span><span style="color: #008000;">;</span>
  <span style="color: #008000;">}</span> 
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>It is important to note that the Binding does not have a Path defined. As a result, the binding source is the Row instance itself rather than a property of the Row as would more normally be the case when binding data. The rest of the post described how to create a collection view which sorts the collection via the Row’s string indexer. You can read about this in full in my <a href="{{ site.url }}/blog/colin/2009/04/binding-a-silverlight-datagrid-to-dynamic-data-via-idictionary/">previous blog post</a>.</p><p>Now, one question a few people have asked me is how to implement INotifyPropertyChanged on the Row class in order to make the DataGrid editable. Simply implementing INotifyPropertyChanged on the Row class, with events raised from the index setter, will not make the grid editable or synchronised with the bound data. The underlying problem here is that the Binding does not have a Path specified, therefore, the binding framework does not know which property name to look out for when handling PropertyChanged events. Interestingly I would expect the above bindings to be updated if a PropertyChanged event were raised with a null or empty PropertyName string, however they do not.</p><p>So if the Binding framework needs a Path for the binding in order for change notification to work, we will have to fabricate one for this purpose! We can modify the Row class as follows, adding a Data property which is simply a reference to the Row instance itself:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> Row <span style="color: #008000;">:</span> INotifyPropertyChanged
<span style="color: #008000;">{</span>
    <span style="color: #0600FF; font-weight: bold;">private</span> Dictionary<span style="color: #008000;">&lt;</span><span style="color: #6666cc; font-weight: bold;">string</span>, <span style="color: #6666cc; font-weight: bold;">object</span><span style="color: #008000;">&gt;</span> _data <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> Dictionary<span style="color: #008000;">&lt;</span><span style="color: #6666cc; font-weight: bold;">string</span>, <span style="color: #6666cc; font-weight: bold;">object</span><span style="color: #008000;">&gt;</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
    <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">object</span> <span style="color: #0600FF; font-weight: bold;">this</span> <span style="color: #008000;">[</span><span style="color: #6666cc; font-weight: bold;">string</span> index<span style="color: #008000;">]</span>
    <span style="color: #008000;">{</span>
        <span style="color: #0600FF; font-weight: bold;">get</span>
        <span style="color: #008000;">{</span>
            <span style="color: #0600FF; font-weight: bold;">return</span> _data<span style="color: #008000;">[</span>index<span style="color: #008000;">]</span><span style="color: #008000;">;</span>
        <span style="color: #008000;">}</span>
        <span style="color: #0600FF; font-weight: bold;">set</span>
        <span style="color: #008000;">{</span>
            _data<span style="color: #008000;">[</span>index<span style="color: #008000;">]</span> <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">value</span><span style="color: #008000;">;</span>
&nbsp;
            OnPropertyChanged<span style="color: #008000;">(</span><span style="color: #666666;">"Data"</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
        <span style="color: #008000;">}</span>
    <span style="color: #008000;">}</span>
&nbsp;
    <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">object</span> Data
    <span style="color: #008000;">{</span>
        <span style="color: #0600FF; font-weight: bold;">get</span>
        <span style="color: #008000;">{</span>
            <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">this</span><span style="color: #008000;">;</span>
        <span style="color: #008000;">}</span>
    <span style="color: #008000;">}</span>
&nbsp;
    <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">event</span> PropertyChangedEventHandler PropertyChanged<span style="color: #008000;">;</span>
&nbsp;
    <span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #6666cc; font-weight: bold;">void</span> OnPropertyChanged<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">string</span> property<span style="color: #008000;">)</span>
    <span style="color: #008000;">{</span>
        <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">(</span>PropertyChanged<span style="color: #008000;">!=</span><span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">)</span>
        <span style="color: #008000;">{</span>
            PropertyChanged<span style="color: #008000;">(</span><span style="color: #0600FF; font-weight: bold;">this</span>, <span style="color: #008000;">new</span> PropertyChangedEventArgs<span style="color: #008000;">(</span>property<span style="color: #008000;">)</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
        <span style="color: #008000;">}</span>
    <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>In order to bind this class we modify our bindings so that the source Path points to the Data property:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;">...
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;data:DataGridTextColumn</span> <span style="color: #000066;">Header</span>=<span style="color: #ff0000;">"Forename"</span></span>
<span style="color: #009900;">                           <span style="color: #000066;">Binding</span>=<span style="color: #ff0000;">"{Binding Path=Data, Converter={StaticResource RowIndexConverter},</span>
<span style="color: #009900;">                           ConverterParameter=Forename}"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;data:DataGridTextColumn</span> <span style="color: #000066;">Header</span>=<span style="color: #ff0000;">"Forename"</span></span>
<span style="color: #009900;">                           <span style="color: #000066;">Binding</span>=<span style="color: #ff0000;">"{Binding Path=Data, Converter={StaticResource RowIndexConverter},</span>
<span style="color: #009900;">                           ConverterParameter=Surname}"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
...</pre></td></tr></table></div><p>With this change in place, all of our bindings are bound to the Row’s Data property. Again, the Row’s indexer is being accessed via our value converter. However, if any ‘property’ change via the string indexer setter will result in all of our bindings being updated for that Row. I know, it is not the most efficient solution – but at least it work!</p><p>The next problem is making the DataGrid editable. The problem we face here is that all of our bindings are to the same property, Data. When a cell is edited, the binding framework will quite happily call the Data properties setter, with the updated value. However, how do we know which property of the Row was really being set? The only place we hold this information is in the ConverterParameter which is fed to our RowIndexConverter value converter. Fortunately, there is a solution to this problem, when the binding framework updates the bound object, it will first invoke the ConvertBack method on our value converter. This gives us the opportunity to ‘capture’ the converter parameter and feed it into the setter of our Data property, as shown below:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> RowIndexConverter <span style="color: #008000;">:</span> IValueConverter
<span style="color: #008000;">{</span>
    <span style="color: #008000;">...</span>
&nbsp;
    <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">object</span> ConvertBack<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">object</span> <span style="color: #0600FF; font-weight: bold;">value</span>, Type targetType,
        <span style="color: #6666cc; font-weight: bold;">object</span> parameter, CultureInfo culture<span style="color: #008000;">)</span>
    <span style="color: #008000;">{</span>
        <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #008000;">new</span> PropertyValueChange<span style="color: #008000;">(</span>parameter <span style="color: #0600FF; font-weight: bold;">as</span> <span style="color: #6666cc; font-weight: bold;">string</span>, <span style="color: #0600FF; font-weight: bold;">value</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>Where PropertyValueChanged is a simple value object:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> PropertyValueChange
<span style="color: #008000;">{</span>
    <span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">string</span> _propertyName<span style="color: #008000;">;</span>
    <span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">object</span> _value<span style="color: #008000;">;</span>
&nbsp;
    <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">object</span> <span style="color: #0600FF; font-weight: bold;">Value</span>
    <span style="color: #008000;">{</span>
        <span style="color: #0600FF; font-weight: bold;">get</span> <span style="color: #008000;">{</span> <span style="color: #0600FF; font-weight: bold;">return</span> _value<span style="color: #008000;">;</span> <span style="color: #008000;">}</span>
    <span style="color: #008000;">}</span>
&nbsp;
    <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">string</span> PropertyName
    <span style="color: #008000;">{</span>
        <span style="color: #0600FF; font-weight: bold;">get</span> <span style="color: #008000;">{</span> <span style="color: #0600FF; font-weight: bold;">return</span> _propertyName<span style="color: #008000;">;</span> <span style="color: #008000;">}</span>
    <span style="color: #008000;">}</span>
&nbsp;
    <span style="color: #0600FF; font-weight: bold;">public</span> PropertyValueChange<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">string</span> propertyName, <span style="color: #6666cc; font-weight: bold;">object</span> <span style="color: #0600FF; font-weight: bold;">value</span><span style="color: #008000;">)</span>
    <span style="color: #008000;">{</span>
        _propertyName <span style="color: #008000;">=</span> propertyName<span style="color: #008000;">;</span>
        _value <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">value</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>The setter for the Data property will now be invoked with an instance of PropertyValueChanged, giving it all the information it requires to invoke the string indexer with the correct ‘property’ name:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> Row <span style="color: #008000;">:</span> INotifyPropertyChanged
<span style="color: #008000;">{</span>
    <span style="color: #008000;">...</span>
&nbsp;
    <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">object</span> Data
    <span style="color: #008000;">{</span>
        <span style="color: #0600FF; font-weight: bold;">get</span> <span style="color: #008000;">{</span> <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">this</span><span style="color: #008000;">;</span> <span style="color: #008000;">}</span>
        <span style="color: #0600FF; font-weight: bold;">set</span>
        <span style="color: #008000;">{</span>
            PropertyValueChange setter <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">value</span> <span style="color: #0600FF; font-weight: bold;">as</span> PropertyValueChange<span style="color: #008000;">;</span>
            _data<span style="color: #008000;">[</span>setter<span style="color: #008000;">.</span><span style="color: #0000FF;">PropertyName</span><span style="color: #008000;">]</span> <span style="color: #008000;">=</span> setter<span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Value</span><span style="color: #008000;">;</span>
        <span style="color: #008000;">}</span>
    <span style="color: #008000;">}</span>
    <span style="color: #008000;">...</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>With this change in place, we the user is able to edit the data bound to the DataGrid, and the binding ensures that the DataGrid UI is synchronised with any changes to the bound data that may happen elsewhere in our code.</p><p>One final thought that struck me is that this technique uses the Binding’s associated ValueConverter to access the Row’s string indexer, but what if we wanted to use a ValueConverter for something else like formatting? Fortunately it is a pretty straightforward process to nest one value converter inside another. For details, see the attached project. For now, have quick play with the grid below, where all the columns are editable and the button click event sets the Row’s Age property demonstrating how the DataGrid is synchronised:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> Button_Click<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">object</span> sender, RoutedEventArgs e<span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
    <span style="color: #008080; font-style: italic;">// demonstrate the property changes from code-behind still work.</span>
    Random rand <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> Random<span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
    <span style="color: #0600FF; font-weight: bold;">foreach</span> <span style="color: #008000;">(</span><span style="color: #0600FF; font-weight: bold;">var</span> row <span style="color: #0600FF; font-weight: bold;">in</span> _rows<span style="color: #008000;">)</span>
    <span style="color: #008000;">{</span>
        row<span style="color: #008000;">[</span><span style="color: #666666;">"Age"</span><span style="color: #008000;">]</span> <span style="color: #008000;">=</span> rand<span style="color: #008000;">.</span><span style="color: #0000FF;">Next</span><span style="color: #008000;">(</span><span style="color: #FF0000;">10</span><span style="color: #008000;">)</span> <span style="color: #008000;">+</span> <span style="color: #FF0000;">5</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>Also, the Age column has a value converter associated …</p><div id="slPluginHost"> <object id="SilverlightPlugin" width="300" height="300" data="data:application/x-silverlight," type="application/x-silverlight-2"><param name="source" value="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2009/04/silverlighttable1.xap" /><a href="http://go.microsoft.com/fwlink/?LinkID=124807" style="text-decoration: none;"> <img src="http://go.microsoft.com/fwlink/?LinkId=108181" alt="Get Microsoft Silverlight" style="border-style: none;" /></a></object></div><p>So there you have it, binding to dynamic data with INotifyPropertyChanged implemented and an editable DataGrid. The only reservation I have with this technique is that I am really bending the binding framework to achieve the results, having a Data property which expects different types for the getter and setter is a little ugly … use with caution!</p><p>You can download the project sourcecode: <a href="{{ site.url }}/blog/colin/wp-content/uploads/2009/04/silverlightdynamicbinding2.zip">silverlightdynamicbinding2.zip</a></p><p>Regards, Colin E.</p></div>