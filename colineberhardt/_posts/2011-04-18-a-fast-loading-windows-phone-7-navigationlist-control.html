---
author: Colin Eberhardt
tags: codeproject, NavigationList, WP7
permalink: /blog/colin/2011/04/a-fast-loading-windows-phone-7-navigationlist-control/index.html
layout: colineberhardt-blog
---
<div class="entry"><div class="topsy_widget_data topsy_theme_light-green" style="float: right; margin-left: 0.75em; background: url(data:,%7B%20%22url%22%3A%20%22http%253A%252F%252Fwww.scottlogic.co.uk%252Fblog%252Fcolin%252F2011%252F04%252Fa-fast-loading-windows-phone-7-navigationlist-control%252F%22%2C%20%22style%22%3A%20%22big%22%2C%20%22title%22%3A%20%22A%20Fast%20Loading%20Windows%20Phone%207%20NavigationList%20Control%20%23%22%20%7D);"></div><p><i>This blog post describes a Windows Phone 7 NavigationList control, a list control designed for navigation pages. The NavigationList renders twice as fast as a ListBox and has a slightly simpler API.</i></p><p>A few months ago I blogged about the <a href="{{ site.url }}/blog/colin/2011/02/windows-phone-7-performance-measurements-emulator-vs-hardware/">relative performance of the Windows Phone 7 emulator versus the same code being run on the real hardware</a>. There were a couple of take-home messages from this blog post, firstly the performance on real hardware is typically much slower than the emulator, and secondly an <code>ItemsControl</code> can render the same content as a <code>ListBox</code> in less time, making them a better choice for rendering lists of items for navigation.</p><p>The recent NoDo updates included some performance improvements, most of which focus on load performance. I re-ran the tests from my previous blog post pre-NoDo and after installing NoDo on the phone (Samsung Omnia), but saw no difference in performance between my measurements, which is pretty much what I expected:</p><p><img src="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2011/04/PerformanceNoDo.png" alt="" title="PerformanceNoDo" width="531" height="339" class="aligncenter size-full wp-image-1387" /></p><p>Load time is still a significant issue for Windows Phone 7 Silverlight applications, and anything that can be done to reduce this will make your application more slick and useable.</p><p>I still see examples on the internet of people using the <code>ListBox</code> for navigation within Windows Phone 7 application, despite the poor performance when compared with an <code>ItemsControl</code>. This is probably because <code>ListBox</code> has a slightly simpler API. In order to combat this I have come up with a <code>NavigationList</code> control, which is based on an <code>ItemsControl</code>. This control wraps up all the <code>ItemsControl</code> configuration and click / manipulation handling to give a fast and easy-to-use control which simply raises a <code>Navigation</code> event in response to user interactions.</p><h2>NavigationList Control</h2><p>The <code>NavigationList</code> control is a lightweight control that can be used to render a list of items (base on an <code>ItemTemplate</code>). The following XAML snippet shows how to use this control:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;l:NavigationList</span> <span style="color: #000066;">ItemsSource</span>=<span style="color: #ff0000;">"{Binding}"</span></span>
<span style="color: #009900;">              <span style="color: #000066;">Navigation</span>=<span style="color: #ff0000;">"NavigationList_Navigation"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;l:NavigationList.ItemTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;DataTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBlock</span> <span style="color: #000066;">Text</span>=<span style="color: #ff0000;">"{Binding}"</span> <span style="color: #000066;">FontSize</span>=<span style="color: #ff0000;">"25"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/DataTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/l:NavigationList.ItemTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/l:NavigationList<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>The <code>NavigationList</code> has an <code>ItemsSource</code> property which is used to supply your list of items, and an optional <code>ItemTemplate</code> template where you specify how they are rendered. </p><p>The control fires a <code>Navigation</code> event whenever the user clicks on an item. This event has an <code>Item</code> argument which contains the item (from the <code>ItemsSource</code>) that was selected. This is typically used to navigate to a new page, as in the example below:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> NavigationList_Navigation<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">object</span> sender, NavigationEventArgs e<span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
  <span style="color: #008080; font-style: italic;">// pass the datacontext to the page we are navigating to via the RootVisual.</span>
  FrameworkElement root <span style="color: #008000;">=</span> Application<span style="color: #008000;">.</span><span style="color: #0000FF;">Current</span><span style="color: #008000;">.</span><span style="color: #0000FF;">RootVisual</span> <span style="color: #0600FF; font-weight: bold;">as</span> FrameworkElement<span style="color: #008000;">;</span>
  root<span style="color: #008000;">.</span><span style="color: #0000FF;">DataContext</span> <span style="color: #008000;">=</span> e<span style="color: #008000;">.</span><span style="color: #0000FF;">Item</span><span style="color: #008000;">;</span>
  NavigationService<span style="color: #008000;">.</span><span style="color: #0000FF;">Navigate</span><span style="color: #008000;">(</span><span style="color: #008000;">new</span> Uri<span style="color: #008000;">(</span><span style="color: #666666;">"/DetailsPage.xaml"</span>, UriKind<span style="color: #008000;">.</span><span style="color: #0000FF;">RelativeOrAbsolute</span><span style="color: #008000;">)</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>So, how does the <code>NavigationList</code> compare to a <code>ListBox</code>? In terms or performance, it is a clear winner. The example project for this blog post has a test which renders exactly the same content with a <code>ListBox</code> and a <code>NavigationList</code>. Here’s how the load time of the page compares:</p><p><img src="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2011/04/LoadPerformance.png" alt="" title="LoadPerformance" width="488" height="318" class="aligncenter size-full wp-image-1389" /></p><p>A page which uses a <code>NavigationList</code> renders twice as fast as an equivalent page that uses a <code>ListBox</code>!</p><p>Another problem with using <code>ListBox</code> is that selection state is ‘persisted’ in the back stack, therefore when you navigate back to the page, you must clear the <code>SelectedItem</code>. Interestingly I just spotted a blog post by a <a href="http://samidipbasu.com/2011/03/19/a-classic-goofup/">WP7 developer who’s application was rejected during the marketplace submission process</a> for forgetting to do just this!</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">void</span> OnNavigatedTo<span style="color: #008000;">(</span><span style="color: #000000;">System</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Windows</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Navigation</span><span style="color: #008000;">.</span><span style="color: #0000FF;">NavigationEventArgs</span> e<span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
  <span style="color: #0600FF; font-weight: bold;">base</span><span style="color: #008000;">.</span><span style="color: #0000FF;">OnNavigatedTo</span><span style="color: #008000;">(</span>e<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
  <span style="color: #008080; font-style: italic;">// reset selection so that the same item can be re-selected</span>
  navigationListBox<span style="color: #008000;">.</span><span style="color: #0000FF;">SelectedItem</span> <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">;</span>      
<span style="color: #008000;">}</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> ListBox_SelectionChanged<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">object</span> sender, SelectionChangedEventArgs e<span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
  <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">(</span>navigationListBox<span style="color: #008000;">.</span><span style="color: #0000FF;">SelectedItem</span> <span style="color: #008000;">==</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">)</span>
    <span style="color: #0600FF; font-weight: bold;">return</span><span style="color: #008000;">;</span>
&nbsp;
  <span style="color: #008080; font-style: italic;">// pass the datacontext to the page we are navigating to via the RootVisual.</span>
  FrameworkElement root <span style="color: #008000;">=</span> Application<span style="color: #008000;">.</span><span style="color: #0000FF;">Current</span><span style="color: #008000;">.</span><span style="color: #0000FF;">RootVisual</span> <span style="color: #0600FF; font-weight: bold;">as</span> FrameworkElement<span style="color: #008000;">;</span>
  root<span style="color: #008000;">.</span><span style="color: #0000FF;">DataContext</span> <span style="color: #008000;">=</span> navigationListBox<span style="color: #008000;">.</span><span style="color: #0000FF;">SelectedItem</span><span style="color: #008000;">;</span>
  NavigationService<span style="color: #008000;">.</span><span style="color: #0000FF;">Navigate</span><span style="color: #008000;">(</span><span style="color: #008000;">new</span> Uri<span style="color: #008000;">(</span><span style="color: #666666;">"/DetailsPage.xaml"</span>, UriKind<span style="color: #008000;">.</span><span style="color: #0000FF;">RelativeOrAbsolute</span><span style="color: #008000;">)</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><h2>NavigationList Implementation</h2><p>The control itself is quite simple, the template includes an <code>ItemsControl</code>, which binds to the <code>NavigationList</code> <code>ItemsSource</code> and <code>ItemTemplate</code> dependency properties. The <code>ItemsControl</code> uses a <code>VirtualizingStackPanel</code> for the <code>ItemsPanel<br />
</code> to give a faster load time (as does the <code>ListBox</code>):</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Style</span> <span style="color: #000066;">TargetType</span>=<span style="color: #ff0000;">"l:NavigationList"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Setter</span> <span style="color: #000066;">Property</span>=<span style="color: #ff0000;">"ItemTemplate"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Setter.Value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;DataTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBlock</span> <span style="color: #000066;">Text</span>=<span style="color: #ff0000;">"{Binding}"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/DataTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Setter.Value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Setter<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Setter</span> <span style="color: #000066;">Property</span>=<span style="color: #ff0000;">"Template"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Setter.Value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ControlTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;l:ItemsControlEx</span> <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">"itemsControl"</span></span>
<span style="color: #009900;">                      <span style="color: #000066;">ItemsSource</span>=<span style="color: #ff0000;">"{Binding Path=ItemsSource, RelativeSource={RelativeSource TemplatedParent}}"</span></span>
<span style="color: #009900;">                      <span style="color: #000066;">ItemTemplate</span>=<span style="color: #ff0000;">"{Binding Path=ItemTemplate, RelativeSource={RelativeSource TemplatedParent}}"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>                        
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;l:ItemsControlEx.ItemsPanel<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsPanelTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
              <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;VirtualizingStackPanel</span> <span style="color: #000066;">Orientation</span>=<span style="color: #ff0000;">"Vertical"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsPanelTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/l:ItemsControlEx.ItemsPanel<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;l:ItemsControlEx.Template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ControlTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
              <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ScrollViewer<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsPresenter</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
              <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ScrollViewer<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ControlTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/l:ItemsControlEx.Template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/l:ItemsControlEx<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ControlTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Setter.Value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Setter<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Style<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p><code>ItemsControlEx</code> is a simple subclass of <code>ItemsControl</code> which raises an event each time an item is added to the panel:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #008080; font-style: italic;">/// &lt;summary&gt;</span>
<span style="color: #008080; font-style: italic;">/// Extends an ItemsControl, raising an event when the PrepareContainerForItemOverride</span>
<span style="color: #008080; font-style: italic;">/// override is invoked.</span>
<span style="color: #008080; font-style: italic;">/// &lt;/summary&gt;</span>
<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> ItemsControlEx <span style="color: #008000;">:</span> ItemsControl
<span style="color: #008000;">{</span>
  <span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">void</span> PrepareContainerForItemOverride<span style="color: #008000;">(</span>DependencyObject element, <span style="color: #6666cc; font-weight: bold;">object</span> item<span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    <span style="color: #0600FF; font-weight: bold;">base</span><span style="color: #008000;">.</span><span style="color: #0000FF;">PrepareContainerForItemOverride</span><span style="color: #008000;">(</span>element, item<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
    OnPrepareContainerForItem<span style="color: #008000;">(</span><span style="color: #008000;">new</span> PrepareContainerForItemEventArgs<span style="color: #008000;">(</span>element, item<span style="color: #008000;">)</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  <span style="color: #008000;">}</span>
&nbsp;
  <span style="color: #008080; font-style: italic;">/// &lt;summary&gt;</span>
  <span style="color: #008080; font-style: italic;">/// Occurs when the PrepareContainerForItemOverride method is invoked</span>
  <span style="color: #008080; font-style: italic;">/// &lt;/summary&gt;</span>
  <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">event</span> EventHandler<span style="color: #008000;">&lt;</span>PrepareContainerForItemEventArgs<span style="color: #008000;">&gt;</span> PrepareContainerForItem<span style="color: #008000;">;</span>
&nbsp;
  <span style="color: #008080; font-style: italic;">/// &lt;summary&gt;</span>
  <span style="color: #008080; font-style: italic;">/// Raises the PrepareContainerForItem event.</span>
  <span style="color: #008080; font-style: italic;">/// &lt;/summary&gt;</span>
  <span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #6666cc; font-weight: bold;">void</span> OnPrepareContainerForItem<span style="color: #008000;">(</span>PrepareContainerForItemEventArgs args<span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">(</span>PrepareContainerForItem <span style="color: #008000;">!=</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">)</span>
    <span style="color: #008000;">{</span>
      PrepareContainerForItem<span style="color: #008000;">(</span><span style="color: #0600FF; font-weight: bold;">this</span>, args<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">}</span>
  <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span>
&nbsp;
<span style="color: #008080; font-style: italic;">/// &lt;summary&gt;</span>
<span style="color: #008080; font-style: italic;">/// Provides data for the PrepareContainerForItem event.</span>
<span style="color: #008080; font-style: italic;">/// &lt;/summary&gt;</span>
<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> PrepareContainerForItemEventArgs <span style="color: #008000;">:</span> EventArgs
<span style="color: #008000;">{</span>
  <span style="color: #0600FF; font-weight: bold;">public</span> PrepareContainerForItemEventArgs<span style="color: #008000;">(</span>DependencyObject element, <span style="color: #6666cc; font-weight: bold;">object</span> item<span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    Element <span style="color: #008000;">=</span> element<span style="color: #008000;">;</span>
    Item <span style="color: #008000;">=</span> item<span style="color: #008000;">;</span>
  <span style="color: #008000;">}</span>
&nbsp;
  <span style="color: #0600FF; font-weight: bold;">public</span> DependencyObject Element <span style="color: #008000;">{</span> <span style="color: #0600FF; font-weight: bold;">get</span><span style="color: #008000;">;</span> <span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #0600FF; font-weight: bold;">set</span><span style="color: #008000;">;</span> <span style="color: #008000;">}</span>
&nbsp;
  <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">object</span> Item <span style="color: #008000;">{</span> <span style="color: #0600FF; font-weight: bold;">get</span><span style="color: #008000;">;</span> <span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #0600FF; font-weight: bold;">set</span><span style="color: #008000;">;</span> <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>The <code>NavigationControl</code> locates the <code>ItemsControlEx</code> instance from its template to handle this event. Each time an element is added, handlers are added to various events:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">void</span> OnApplyTemplate<span style="color: #008000;">(</span><span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
  <span style="color: #0600FF; font-weight: bold;">base</span><span style="color: #008000;">.</span><span style="color: #0000FF;">OnApplyTemplate</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
  <span style="color: #0600FF; font-weight: bold;">var</span> itemsControl <span style="color: #008000;">=</span> GetTemplateChild<span style="color: #008000;">(</span><span style="color: #666666;">"itemsControl"</span><span style="color: #008000;">)</span> <span style="color: #0600FF; font-weight: bold;">as</span> ItemsControlEx<span style="color: #008000;">;</span>
  itemsControl<span style="color: #008000;">.</span><span style="color: #0000FF;">PrepareContainerForItem</span> <span style="color: #008000;">+=</span> ItemsControl_PrepareContainerForItem<span style="color: #008000;">;</span>
<span style="color: #008000;">}</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> ItemsControl_PrepareContainerForItem<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">object</span> sender, PrepareContainerForItemEventArgs e<span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
  <span style="color: #0600FF; font-weight: bold;">var</span> element <span style="color: #008000;">=</span> e<span style="color: #008000;">.</span><span style="color: #0000FF;">Element</span> <span style="color: #0600FF; font-weight: bold;">as</span> UIElement<span style="color: #008000;">;</span>
&nbsp;
  <span style="color: #008080; font-style: italic;">// handle events on the elements added to the ItemsControl</span>
  element<span style="color: #008000;">.</span><span style="color: #0000FF;">MouseLeftButtonUp</span> <span style="color: #008000;">+=</span> Element_MouseLeftButtonUp<span style="color: #008000;">;</span>
  element<span style="color: #008000;">.</span><span style="color: #0000FF;">ManipulationStarted</span> <span style="color: #008000;">+=</span> Element_ManipulationStarted<span style="color: #008000;">;</span>
  element<span style="color: #008000;">.</span><span style="color: #0000FF;">ManipulationDelta</span> <span style="color: #008000;">+=</span> Element_ManipulationDelta<span style="color: #008000;">;</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>The above could have been achieved without the use of <code>ItemsControlEx</code> by providing a container for each item that is added, much the same was as the <code>ListBox</code> contains items within a <code>ListBoxItem</code> instance. However, the aim here is to make the control as lightweight as possible, which means minimizing the number of visual elements created.</p><p>The <code>Element_MouseLeftButtonUp</code> event handler raises the <code>Navigation</code> event, but what are the manipulation event handlers for? This is because if the <code>NavigationList</code> is used within a control that performs some action due to manipulation, the <code>Pivot</code> control which reacts to swipe for example, a mouse up event is still fired when the manipulation ends. This results in a navigation firing incorrectly, see <a href="http://mindre.net/Article/windows_phone_7__mouseleftbuttonup_event_inside_a_pivot">Tore Lervik’s blog</a> for more details.</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">bool</span> _manipulationDeltaStarted<span style="color: #008000;">;</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> Element_ManipulationDelta<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">object</span> sender, ManipulationDeltaEventArgs e<span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
  _manipulationDeltaStarted <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">;</span>
<span style="color: #008000;">}</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> Element_ManipulationStarted<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">object</span> sender, ManipulationStartedEventArgs e<span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
  _manipulationDeltaStarted <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">false</span><span style="color: #008000;">;</span>
<span style="color: #008000;">}</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> Element_MouseLeftButtonUp<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">object</span> sender, MouseButtonEventArgs e<span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
  <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">(</span>_manipulationDeltaStarted<span style="color: #008000;">)</span>
    <span style="color: #0600FF; font-weight: bold;">return</span><span style="color: #008000;">;</span>
&nbsp;
  <span style="color: #008080; font-style: italic;">// raises the Navigation event on mouse up, but only if a manipulation delta</span>
  <span style="color: #008080; font-style: italic;">// has not started.            </span>
  <span style="color: #0600FF; font-weight: bold;">var</span> element <span style="color: #008000;">=</span> sender <span style="color: #0600FF; font-weight: bold;">as</span> FrameworkElement<span style="color: #008000;">;</span>
  OnNavigation<span style="color: #008000;">(</span><span style="color: #008000;">new</span> NavigationEventArgs<span style="color: #008000;">(</span>element<span style="color: #008000;">.</span><span style="color: #0000FF;">DataContext</span><span style="color: #008000;">)</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>So there you have it, the <code>NavigationList</code>, simple and fast.</p><p>Now people … <strong>please stop using <code>ListBox</code> for navigation</strong>, it is slow and it’s API is cumbersome!</p><p>You can download the sourcecode here:<a href="{{ site.url }}/blog/colin/wp-content/uploads/2011/04/NavigationListControl.zip">NavigationListControl.zip</a></p><p>Regards, Colin E.</p></div>