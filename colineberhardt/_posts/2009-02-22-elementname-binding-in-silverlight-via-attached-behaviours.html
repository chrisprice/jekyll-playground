---
author: Colin Eberhardt
tags: attached behaviour, binding, silverlight
permalink: /blog/colin/2009/02/elementname-binding-in-silverlight-via-attached-behaviours/index.html
layout: colineberhardt-blog
---
<div class="entry"><div class="topsy_widget_data topsy_theme_light-green" style="float: right; margin-left: 0.75em; background: url(data:,%7B%20%22url%22%3A%20%22http%253A%252F%252Fwww.scottlogic.co.uk%252Fblog%252Fcolin%252F2009%252F02%252Felementname-binding-in-silverlight-via-attached-behaviours%252F%22%2C%20%22style%22%3A%20%22big%22%2C%20%22title%22%3A%20%22ElementName%20binding%20in%20Silverlight%20via%20Attached%20Behaviours%20%23%22%20%7D);"></div><p>As a relative newcomer to Silverlight I was happily greeted by the warm feeling of familiarity when I started developing. It is surprisingly easy to make the transition from WPF to Silverlight developer, with most of the core concepts being just the same. However, there are some parts of the WPF framework that you start to miss. One of those is ElementName binding. </p><p>For those of you not familiar with the concept I will give a very brief overview. When binding the properties of your visual elements within XAML, the source of this binding will be the object associated with the elements DataContext. This works just fine for binding your business objects to the UI that exposes their properties. However, with WPF, binding gives you so much more than just a mechanism for exposing your business data, it also allows you to bind properties between visual elements. This is a powerful concept that allows you to create complex layouts, beyond that which is possible by the framework provided Panels (for some examples of this, see my article on creating a <a href="http://www.codeproject.com/KB/WPF/WpfWinFormsBulletGraphs.aspx">Bullet Graph</a>). In order to enable this, WPF provides ElementName and RelativeSource bindings, giving you a powerful mechanism for locating other elements within your visual tree to bind to. A simple example, where a rectangle’s Width is bound to a named slider is given below:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Rectangle</span> <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">"{Binding Path=Value, ElementName=MySlider}"</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"20"</span> <span style="color: #000066;">Fill</span>=<span style="color: #ff0000;">"Green"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Slider</span> <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">"MySlider"</span> <span style="color: #000066;">Value</span>=<span style="color: #ff0000;">"25"</span> <span style="color: #000066;">Minimum</span>=<span style="color: #ff0000;">"0"</span> <span style="color: #000066;">Maximum</span>=<span style="color: #ff0000;">"300"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span></pre></td></tr></table></div><p>Unfortunately Silverlight does not have this capability. </p><p>My first thought was to simply point the DataContext of the target element to the source element in order to allow property binding between them. However, much to my surprise, Silverlight dependency properties <a href="http://silverlight.net/forums/p/20783/72428.aspx">do not support property changed notification</a>. </p><p>A common solution to this problem is to employ a Relay Object, as described in <a href="http://www.thejoyofcode.com/Workaround_for_missing_ElementName_in_Silverlight_2_0_Binding.aspx">a number of blog posts</a>. An object with a single property, Value, which implement INotifyPropertyChanged is bound to the two visual elements. A simple example is illustrated below:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;UserControl.Resources<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:RelayObject</span> <span style="color: #000066;">x:Key</span>=<span style="color: #ff0000;">"Relay"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>        
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:RelayObject.Value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;system:Double<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>20<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/system:Double<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:RelayObject.Value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:RelayObject<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/UserControl.Resources<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;StackPanel</span> <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">"LayoutRoot"</span> <span style="color: #000066;">Background</span>=<span style="color: #ff0000;">"White"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Rectangle</span> <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">"{Binding Path=Value, Source={StaticResource Relay}, Mode=TwoWay"</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"20"</span> <span style="color: #000066;">Fill</span>=<span style="color: #ff0000;">"Green"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Slider</span> <span style="color: #000066;">Value</span>=<span style="color: #ff0000;">"{Binding Path=Value, Source={StaticResource Relay}, Mode=TwoWay}"</span> <span style="color: #000066;">Minimum</span>=<span style="color: #ff0000;">"0"</span> <span style="color: #000066;">Maximum</span>=<span style="color: #ff0000;">"300"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>       
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/StackPanel<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>Here an instance of our RelayObject is bound to both the Rectangle’s Width and the Slider’s Value, effectively binding these to properties together. This works just fine, however it does not really feel like the WPF ElementName binding, furthermore, you have to add a new RelayObject instance for each binding. </p><p>My solution makes use of the <a href="http://www.codeproject.com/KB/WPF/AttachedBehaviors.aspx">Attached Behaviour</a> pattern which is becoming very popular in WPF and Silverlight. First we define an attached property which uses a type which contains the information we need to create our binding, i.e source and target properties, and the name of the element which we wish to bind to.</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> BindingProperties
<span style="color: #008000;">{</span>
    <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">string</span> SourceProperty <span style="color: #008000;">{</span> <span style="color: #0600FF; font-weight: bold;">get</span><span style="color: #008000;">;</span> <span style="color: #0600FF; font-weight: bold;">set</span><span style="color: #008000;">;</span> <span style="color: #008000;">}</span>
    <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">string</span> ElementName <span style="color: #008000;">{</span> <span style="color: #0600FF; font-weight: bold;">get</span><span style="color: #008000;">;</span> <span style="color: #0600FF; font-weight: bold;">set</span><span style="color: #008000;">;</span> <span style="color: #008000;">}</span>
    <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">string</span> TargetProperty <span style="color: #008000;">{</span> <span style="color: #0600FF; font-weight: bold;">get</span><span style="color: #008000;">;</span> <span style="color: #0600FF; font-weight: bold;">set</span><span style="color: #008000;">;</span> <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #6666cc; font-weight: bold;">class</span> BindingHelper
<span style="color: #008000;">{</span>
    <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">static</span> BindingProperties GetBinding<span style="color: #008000;">(</span>DependencyObject obj<span style="color: #008000;">)</span>
    <span style="color: #008000;">{</span>
        <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #008000;">(</span>BindingProperties<span style="color: #008000;">)</span>obj<span style="color: #008000;">.</span><span style="color: #0000FF;">GetValue</span><span style="color: #008000;">(</span>BindingProperty<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">}</span>
&nbsp;
    <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #6666cc; font-weight: bold;">void</span> SetBinding<span style="color: #008000;">(</span>DependencyObject obj, BindingProperties <span style="color: #0600FF; font-weight: bold;">value</span><span style="color: #008000;">)</span>
    <span style="color: #008000;">{</span>
        obj<span style="color: #008000;">.</span><span style="color: #0000FF;">SetValue</span><span style="color: #008000;">(</span>BindingProperty, <span style="color: #0600FF; font-weight: bold;">value</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">}</span>
&nbsp;
    <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #0600FF; font-weight: bold;">readonly</span> DependencyProperty BindingProperty <span style="color: #008000;">=</span>
        DependencyProperty<span style="color: #008000;">.</span><span style="color: #0000FF;">RegisterAttached</span><span style="color: #008000;">(</span><span style="color: #666666;">"Binding"</span>, <span style="color: #008000;">typeof</span><span style="color: #008000;">(</span>BindingProperties<span style="color: #008000;">)</span>, <span style="color: #008000;">typeof</span><span style="color: #008000;">(</span>BindingHelper<span style="color: #008000;">)</span>,
        <span style="color: #008000;">new</span> PropertyMetadata<span style="color: #008000;">(</span><span style="color: #0600FF; font-weight: bold;">null</span>, OnBinding<span style="color: #008000;">)</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
&nbsp;
    <span style="color: #008080; font-style: italic;">/// &lt;summary&gt;</span>
    <span style="color: #008080; font-style: italic;">/// property change event handler for SelectAllButtonTemplate</span>
    <span style="color: #008080; font-style: italic;">/// &lt;/summary&gt;</span>
    <span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #6666cc; font-weight: bold;">void</span> OnBinding<span style="color: #008000;">(</span>
        DependencyObject depObj, DependencyPropertyChangedEventArgs e<span style="color: #008000;">)</span>
    <span style="color: #008000;">{</span>
        FrameworkElement targetElement <span style="color: #008000;">=</span> depObj <span style="color: #0600FF; font-weight: bold;">as</span> FrameworkElement<span style="color: #008000;">;</span>
&nbsp;
        targetElement<span style="color: #008000;">.</span><span style="color: #0000FF;">Loaded</span> <span style="color: #008000;">+=</span> <span style="color: #008000;">new</span> RoutedEventHandler<span style="color: #008000;">(</span>TargetElement_Loaded<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">}</span>
&nbsp;
    <span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #6666cc; font-weight: bold;">void</span> TargetElement_Loaded<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">object</span> sender, RoutedEventArgs e<span style="color: #008000;">)</span>
    <span style="color: #008000;">{</span>
        FrameworkElement targetElement <span style="color: #008000;">=</span> sender <span style="color: #0600FF; font-weight: bold;">as</span> FrameworkElement<span style="color: #008000;">;</span>
&nbsp;
        <span style="color: #008080; font-style: italic;">// get the value of our attached property</span>
        BindingProperties bindingProperties <span style="color: #008000;">=</span> GetBinding<span style="color: #008000;">(</span>targetElement<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
        <span style="color: #008080; font-style: italic;">// perform our 'ElementName' lookup</span>
        FrameworkElement sourceElement <span style="color: #008000;">=</span> targetElement<span style="color: #008000;">.</span><span style="color: #0000FF;">FindName</span><span style="color: #008000;">(</span>bindingProperties<span style="color: #008000;">.</span><span style="color: #0000FF;">ElementName</span><span style="color: #008000;">)</span> <span style="color: #0600FF; font-weight: bold;">as</span> FrameworkElement<span style="color: #008000;">;</span>
&nbsp;
        <span style="color: #008080; font-style: italic;">// bind them</span>
        CreateRelayBinding<span style="color: #008000;">(</span>targetElement, sourceElement, bindingProperties<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">}</span>    
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>What the above code does is it defines the attached property of type BindingProperties. The OnBinding method is invoked whenever this property is attached to a dependency object. Within this event handler, we add a handler to the element’s Loaded event. This event occurs when the element is laid out within the visual tree and ready for action, it is at this point that we can perform our ElementName lookup.</p><p>Within the TargetElement_Loaded event handler we use the <a href="http://msdn.microsoft.com/en-us/library/system.windows.frameworkelement.findname(VS.95).aspx">FrameworkElement.FindName</a> to look-up the named source element for our binding. This method locates any element with the given name that is within the same <a href="http://msdn.microsoft.com/en-us/library/cc189026(VS.95).aspx">XAML namescope</a> as itself. Interestingly, this is the same method that Visual Studio uses for creating member variables within your code-behind file from the named elements within your XAML. Once, the named element has been located, a relay binding is constructed between them, as follows:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #0600FF; font-weight: bold;">readonly</span> BindingFlags dpFlags <span style="color: #008000;">=</span> BindingFlags<span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Public</span> <span style="color: #008000;">|</span> BindingFlags<span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Static</span> <span style="color: #008000;">|</span> BindingFlags<span style="color: #008000;">.</span><span style="color: #0000FF;">FlattenHierarchy</span><span style="color: #008000;">;</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #6666cc; font-weight: bold;">void</span> CreateRelayBinding<span style="color: #008000;">(</span>FrameworkElement targetElement, FrameworkElement sourceElement,
    <span style="color: #6666cc; font-weight: bold;">string</span> targetProperty, <span style="color: #6666cc; font-weight: bold;">string</span> sourceProperty, IValueConverter converter<span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
     <span style="color: #008080; font-style: italic;">// create a relay binding between the two elements</span>
     ValueObject relayObject <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> ValueObject<span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
     <span style="color: #008080; font-style: italic;">// find the source dependency property</span>
     FieldInfo<span style="color: #008000;">[</span><span style="color: #008000;">]</span> sourceFields <span style="color: #008000;">=</span> sourceElement<span style="color: #008000;">.</span><span style="color: #0000FF;">GetType</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">.</span><span style="color: #0000FF;">GetFields</span><span style="color: #008000;">(</span>dpFlags<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
     FieldInfo sourceDependencyPropertyField <span style="color: #008000;">=</span> sourceFields<span style="color: #008000;">.</span><span style="color: #0000FF;">First</span><span style="color: #008000;">(</span>i <span style="color: #008000;">=&gt;</span> i<span style="color: #008000;">.</span><span style="color: #0000FF;">Name</span> <span style="color: #008000;">==</span> sourceProperty <span style="color: #008000;">+</span> <span style="color: #666666;">"Property"</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
     DependencyProperty sourceDependencyProperty <span style="color: #008000;">=</span> sourceDependencyPropertyField<span style="color: #008000;">.</span><span style="color: #0000FF;">GetValue</span><span style="color: #008000;">(</span><span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">)</span> <span style="color: #0600FF; font-weight: bold;">as</span> DependencyProperty<span style="color: #008000;">;</span>
&nbsp;
     <span style="color: #008080; font-style: italic;">// initialise the relay object with the source dependency property value </span>
     relayObject<span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Value</span> <span style="color: #008000;">=</span> sourceElement<span style="color: #008000;">.</span><span style="color: #0000FF;">GetValue</span><span style="color: #008000;">(</span>sourceDependencyProperty<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
     <span style="color: #008080; font-style: italic;">// create the binding for our target element to the relay object, this binding will</span>
     <span style="color: #008080; font-style: italic;">// include the value converter</span>
     Binding targetToRelay <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> Binding<span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
     targetToRelay<span style="color: #008000;">.</span><span style="color: #0000FF;">Source</span> <span style="color: #008000;">=</span> relayObject<span style="color: #008000;">;</span>
     targetToRelay<span style="color: #008000;">.</span><span style="color: #0000FF;">Path</span> <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> PropertyPath<span style="color: #008000;">(</span><span style="color: #666666;">"Value"</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
     targetToRelay<span style="color: #008000;">.</span><span style="color: #0000FF;">Mode</span> <span style="color: #008000;">=</span> BindingMode<span style="color: #008000;">.</span><span style="color: #0000FF;">TwoWay</span><span style="color: #008000;">;</span>
     targetToRelay<span style="color: #008000;">.</span><span style="color: #0000FF;">Converter</span> <span style="color: #008000;">=</span> converter<span style="color: #008000;">;</span>
&nbsp;
     <span style="color: #008080; font-style: italic;">// find the target dependency property</span>
     FieldInfo<span style="color: #008000;">[</span><span style="color: #008000;">]</span> targetFields <span style="color: #008000;">=</span> targetElement<span style="color: #008000;">.</span><span style="color: #0000FF;">GetType</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">.</span><span style="color: #0000FF;">GetFields</span><span style="color: #008000;">(</span>dpFlags<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
     FieldInfo targetDependencyPropertyField <span style="color: #008000;">=</span> targetFields<span style="color: #008000;">.</span><span style="color: #0000FF;">First</span><span style="color: #008000;">(</span>i <span style="color: #008000;">=&gt;</span> i<span style="color: #008000;">.</span><span style="color: #0000FF;">Name</span> <span style="color: #008000;">==</span> targetProperty <span style="color: #008000;">+</span> <span style="color: #666666;">"Property"</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
     DependencyProperty targetDependencyProperty <span style="color: #008000;">=</span> targetDependencyPropertyField<span style="color: #008000;">.</span><span style="color: #0000FF;">GetValue</span><span style="color: #008000;">(</span><span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">)</span> <span style="color: #0600FF; font-weight: bold;">as</span> DependencyProperty<span style="color: #008000;">;</span>
&nbsp;
     <span style="color: #008080; font-style: italic;">// set the binding on our target element</span>
     targetElement<span style="color: #008000;">.</span><span style="color: #0000FF;">SetBinding</span><span style="color: #008000;">(</span>targetDependencyProperty, targetToRelay<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
     <span style="color: #008080; font-style: italic;">// create the binding for our source element to the relay object</span>
     Binding sourceToRelay <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> Binding<span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
     sourceToRelay<span style="color: #008000;">.</span><span style="color: #0000FF;">Source</span> <span style="color: #008000;">=</span> relayObject<span style="color: #008000;">;</span>
     sourceToRelay<span style="color: #008000;">.</span><span style="color: #0000FF;">Path</span> <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> PropertyPath<span style="color: #008000;">(</span><span style="color: #666666;">"Value"</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
     sourceToRelay<span style="color: #008000;">.</span><span style="color: #0000FF;">Mode</span> <span style="color: #008000;">=</span> BindingMode<span style="color: #008000;">.</span><span style="color: #0000FF;">TwoWay</span><span style="color: #008000;">;</span>
&nbsp;
     <span style="color: #008080; font-style: italic;">// set the binding on our source element</span>
     sourceElement<span style="color: #008000;">.</span><span style="color: #0000FF;">SetBinding</span><span style="color: #008000;">(</span>sourceDependencyProperty, sourceToRelay<span style="color: #008000;">)</span><span style="color: #008000;">;</span>        
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>The above code simply creates our relay object, initialising its value from the sourtce element, then constructs the bindings from relay-to-source and relay-to-target. The only ‘tricky’ part of the above code is the use of reflection to locate the static dependency properties of each element.</p><p>Using the above attached property (behaviour), an element name binding can be constructed as follows:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Rectangle</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"20"</span> <span style="color: #000066;">Fill</span>=<span style="color: #ff0000;">"Green"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:BindingHelper.Binding<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:BindingProperties</span> <span style="color: #000066;">ElementName</span>=<span style="color: #ff0000;">"Slider"</span> <span style="color: #000066;">SourceProperty</span>=<span style="color: #ff0000;">"Value"</span> <span style="color: #000066;">TargetProperty</span>=<span style="color: #ff0000;">"Width"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:BindingHelper.Binding<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Rectangle<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Slider</span> <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">"Slider"</span> <span style="color: #000066;">Value</span>=<span style="color: #ff0000;">"20"</span> <span style="color: #000066;">Minimum</span>=<span style="color: #ff0000;">"0"</span> <span style="color: #000066;">Maximum</span>=<span style="color: #ff0000;">"300"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span></pre></td></tr></table></div><p>The advantages of this approach are twofold, firstly, we do not have to explicitly create a relay object for each ElementName bindings, secondly, the source property value is used to initialise the relay object directly. It is also straightforward exercise to extend the above to add ValueConverters into the binding. </p><p>But what if we want to bind two different properties to our slider? If for example we want to bind the Widths of two rectangles, we would need to ensure that a single relay object is constructed which is shared by the Slider and both Rectangles. A simple solution to this problem is to maintain a dictionary of the source bindings to their associated relay objects. If we bind more than one target property to a particular source property, the relay object is re-used. Any value converters are specified on the target binding, therefore we can bind multiple properties to the source with different converters.</p><p>The following example shows a couple of Rectangles bound to our slider where their Widths are scaled by different factors:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Rectangle</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"20"</span> <span style="color: #000066;">Fill</span>=<span style="color: #ff0000;">"Green"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:BindingHelper.Binding<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:BindingProperties</span> <span style="color: #000066;">ElementName</span>=<span style="color: #ff0000;">"Slider"</span> <span style="color: #000066;">SourceProperty</span>=<span style="color: #ff0000;">"Value"</span></span>
<span style="color: #009900;">            <span style="color: #000066;">TargetProperty</span>=<span style="color: #ff0000;">"Width"</span> <span style="color: #000066;">Converter</span>=<span style="color: #ff0000;">"{StaticResource ScalingConverter}"</span> <span style="color: #000066;">ConverterParameter</span>=<span style="color: #ff0000;">"2"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:BindingHelper.Binding<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Rectangle<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Rectangle</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"20"</span> <span style="color: #000066;">Fill</span>=<span style="color: #ff0000;">"Green"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:BindingHelper.Binding<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:BindingProperties</span> <span style="color: #000066;">ElementName</span>=<span style="color: #ff0000;">"Slider"</span> <span style="color: #000066;">SourceProperty</span>=<span style="color: #ff0000;">"Value"</span></span>
<span style="color: #009900;">            <span style="color: #000066;">TargetProperty</span>=<span style="color: #ff0000;">"Width"</span> <span style="color: #000066;">Converter</span>=<span style="color: #ff0000;">"{StaticResource ScalingConverter}"</span> <span style="color: #000066;">ConverterParameter</span>=<span style="color: #ff0000;">"4"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:BindingHelper.Binding<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Rectangle<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Slider</span> <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">"Slider"</span> <span style="color: #000066;">Value</span>=<span style="color: #ff0000;">"20"</span> <span style="color: #000066;">Minimum</span>=<span style="color: #ff0000;">"0"</span> <span style="color: #000066;">Maximum</span>=<span style="color: #ff0000;">"300"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span></pre></td></tr></table></div><p>And here is a demonstration of the above implemented both manually with relay objects and with this attached behaviour:</p><div id="slPluginHost"> <object id="SilverlightPlugin" width="400" height="200" data="data:application/x-silverlight," type="application/x-silverlight-2"><param name="source" value="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2009/02/silverlightbinding.xap" /><a href="http://go.microsoft.com/fwlink/?LinkID=124807" style="text-decoration: none;"> <img src="http://go.microsoft.com/fwlink/?LinkId=108181" alt="Get Microsoft Silverlight" style="border-style: none;" /></a></object></div><p>For details of the above, please refer to the attached <a href="{{ site.url }}/blog/colin/wp-content/uploads/2009/02/silverlightelementnamebinding.zip">project download</a>.</p><p>This approch does have a few downsides – unfortunately the syntax is a little verbose. Also, in its present form you can only create on element name binding per visual element. However, the interesting feature of this technique is that it could be readily adapted to search for the source element in other ways, for example emulating the WPF relative source bindings. Perhaps I will have a go at that one next week ….</p><p>You can download the <a href="{{ site.url }}/blog/colin/wp-content/uploads/2009/02/silverlightelementnamebinding.zip">sourcecode</a> for this blog post.</p></div>