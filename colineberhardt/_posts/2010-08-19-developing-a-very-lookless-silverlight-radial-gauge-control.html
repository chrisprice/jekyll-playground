---
author: Colin Eberhardt
tags: attached behaviour, attached view model, multibinding
permalink: /blog/colin/2010/08/developing-a-very-lookless-silverlight-radial-gauge-control/index.html
layout: colineberhardt-blog
---
<div class="entry"><div class="topsy_widget_data topsy_theme_light-green" style="float: right; margin-left: 0.75em; background: url(data:,%7B%20%22url%22%3A%20%22http%253A%252F%252Fwww.scottlogic.co.uk%252Fblog%252Fcolin%252F2010%252F08%252Fdeveloping-a-very-lookless-silverlight-radial-gauge-control%252F%22%2C%20%22style%22%3A%20%22big%22%2C%20%22title%22%3A%20%22Developing%20a%20%28very%29%20Lookless%20Silverlight%20Radial%20Gauge%20Control%20%23%22%20%7D);"></div><p><em>This blog post describes the development of a lookless radial gauge control. In this post I will explore the use of an attached view model in order to move view specific properties and logic out of the control code in order to give a truly lookless control.</em></p><p>Today I had to get up far too early in order to catch an early morning flight to Copenhagen with a connection in Amsterdam. What to do for the six hours I would be travelling? Armed with a netbook and Visual Studio 2010 Express I thought it would be fun to have a go at developing a Silverlight gauge control. I know that there are already one or two free ones out there, with <a href="http://www.codeproject.com/KB/silverlight/circulargaugecontrol.aspx">a decent looking one available on codeproject</a>, however, it still felt like a good way to pass the time!</p><p>In order to make things a little more challenging I wanted to create a control that was truly lookless. So, what do I mean by this? Firstly a gauge control in its simplest sense displays the location of some indicator between a maximum and minimum value. There is nothing inherently circular about a gauge, thermometers are a good example of a linear gauge. So, I don’t want any ‘circular’ logic in the control itself. Secondly, custom controls often have certain expectations about the presence of named elements within their template. By this I mean that the template must contain, for example, a Path element called ‘needle’ which the control code will manipulate (The gauge published in the codeproject article above requires the presence of four named elements in the template). This forces certain constraints regarding how the control can be templated, this isn’t really lookless is it?</p><p>The following example shows the gauge control which I created, and the rest of this post describes the implementation:</p><div><object width="300" height="300" data="data:application/x-silverlight," type="application/x-silverlight-2"><param name="source" value="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2010/08/GaugeControlOne.xap" /><a href="http://go.microsoft.com/fwlink/?LinkID=124807" style="text-decoration: none;"> <img src="http://go.microsoft.com/fwlink/?LinkId=108181" alt="Get Microsoft Silverlight" style="border-style: none;" /></a></object></div><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:GaugeControl</span> <span style="color: #000066;">Value</span>=<span style="color: #ff0000;">"65"</span> <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">"200"</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"200"</span>  </span>
<span style="color: #009900;">                    <span style="color: #000066;">Maximum</span>=<span style="color: #ff0000;">"100"</span> <span style="color: #000066;">Minimum</span>=<span style="color: #ff0000;">"50"</span></span>
<span style="color: #009900;">                    <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">"gauge"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:GaugeControl.QualitativeRange<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:QualitativeRanges<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:QualitativeRange</span> <span style="color: #000066;">Color</span>=<span style="color: #ff0000;">"Yellow"</span> <span style="color: #000066;">Maximum</span>=<span style="color: #ff0000;">"75"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:QualitativeRange</span> <span style="color: #000066;">Color</span>=<span style="color: #ff0000;">"Orange"</span> <span style="color: #000066;">Maximum</span>=<span style="color: #ff0000;">"90"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:QualitativeRange</span> <span style="color: #000066;">Color</span>=<span style="color: #ff0000;">"Red"</span> <span style="color: #000066;">Maximum</span>=<span style="color: #ff0000;">"100"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:QualitativeRanges<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:GaugeControl.QualitativeRange<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:GaugeControl<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><h2>The Starting Point</h2><p>The first step was to create a Gauge custom control with Value, Maximum and Minimum dependency properties. The only logic defined within the control itself is to set the DataContext of the root visual element to the control instance itself. This is quite a common approach to control design, allowing elements within the template to bind to the control properties:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">void</span> OnApplyTemplate<span style="color: #008000;">(</span><span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
  <span style="color: #0600FF; font-weight: bold;">base</span><span style="color: #008000;">.</span><span style="color: #0000FF;">OnApplyTemplate</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
  Grid root <span style="color: #008000;">=</span> GetTemplateChild<span style="color: #008000;">(</span><span style="color: #666666;">"LayoutRoot"</span><span style="color: #008000;">)</span> <span style="color: #0600FF; font-weight: bold;">as</span> Grid<span style="color: #008000;">;</span>
  root<span style="color: #008000;">.</span><span style="color: #0000FF;">DataContext</span> <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">this</span><span style="color: #008000;">;</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>The first thing I added to the control template was the ‘face’ of the radial gauge. This is simply an Ellipse with a pretty gradient fill and stroke:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #808080; font-style: italic;">&lt;!-- dial background and outer border --&gt;</span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Ellipse</span> <span style="color: #000066;">Stretch</span>=<span style="color: #ff0000;">"Fill"</span> <span style="color: #000066;">StrokeThickness</span>=<span style="color: #ff0000;">"8"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Ellipse.Fill<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;RadialGradientBrush</span> <span style="color: #000066;">Center</span>=<span style="color: #ff0000;">"0.5,0.5"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;GradientStop</span> <span style="color: #000066;">Color</span>=<span style="color: #ff0000;">"#EEF"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;GradientStop</span> <span style="color: #000066;">Color</span>=<span style="color: #ff0000;">"#99B"</span> <span style="color: #000066;">Offset</span>=<span style="color: #ff0000;">"0.9"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;GradientStop</span> <span style="color: #000066;">Color</span>=<span style="color: #ff0000;">"#335"</span> <span style="color: #000066;">Offset</span>=<span style="color: #ff0000;">"1"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/RadialGradientBrush<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Ellipse.Fill<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Ellipse.Stroke<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;LinearGradientBrush</span> <span style="color: #000066;">StartPoint</span>=<span style="color: #ff0000;">"0,0"</span> <span style="color: #000066;">EndPoint</span>=<span style="color: #ff0000;">"0,1"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;GradientStop</span> <span style="color: #000066;">Color</span>=<span style="color: #ff0000;">"#BBD"</span> <span style="color: #000066;">Offset</span>=<span style="color: #ff0000;">"0"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;GradientStop</span> <span style="color: #000066;">Color</span>=<span style="color: #ff0000;">"#003"</span> <span style="color: #000066;">Offset</span>=<span style="color: #ff0000;">"1"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/LinearGradientBrush<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Ellipse.Stroke<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Ellipse<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p><img src="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2010/08/face.jpg" alt="" title="face" width="222" height="207" class="aligncenter size-full wp-image-765" /></p><h2>Adding the Needle</h2><p>The next thing I added to the control was a needle. This is rendered using a simple Path with a LinearGradient in order to give it some sense of depth. I want the needle to have a length of approximately 70% of the gauge’s radius, a simple way to achieve this is to construct it within a Grid that uses ‘star’ widths / heights to provide a proportional layout and configure the Path to stretch to fill the cell it occupies:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #808080; font-style: italic;">&lt;!-- the needle path --&gt;</span>              
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid.RowDefinitions<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;RowDefinition</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"3*"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;RowDefinition</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"7*"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;RowDefinition</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"10*"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid.RowDefinitions<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid.ColumnDefinitions<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ColumnDefinition</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ColumnDefinition</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid.ColumnDefinitions<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Path</span> <span style="color: #000066;">Stretch</span>=<span style="color: #ff0000;">"Uniform"</span></span>
<span style="color: #009900;">      <span style="color: #000066;">Grid.Row</span>=<span style="color: #ff0000;">"1"</span> <span style="color: #000066;">Grid.ColumnSpan</span>=<span style="color: #ff0000;">"2"</span></span>
<span style="color: #009900;">      <span style="color: #000066;">HorizontalAlignment</span>=<span style="color: #ff0000;">"Center"</span></span>
<span style="color: #009900;">      <span style="color: #000066;">Stroke</span>=<span style="color: #ff0000;">"Black"</span> <span style="color: #000066;">StrokeThickness</span>=<span style="color: #ff0000;">"0.5"</span></span>
<span style="color: #009900;">      <span style="color: #000066;">Data</span>=<span style="color: #ff0000;">"M 0,0 l 10,60 l -10, 40 l -10 -40"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Path.Fill<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;LinearGradientBrush</span> <span style="color: #000066;">StartPoint</span>=<span style="color: #ff0000;">"0,0"</span> <span style="color: #000066;">EndPoint</span>=<span style="color: #ff0000;">"1,0"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;GradientStop</span> <span style="color: #000066;">Color</span>=<span style="color: #ff0000;">"DarkRed"</span> <span style="color: #000066;">Offset</span>=<span style="color: #ff0000;">"0"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;GradientStop</span> <span style="color: #000066;">Color</span>=<span style="color: #ff0000;">"DarkRed"</span> <span style="color: #000066;">Offset</span>=<span style="color: #ff0000;">"0.45"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;GradientStop</span> <span style="color: #000066;">Color</span>=<span style="color: #ff0000;">"Red"</span> <span style="color: #000066;">Offset</span>=<span style="color: #ff0000;">"0.55"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;GradientStop</span> <span style="color: #000066;">Color</span>=<span style="color: #ff0000;">"Red"</span> <span style="color: #000066;">Offset</span>=<span style="color: #ff0000;">"1"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/LinearGradientBrush<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Path.Fill<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Path<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>Here you can see how the needle is scaled by its parent Grid:</p><p><img src="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2010/08/needle.jpg" alt="" title="needle" width="237" height="232" class="aligncenter size-full wp-image-768" /></p><p>Rotating the needle to reflect the current Gauge Value is achieved quite simply via RotateTransform. However, this needs to be converted into a rotation angle which depends on the Gauge Maximum /Minimum values together with the overall angle of sweep on the gauge. I initially approach this problem by applying bindings via value converters and <a href="{{ site.url }}/blog/colin/2010/08/silverlight-multibinding-updated-adding-support-for-elementname-and-twoway-binding/">multibindings</a>, however I found myself repeating the same conversion logic in numerous places within the template in order to render the ticks etc… Ideally the angle of rotation would be something that the template could bind to. The template DataContext is bound to the Gauge control itself, however as stated earlier I do not want ‘circular’ concepts to leak into the control.</p><h2>An attached View Model</h2><p>The solution I came up with for this problem was to create a view model that lives entirely within the control template that acts as an adapter for the Gauge, supplementing its properties with the needed ‘circular’ concepts. In keeping with my aims I could not instantiate this view model within the Gauge control itself, so instead it is created via an attached behaviour within the control template:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Style</span> <span style="color: #000066;">TargetType</span>=<span style="color: #ff0000;">"local:GaugeControl"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Setter</span> <span style="color: #000066;">Property</span>=<span style="color: #ff0000;">"FontSize"</span> <span style="color: #000066;">Value</span>=<span style="color: #ff0000;">"10"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Setter</span> <span style="color: #000066;">Property</span>=<span style="color: #ff0000;">"Template"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Setter.Value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ControlTemplate</span> <span style="color: #000066;">TargetType</span>=<span style="color: #ff0000;">"local:GaugeControl"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid</span> <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">"LayoutRoot"</span> <span style="color: #000000; font-weight: bold;">&gt;</span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #808080; font-style: italic;">&lt;!-- attached the view model --&gt;</span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:RadialGaugeControlViewModel.Attach<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
              <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:RadialGaugeControlViewModel</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:RadialGaugeControlViewModel.Attach<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
            <span style="color: #808080; font-style: italic;">&lt;!-- ... control template goes here ...  --&gt;</span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ControlTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Setter.Value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Setter<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Style<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>The view model defines the Attach property and in its change handler performs the logic required to bind to the DatatContext of the parent (which is the Gauge control itself), and set itself as the DataContext of the Grid to which it is being attached. This allows the rest of the template to bind to properties of the RadialGaugeControlViewModel.</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> RadialGaugeControlViewModel <span style="color: #008000;">:</span> FrameworkElement, INotifyPropertyChanged
<span style="color: #008000;">{</span>
  <span style="color: #008080;">#region Attach attached property</span>
&nbsp;
  <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #0600FF; font-weight: bold;">readonly</span> DependencyProperty AttachProperty <span style="color: #008000;">=</span>
      DependencyProperty<span style="color: #008000;">.</span><span style="color: #0000FF;">RegisterAttached</span><span style="color: #008000;">(</span><span style="color: #666666;">"Attach"</span>, <span style="color: #008000;">typeof</span><span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">object</span><span style="color: #008000;">)</span>, <span style="color: #008000;">typeof</span><span style="color: #008000;">(</span>RadialGaugeControlViewModel<span style="color: #008000;">)</span>,
          <span style="color: #008000;">new</span> PropertyMetadata<span style="color: #008000;">(</span><span style="color: #0600FF; font-weight: bold;">null</span>, <span style="color: #008000;">new</span> PropertyChangedCallback<span style="color: #008000;">(</span>OnAttachChanged<span style="color: #008000;">)</span><span style="color: #008000;">)</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
  <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">static</span> RadialGaugeControlViewModel GetAttach<span style="color: #008000;">(</span>DependencyObject d<span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #008000;">(</span>RadialGaugeControlViewModel<span style="color: #008000;">)</span>d<span style="color: #008000;">.</span><span style="color: #0000FF;">GetValue</span><span style="color: #008000;">(</span>AttachProperty<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  <span style="color: #008000;">}</span>
&nbsp;
  <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #6666cc; font-weight: bold;">void</span> SetAttach<span style="color: #008000;">(</span>DependencyObject d, RadialGaugeControlViewModel <span style="color: #0600FF; font-weight: bold;">value</span><span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    d<span style="color: #008000;">.</span><span style="color: #0000FF;">SetValue</span><span style="color: #008000;">(</span>AttachProperty, <span style="color: #0600FF; font-weight: bold;">value</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  <span style="color: #008000;">}</span>
&nbsp;
  <span style="color: #008080; font-style: italic;">/// &lt;summary&gt;</span>
  <span style="color: #008080; font-style: italic;">/// Change handler for the Attach property</span>
  <span style="color: #008080; font-style: italic;">/// &lt;/summary&gt;</span>
  <span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #6666cc; font-weight: bold;">void</span> OnAttachChanged<span style="color: #008000;">(</span>DependencyObject d, DependencyPropertyChangedEventArgs e<span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    Grid targetElement <span style="color: #008000;">=</span> d <span style="color: #0600FF; font-weight: bold;">as</span> Grid<span style="color: #008000;">;</span>
    RadialGaugeControlViewModel viewModel <span style="color: #008000;">=</span> e<span style="color: #008000;">.</span><span style="color: #0000FF;">NewValue</span> <span style="color: #0600FF; font-weight: bold;">as</span> RadialGaugeControlViewModel<span style="color: #008000;">;</span>
&nbsp;
    <span style="color: #008080; font-style: italic;">// handle the loaded event</span>
    targetElement<span style="color: #008000;">.</span><span style="color: #0000FF;">Loaded</span> <span style="color: #008000;">+=</span> <span style="color: #008000;">new</span> RoutedEventHandler<span style="color: #008000;">(</span>Grid_Loaded<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
  <span style="color: #008000;">}</span>
&nbsp;
  <span style="color: #008080; font-style: italic;">/// &lt;summary&gt;</span>
  <span style="color: #008080; font-style: italic;">/// Handle the Loaded event of the Grid to enable the attached</span>
  <span style="color: #008080; font-style: italic;">/// view model to bind to properties of the Grid Parent element</span>
  <span style="color: #008080; font-style: italic;">/// &lt;/summary&gt;</span>
  <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #6666cc; font-weight: bold;">void</span> Grid_Loaded<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">object</span> sender, RoutedEventArgs e<span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    FrameworkElement targetElement <span style="color: #008000;">=</span> sender <span style="color: #0600FF; font-weight: bold;">as</span> FrameworkElement<span style="color: #008000;">;</span>
    FrameworkElement parent <span style="color: #008000;">=</span> targetElement<span style="color: #008000;">.</span><span style="color: #0000FF;">Parent</span> <span style="color: #0600FF; font-weight: bold;">as</span> FrameworkElement<span style="color: #008000;">;</span>
&nbsp;
    <span style="color: #008080; font-style: italic;">// use the attached view model as the DataContext of the element it is attached to</span>
    RadialGaugeControlViewModel attachedModel <span style="color: #008000;">=</span> GetAttach<span style="color: #008000;">(</span>targetElement<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
    targetElement<span style="color: #008000;">.</span><span style="color: #0000FF;">DataContext</span> <span style="color: #008000;">=</span> attachedModel<span style="color: #008000;">;</span>
&nbsp;
    <span style="color: #008080; font-style: italic;">// bind the DataContext of the view model to the DataContext of the parent.</span>
    attachedModel<span style="color: #008000;">.</span><span style="color: #0000FF;">SetBinding</span><span style="color: #008000;">(</span>RadialGaugeControlViewModel<span style="color: #008000;">.</span><span style="color: #0000FF;">DataContextProperty</span>,
      <span style="color: #008000;">new</span> Binding<span style="color: #008000;">(</span><span style="color: #666666;">"DataContext"</span><span style="color: #008000;">)</span>
      <span style="color: #008000;">{</span>
        Source <span style="color: #008000;">=</span> parent
      <span style="color: #008000;">}</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>It is now possible to expose a property on the view model which provides the Gauge Value as an angle:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">double</span> ValueAngle
<span style="color: #008000;">{</span>
  <span style="color: #0600FF; font-weight: bold;">get</span>
  <span style="color: #008000;">{</span>
    <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">(</span>Gauge <span style="color: #008000;">==</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">)</span>
      <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #FF0000;">0.0</span><span style="color: #008000;">;</span>
&nbsp;
    <span style="color: #0600FF; font-weight: bold;">return</span> ValueToAngle<span style="color: #008000;">(</span>Gauge<span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Value</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">double</span> ValueToAngle<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">double</span> <span style="color: #0600FF; font-weight: bold;">value</span><span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
  <span style="color: #6666cc; font-weight: bold;">double</span> minAngle <span style="color: #008000;">=</span> <span style="color: #008000;">-</span><span style="color: #FF0000;">150</span><span style="color: #008000;">;</span>
  <span style="color: #6666cc; font-weight: bold;">double</span> maxAngle <span style="color: #008000;">=</span> <span style="color: #FF0000;">150</span><span style="color: #008000;">;</span>
  <span style="color: #6666cc; font-weight: bold;">double</span> angularRange <span style="color: #008000;">=</span> maxAngle <span style="color: #008000;">-</span> minAngle<span style="color: #008000;">;</span>
&nbsp;
  <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #008000;">(</span><span style="color: #0600FF; font-weight: bold;">value</span> <span style="color: #008000;">-</span> Gauge<span style="color: #008000;">.</span><span style="color: #0000FF;">Minimum</span><span style="color: #008000;">)</span> <span style="color: #008000;">/</span> <span style="color: #008000;">(</span>Gauge<span style="color: #008000;">.</span><span style="color: #0000FF;">Maximum</span> <span style="color: #008000;">-</span> Gauge<span style="color: #008000;">.</span><span style="color: #0000FF;">Minimum</span><span style="color: #008000;">)</span> <span style="color: #008000;">*</span>
      angularRange <span style="color: #008000;">+</span> minAngle<span style="color: #008000;">;</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>This can then be bound to in the template in order to rotate the needle. For an extra ‘flourish’ a drop shadow is also added to the needle which binds to this same rotation angle in order to give a subtle ‘3D’ effect:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Path</span> <span style="color: #000066;">Stretch</span>=<span style="color: #ff0000;">"Uniform"</span></span>
<span style="color: #009900;">    <span style="color: #000066;">Grid.Row</span>=<span style="color: #ff0000;">"1"</span> <span style="color: #000066;">Grid.ColumnSpan</span>=<span style="color: #ff0000;">"2"</span></span>
<span style="color: #009900;">    <span style="color: #000066;">HorizontalAlignment</span>=<span style="color: #ff0000;">"Center"</span></span>
<span style="color: #009900;">    <span style="color: #000066;">Stroke</span>=<span style="color: #ff0000;">"Black"</span> <span style="color: #000066;">StrokeThickness</span>=<span style="color: #ff0000;">"0.5"</span></span>
<span style="color: #009900;">    <span style="color: #000066;">Data</span>=<span style="color: #ff0000;">"M 0,0 l 10,60 l -10, 40 l -10 -40"</span></span>
<span style="color: #009900;">    <span style="color: #000066;">RenderTransformOrigin</span>=<span style="color: #ff0000;">"0.5,1"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Path.RenderTransform<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #808080; font-style: italic;">&lt;!-- rotate the needle --&gt;</span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;RotateTransform</span> <span style="color: #000066;">Angle</span>=<span style="color: #ff0000;">"{Binding Path=ValueAngle}"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Path.RenderTransform<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Path.Fill<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;LinearGradientBrush</span> <span style="color: #000066;">StartPoint</span>=<span style="color: #ff0000;">"0,0"</span> <span style="color: #000066;">EndPoint</span>=<span style="color: #ff0000;">"1,0"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;GradientStop</span> <span style="color: #000066;">Color</span>=<span style="color: #ff0000;">"DarkRed"</span> <span style="color: #000066;">Offset</span>=<span style="color: #ff0000;">"0"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;GradientStop</span> <span style="color: #000066;">Color</span>=<span style="color: #ff0000;">"DarkRed"</span> <span style="color: #000066;">Offset</span>=<span style="color: #ff0000;">"0.45"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;GradientStop</span> <span style="color: #000066;">Color</span>=<span style="color: #ff0000;">"Red"</span> <span style="color: #000066;">Offset</span>=<span style="color: #ff0000;">"0.55"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;GradientStop</span> <span style="color: #000066;">Color</span>=<span style="color: #ff0000;">"Red"</span> <span style="color: #000066;">Offset</span>=<span style="color: #ff0000;">"1"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/LinearGradientBrush<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Path.Fill<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Path.Effect<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;DropShadowEffect</span> <span style="color: #000066;">Color</span>=<span style="color: #ff0000;">"Black"</span> <span style="color: #000066;">Direction</span>=<span style="color: #ff0000;">"{Binding Path=ValueAngle}"</span></span>
<span style="color: #009900;">                      <span style="color: #000066;">BlurRadius</span>=<span style="color: #ff0000;">"3"</span></span>
<span style="color: #009900;">                      <span style="color: #000066;">Opacity</span>=<span style="color: #ff0000;">"0.6"</span></span>
<span style="color: #009900;">                      <span style="color: #000066;">ShadowDepth</span>=<span style="color: #ff0000;">"5"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Path.Effect<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Path<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p><img src="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2010/08/rotatedNeedle.jpg" alt="" title="rotatedNeedle" width="212" height="210" class="aligncenter size-full wp-image-769" /></p><h2>Adding a Scale</h2><p>The gauge control needs to have tick marks and labels render around the dial face at regularly spaced intervals between the Maximum and Minimum values. Here the view model comes into its own by providing a list of ‘Tick’ value objects, each of which provide the view with the required information to render tick marks and their labels:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> IEnumerable<span style="color: #008000;">&lt;</span>Tick<span style="color: #008000;">&gt;</span> MajorTicks
<span style="color: #008000;">{</span>
  <span style="color: #0600FF; font-weight: bold;">get</span>
  <span style="color: #008000;">{</span>
    <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">(</span>Gauge <span style="color: #008000;">==</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">)</span>
      <span style="color: #0600FF; font-weight: bold;">yield</span> <span style="color: #0600FF; font-weight: bold;">break</span><span style="color: #008000;">;</span>
&nbsp;
    <span style="color: #6666cc; font-weight: bold;">double</span> tickSpacing <span style="color: #008000;">=</span> <span style="color: #008000;">(</span>Gauge<span style="color: #008000;">.</span><span style="color: #0000FF;">Maximum</span> <span style="color: #008000;">-</span> Gauge<span style="color: #008000;">.</span><span style="color: #0000FF;">Minimum</span><span style="color: #008000;">)</span> <span style="color: #008000;">/</span> <span style="color: #FF0000;">10</span><span style="color: #008000;">;</span>
    <span style="color: #0600FF; font-weight: bold;">for</span> <span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">double</span> tick <span style="color: #008000;">=</span> Gauge<span style="color: #008000;">.</span><span style="color: #0000FF;">Minimum</span><span style="color: #008000;">;</span> tick <span style="color: #008000;">&lt;=</span> Gauge<span style="color: #008000;">.</span><span style="color: #0000FF;">Maximum</span><span style="color: #008000;">;</span> tick <span style="color: #008000;">+=</span> tickSpacing<span style="color: #008000;">)</span>
    <span style="color: #008000;">{</span>
      <span style="color: #0600FF; font-weight: bold;">yield</span> <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #008000;">new</span> Tick<span style="color: #008000;">(</span><span style="color: #008000;">)</span>
      <span style="color: #008000;">{</span>
        Angle <span style="color: #008000;">=</span> ValueToAngle<span style="color: #008000;">(</span>tick<span style="color: #008000;">)</span>,
        <span style="color: #0600FF; font-weight: bold;">Value</span> <span style="color: #008000;">=</span> tick<span style="color: #008000;">.</span><span style="color: #0000FF;">ToString</span><span style="color: #008000;">(</span><span style="color: #666666;">"N0"</span><span style="color: #008000;">)</span>,
        Parent <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">this</span>
      <span style="color: #008000;">}</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">}</span>
  <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> Tick
<span style="color: #008000;">{</span>
  <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">double</span> Angle <span style="color: #008000;">{</span> <span style="color: #0600FF; font-weight: bold;">get</span><span style="color: #008000;">;</span> <span style="color: #0600FF; font-weight: bold;">set</span><span style="color: #008000;">;</span> <span style="color: #008000;">}</span>
  <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">string</span> <span style="color: #0600FF; font-weight: bold;">Value</span> <span style="color: #008000;">{</span> <span style="color: #0600FF; font-weight: bold;">get</span><span style="color: #008000;">;</span> <span style="color: #0600FF; font-weight: bold;">set</span><span style="color: #008000;">;</span> <span style="color: #008000;">}</span>
  <span style="color: #0600FF; font-weight: bold;">public</span> RadialGaugeControlViewModel Parent <span style="color: #008000;">{</span> <span style="color: #0600FF; font-weight: bold;">get</span><span style="color: #008000;">;</span> <span style="color: #0600FF; font-weight: bold;">set</span><span style="color: #008000;">;</span> <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>The XAML which renders the major tick marks uses an ItemsControl to create each tick instance:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #808080; font-style: italic;">&lt;!-- major ticks --&gt;</span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsControl</span> <span style="color: #000066;">ItemsSource</span>=<span style="color: #ff0000;">"{Binding Path=MajorTicks}"</span></span>
<span style="color: #009900;">              <span style="color: #000066;">VerticalAlignment</span>=<span style="color: #ff0000;">"Center"</span> <span style="color: #000066;">HorizontalAlignment</span>=<span style="color: #ff0000;">"Center"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsControl.ItemsPanel<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsPanelTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Canvas<span style="color: #000000; font-weight: bold;">&gt;</span></span><span style="color: #000000; font-weight: bold;">&lt;/Canvas<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsPanelTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsControl.ItemsPanel<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsControl.ItemTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;DataTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Ellipse</span> <span style="color: #000066;">Fill</span>=<span style="color: #ff0000;">"Black"</span> <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">"8"</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"8"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Ellipse.RenderTransform<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TransformGroup<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #808080; font-style: italic;">&lt;!-- centre the ellipse --&gt;</span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TranslateTransform</span> <span style="color: #000066;">X</span>=<span style="color: #ff0000;">"-4"</span> <span style="color: #000066;">Y</span>=<span style="color: #ff0000;">"-4"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
            <span style="color: #808080; font-style: italic;">&lt;!-- offset to the edge of the gauge --&gt;</span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TranslateTransform</span> <span style="color: #000066;">X</span>=<span style="color: #ff0000;">"0"</span></span>
<span style="color: #009900;">                <span style="color: #000066;">Y</span>=<span style="color: #ff0000;">"{Binding Path=Parent.GridHeight, Converter={StaticResource ScaleFactorConverter},</span>
<span style="color: #009900;">                                                                 ConverterParameter=-0.37}"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
            <span style="color: #808080; font-style: italic;">&lt;!-- rotate --&gt;</span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;RotateTransform</span> <span style="color: #000066;">Angle</span>=<span style="color: #ff0000;">"{Binding Angle}"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/TransformGroup<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Ellipse.RenderTransform<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Ellipse<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/DataTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsControl.ItemTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsControl<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>As you can see each tick is simply an ellipse. The clever part is how each Ellipse is transformed to position it appropriately. It is first centre to make subsequent transforms a little simpler, it is then translated y an offset which moves it to the edge of the gauge face. The offset factor is computed as some fraction of the overall size of the gauge control. In order to achieve this I reluctantly had to angle SizeChanged events on the template Grid in order to expose its ActualHeight / ActualWidth, this is because ElementName binding on these properties <a href="http://forums.silverlight.net/forums/t/180792.aspx">appears to be broken</a>. </p><p>On attachment the view model handles SizeChanged events as follows:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #008080; font-style: italic;">/// &lt;summary&gt;</span>
<span style="color: #008080; font-style: italic;">/// Handle SizeChanged events from the grid so that we can inform elements</span>
<span style="color: #008080; font-style: italic;">/// of changes in the ActualHeight / ActualWidth</span>
<span style="color: #008080; font-style: italic;">/// &lt;/summary&gt;</span>
<span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> Grid_SizeChanged<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">object</span> sender, SizeChangedEventArgs e<span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
  OnPropertyChanged<span style="color: #008000;">(</span><span style="color: #666666;">"GridHeight"</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  OnPropertyChanged<span style="color: #008000;">(</span><span style="color: #666666;">"GridWidth"</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
  Grid<span style="color: #008000;">.</span><span style="color: #0000FF;">Clip</span> <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> EllipseGeometry<span style="color: #008000;">(</span><span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    RadiusX <span style="color: #008000;">=</span> _grid<span style="color: #008000;">.</span><span style="color: #0000FF;">ActualWidth</span> <span style="color: #008000;">/</span> <span style="color: #FF0000;">2</span>,
    RadiusY <span style="color: #008000;">=</span> _grid<span style="color: #008000;">.</span><span style="color: #0000FF;">ActualHeight</span> <span style="color: #008000;">/</span> <span style="color: #FF0000;">2</span>,
    Center <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> Point<span style="color: #008000;">(</span>_grid<span style="color: #008000;">.</span><span style="color: #0000FF;">ActualWidth</span> <span style="color: #008000;">/</span> <span style="color: #FF0000;">2</span>, _grid<span style="color: #008000;">.</span><span style="color: #0000FF;">ActualHeight</span> <span style="color: #008000;">/</span> <span style="color: #FF0000;">2</span><span style="color: #008000;">)</span>
  <span style="color: #008000;">}</span><span style="color: #008000;">;</span>
<span style="color: #008000;">}</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">double</span> GridWidth
<span style="color: #008000;">{</span>
  <span style="color: #0600FF; font-weight: bold;">get</span> <span style="color: #008000;">{</span> <span style="color: #0600FF; font-weight: bold;">return</span> _grid<span style="color: #008000;">.</span><span style="color: #0000FF;">ActualWidth</span><span style="color: #008000;">;</span> <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">double</span> GridHeight
<span style="color: #008000;">{</span>
  <span style="color: #0600FF; font-weight: bold;">get</span> <span style="color: #008000;">{</span> <span style="color: #0600FF; font-weight: bold;">return</span> _grid<span style="color: #008000;">.</span><span style="color: #0000FF;">ActualHeight</span><span style="color: #008000;">;</span> <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>Adding tick labels and minor tick marks both use a simple variation on the above described approach:</p><p><img src="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2010/08/scale.jpg" alt="" title="scale" width="212" height="209" class="aligncenter size-full wp-image-770" /></p><p>I also added a ‘qualitative value’ range which renders a colour coded band beneath the needle. Again, this uses variations on the same approach, with the view model adapting the properties of the Gauge control and the template binding to these properties, together with the Grid size information in order to provide any required scaling.</p><p>The last flourish was to add a ‘glass’ effect to the Gauge. This was ‘borrowed’ directly from this fantastic codeproject article on creating ‘<a href="http://www.codeproject.com/KB/WPF/glassbuttons.aspx">round glassy buttons</a>’.</p><p>The finished Gauge is shown below, where its value is bound to a Slider control:</p><div><object width="300" height="300" data="data:application/x-silverlight," type="application/x-silverlight-2"><param name="source" value="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2010/08/GaugeControlTwo.xap" /><a href="http://go.microsoft.com/fwlink/?LinkID=124807" style="text-decoration: none;"> <img src="http://go.microsoft.com/fwlink/?LinkId=108181" alt="Get Microsoft Silverlight" style="border-style: none;" /></a></object></div><h2>Conclusions</h2><p>I am pretty happy with how this Gauge control turned out, visually I think it looks pretty good. I am also happy that I have succeeded in my initial aim of making it completely lookless. The attached view model within the control template is an interesting approach that moves view specific concepts (in this case angular properties) into the view, which is where the belong.</p><p>This radial Gauge control could certainly be improved to allow a more flexible scale calculation. Also, the RadialGaugeControlViewModel could also expose some of the view specific properties such as the radial sweep angle (currently hard-coded to 300 degrees) allowing them to be set in the template. For now, I think I will leave this control as it is.</p><p>Tomorrow I am on another early flight, this time heading back home. I might take this as an opportunity to provide a view for this control making use of a different attached view model. </p><p>You can download the full source for this article: <a href="{{ site.url }}/blog/colin/wp-content/uploads/2010/08/GaugeControl.zip">GaugeControl.zip</a></p><p>(Apologies for the lack of project structure, this code was written using VS 2010 Express).</p><p>Regards, Colin E.</p></div>