---
author: Colin Eberhardt
tags: Bezier, charts, spline, visiblox
permalink: /blog/colin/2010/11/adding-a-smoothed-line-series-bezier-curve-to-a-visiblox-chart/index.html
layout: colineberhardt-blog
---
<div class="entry"><div class="topsy_widget_data topsy_theme_light-green" style="float: right; margin-left: 0.75em; background: url(data:,%7B%20%22url%22%3A%20%22http%253A%252F%252Fwww.scottlogic.co.uk%252Fblog%252Fcolin%252F2010%252F11%252Fadding-a-smoothed-line-series-bezier-curve-to-a-visiblox-chart%252F%22%2C%20%22style%22%3A%20%22big%22%2C%20%22title%22%3A%20%22Adding%20a%20Smoothed%20Line%20Series%20%28B%C3%A9zier%20curve%29%20to%20a%20Visiblox%20Chart%20%23%22%20%7D);"></div><p><i>In this blog post I look at how to add a new series type to the Visiblox charts by creating my own series type which renders a smoothed line using a Bézier curve.</i></p><p>This blog post describes how to create a new series type for the <a href="http://www.visiblox.com">Visiblox</a> charts, a spline series. The example below shows the new series type in action, with the various spline control points rendered (just for fun!):</p><div style="text-align: center;"><object width="300" height="300" data="data:application/x-silverlight," type="application/x-silverlight-2"><param name="source" value="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2010/11/VisibloxSplineSeriesFour2.xap" /><a href="http://go.microsoft.com/fwlink/?LinkID=124807" style="text-decoration: none;"> <img src="http://go.microsoft.com/fwlink/?LinkId=108181" alt="Get Microsoft Silverlight" style="border-style: none;" /></a></object></div><p><br /></p><h2>Creating a New Series Type</h2><p>The visual representation of a Visiblox <code>DataSeries</code> is the responsibility of a chart series, as defined by the <code>IChartSeries</code> interface. However, the abstract baseclass <code>ChartSeriesBase</code> is most often the best place to start when creating a new series type.</p><p>The first step towards creating my smoothed series type is to create a <code>ChartSeries</code> subclass. The only abstract method that we must implement is <code>InvalidateInternal</code>, and it is here that we will place our logic to create the series:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> SplineSeries <span style="color: #008000;">:</span> ChartSeriesBase
<span style="color: #008000;">{</span>
&nbsp;
  <span style="color: #0600FF; font-weight: bold;">public</span> SplineSeries<span style="color: #008000;">(</span><span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    DefaultStyleKey <span style="color: #008000;">=</span> <span style="color: #008000;">typeof</span><span style="color: #008000;">(</span>SplineSeries<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  <span style="color: #008000;">}</span>
&nbsp;
  <span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">void</span> InvalidateInternal<span style="color: #008000;">(</span><span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    <span style="color: #008080; font-style: italic;">// render logic goes here</span>
  <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>A template also has to be supplied for the series in the generic.xaml file. The <code>ChartSeriesBase</code> requires that a <code>ZoomCanvas</code> element is located within the template as follows:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ResourceDictionary</span></span>
<span style="color: #009900;">    <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span> </span>
<span style="color: #009900;">    <span style="color: #000066;">xmlns:x</span>=<span style="color: #ff0000;">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span>
<span style="color: #009900;">    <span style="color: #000066;">xmlns:local</span>=<span style="color: #ff0000;">"clr-namespace:VisibloxSplineSeries"</span></span>
<span style="color: #009900;">    <span style="color: #000066;">xmlns:visPrim</span>=<span style="color: #ff0000;">"clr-namespace:Visiblox.Charts.Primitives;assembly=Visiblox.Charts"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
&nbsp;
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Style</span> <span style="color: #000066;">TargetType</span>=<span style="color: #ff0000;">"local:SplineSeries"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Setter</span> <span style="color: #000066;">Property</span>=<span style="color: #ff0000;">"Template"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Setter.Value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ControlTemplate</span> <span style="color: #000066;">TargetType</span>=<span style="color: #ff0000;">"local:SplineSeries"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;visPrim:ZoomCanvas</span> <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">"LayoutRoot"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ControlTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Setter.Value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Setter<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Style<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ResourceDictionary<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>That’s all the boiler plate code out of the way with, let’s get down to writing our series implementation.</p><h2>A Simple Line Series</h2><p>We’ll start by creating a straight-line implementation. Within the <code>UpdateInternal</code> method the following code constructs a Path instance and adds it to the <code>ZoomCanvas</code>:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">void</span> InvalidateInternal<span style="color: #008000;">(</span><span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
  RootZoomCanvas<span style="color: #008000;">.</span><span style="color: #0000FF;">Children</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Clear</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
  Path path <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> Path<span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  PathGeometry geometry <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> PathGeometry<span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  PathFigure figure <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> PathFigure<span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
  <span style="color: #0600FF; font-weight: bold;">var</span> renderPoints <span style="color: #008000;">=</span> GetRenderPoints<span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  figure<span style="color: #008000;">.</span><span style="color: #0000FF;">StartPoint</span> <span style="color: #008000;">=</span> renderPoints<span style="color: #008000;">.</span><span style="color: #0000FF;">First</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  <span style="color: #0600FF; font-weight: bold;">foreach</span> <span style="color: #008000;">(</span><span style="color: #0600FF; font-weight: bold;">var</span> renderPoint <span style="color: #0600FF; font-weight: bold;">in</span> renderPoints<span style="color: #008000;">.</span><span style="color: #0000FF;">Skip</span><span style="color: #008000;">(</span><span style="color: #FF0000;">1</span><span style="color: #008000;">)</span><span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    figure<span style="color: #008000;">.</span><span style="color: #0000FF;">Segments</span><span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Add</span><span style="color: #008000;">(</span><span style="color: #008000;">new</span> LineSegment<span style="color: #008000;">(</span><span style="color: #008000;">)</span>
    <span style="color: #008000;">{</span>
      Point <span style="color: #008000;">=</span> renderPoint
    <span style="color: #008000;">}</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  <span style="color: #008000;">}</span>
&nbsp;
  geometry<span style="color: #008000;">.</span><span style="color: #0000FF;">Figures</span><span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Add</span><span style="color: #008000;">(</span>figure<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  path<span style="color: #008000;">.</span><span style="color: #0000FF;">Data</span> <span style="color: #008000;">=</span> geometry<span style="color: #008000;">;</span>
  path<span style="color: #008000;">.</span><span style="color: #0000FF;">StrokeThickness</span> <span style="color: #008000;">=</span> <span style="color: #FF0000;">2</span><span style="color: #008000;">;</span>
  path<span style="color: #008000;">.</span><span style="color: #0000FF;">Stroke</span> <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> SolidColorBrush<span style="color: #008000;">(</span>Colors<span style="color: #008000;">.</span><span style="color: #0000FF;">Black</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
  ZoomCanvas<span style="color: #008000;">.</span><span style="color: #0000FF;">SetIsScaledPath</span><span style="color: #008000;">(</span>path, <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
  RootZoomCanvas<span style="color: #008000;">.</span><span style="color: #0000FF;">Children</span><span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Add</span><span style="color: #008000;">(</span>path<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
<span style="color: #008000;">}</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">public</span> List<span style="color: #008000;">&lt;</span>Point<span style="color: #008000;">&gt;</span> GetRenderPoints<span style="color: #008000;">(</span><span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
  <span style="color: #0600FF; font-weight: bold;">var</span> renderPoints <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> List<span style="color: #008000;">&lt;</span>Point<span style="color: #008000;">&gt;</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  <span style="color: #0600FF; font-weight: bold;">foreach</span> <span style="color: #008000;">(</span>IDataPoint point <span style="color: #0600FF; font-weight: bold;">in</span> <span style="color: #0600FF; font-weight: bold;">this</span><span style="color: #008000;">.</span><span style="color: #0000FF;">DataSeries</span><span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    <span style="color: #6666cc; font-weight: bold;">double</span> xPos <span style="color: #008000;">=</span> XAxis<span style="color: #008000;">.</span><span style="color: #0000FF;">GetDataValueAsRenderPositionWithoutZoom</span><span style="color: #008000;">(</span>point<span style="color: #008000;">.</span><span style="color: #0000FF;">X</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
    <span style="color: #6666cc; font-weight: bold;">double</span> yPos <span style="color: #008000;">=</span> YAxis<span style="color: #008000;">.</span><span style="color: #0000FF;">GetDataValueAsRenderPositionWithoutZoom</span><span style="color: #008000;">(</span>point<span style="color: #008000;">.</span><span style="color: #0000FF;">Y</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
    renderPoints<span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Add</span><span style="color: #008000;">(</span><span style="color: #008000;">new</span> Point<span style="color: #008000;">(</span>xPos, yPos<span style="color: #008000;">)</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  <span style="color: #008000;">}</span>
  <span style="color: #0600FF; font-weight: bold;">return</span> renderPoints<span style="color: #008000;">;</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>Let’s look at this code in detail. The method <code>GetRenderPoints</code> creates a list of points which indicate the location where each datapoint should be rendered on the chart. The series has a property <code>DataSeries</code> which is the data being rendered and we enumerate over each of the points in this series. The chart series also has a relationship to the X &amp; Y axes, and it is each axis which is responsible for the converting the X &amp; Y components of our data into a ‘screen’ coordinate. This is performed via the (succinctly named!)  <code>GetDataValueAsRenderPositionWithoutZoom</code> method (more on this later).</p><p>The list of points returned by the <code>GetRenderPoints</code> method are used to define a path (a path is defined by a geometry which is defined by one or more figures which themselves are defined by one or more segments … phew!). This path is styled and added to the <code>RootZoomCanvas</code>, with the attached property <code>IsScaledPath</code> set to true.</p><p>The net result of the above code is that we now have a fully functional line series which integrates with the Visiblox behaviours such as pan &amp; zoom:</p><div style="text-align: center;"><object width="300" height="300" data="data:application/x-silverlight," type="application/x-silverlight-2"><param name="source" value="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2010/11/VisibloxSplineSeriesOne.xap" /><a href="http://go.microsoft.com/fwlink/?LinkID=124807" style="text-decoration: none;"> <img src="http://go.microsoft.com/fwlink/?LinkId=108181" alt="Get Microsoft Silverlight" style="border-style: none;" /></a></object></div><p>Now back to this ZoomCanvas … </p><p>The Visiblox charts have been optimised for performance and providing user interactions. A common requirement for interactive charts is the ability to pan and zoom. Both of these can be implemented by changing the range of the X and Y axes (for example a pan operation would result in a fixed offset being applied to the axis range), however this would result in the chart having to recomputed the location of all of each of the points being rendered. As an alternative, the Visiblox axes have a Zoom property which is handled by the <code>ZoomCanvas</code> directly. When a Zoom is applied, the required <code>RenderTransform</code>s are applied to the elements in the canvas, i.e. the series, resulting in a rapid update of chart. When using the <code>ZoomCanvas</code> you have to indicate whether the element added is based on a geometry, which should be transformed (i.e. a zoom makes the geometry appear bigger), or whether the element location should simply by updated to reflect the current zoom, for example, when you zoom in to a chart typically you would want the datapoints to maintain a fixed size.</p><p>Gergely Orosz describes the ZoomCanvas in more detail in his recent post on <a href="http://www.visiblox.com/blog/2010/11/zooming-panning-in-silverlight-using-visiblox-charts">Panning &amp; Zooming</a> the charts.</p><p>To illustrate how this works, we will add points to our series which are not scaled as we zoom into the chart. The <code>InvalidateInternal</code> method is updated with the additional code to render the points, note that the ellipses have a <code>RenderTransform</code> applied so that their centre is anchored to the correct location on the <code>ZoomCanvas</code>:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">void</span> InvalidateInternal<span style="color: #008000;">(</span><span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
  <span style="color: #008080; font-style: italic;">// ... code for rendering the path</span>
&nbsp;
  <span style="color: #0600FF; font-weight: bold;">foreach</span> <span style="color: #008000;">(</span><span style="color: #0600FF; font-weight: bold;">var</span> renderPoint <span style="color: #0600FF; font-weight: bold;">in</span> renderPoints<span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    Ellipse el <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> Ellipse<span style="color: #008000;">(</span><span style="color: #008000;">)</span>
    <span style="color: #008000;">{</span>
      Stroke <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> SolidColorBrush<span style="color: #008000;">(</span>Colors<span style="color: #008000;">.</span><span style="color: #0000FF;">Black</span><span style="color: #008000;">)</span>,
      StrokeThickness <span style="color: #008000;">=</span> <span style="color: #FF0000;">2.0</span>,
      Fill <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> SolidColorBrush<span style="color: #008000;">(</span>Colors<span style="color: #008000;">.</span><span style="color: #0000FF;">White</span><span style="color: #008000;">)</span>,
      Width <span style="color: #008000;">=</span> <span style="color: #FF0000;">9</span>,
      Height <span style="color: #008000;">=</span> <span style="color: #FF0000;">9</span>,
      RenderTransform <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> TranslateTransform<span style="color: #008000;">(</span><span style="color: #008000;">)</span>
      <span style="color: #008000;">{</span>
        X <span style="color: #008000;">=</span> <span style="color: #008000;">-</span><span style="color: #FF0000;">4</span>,
        Y <span style="color: #008000;">=</span> <span style="color: #008000;">-</span><span style="color: #FF0000;">4</span>
      <span style="color: #008000;">}</span>
    <span style="color: #008000;">}</span><span style="color: #008000;">;</span>
    RootZoomCanvas<span style="color: #008000;">.</span><span style="color: #0000FF;">Children</span><span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Add</span><span style="color: #008000;">(</span>el<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
    ZoomCanvas<span style="color: #008000;">.</span><span style="color: #0000FF;">SetElementPosition</span><span style="color: #008000;">(</span>el, renderPoint<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>You can see the series in action below:</p><div style="text-align: center;"><object width="300" height="300" data="data:application/x-silverlight," type="application/x-silverlight-2"><param name="source" value="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2010/11/VisibloxSplineSeriesTwo.xap" /><a href="http://go.microsoft.com/fwlink/?LinkID=124807" style="text-decoration: none;"> <img src="http://go.microsoft.com/fwlink/?LinkId=108181" alt="Get Microsoft Silverlight" style="border-style: none;" /></a></object></div><h2>Creating a Smoothed Curve</h2><p>So far we have created a simple line series; however the aim of this article is to create a smoothed line series. The <code>Figure</code> within our <code>PathGeometry</code> is currently composed of a number of straight line segments, in order to create a smoothed line we need to use curved segments. Silverlight and WPF both support Bézier curves and these can be used to specify a curved path geometry. A  Bézier curve has four points, a start point, an end point and two control points which define the curvature:</p><p><img src="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2010/11/mapbezier1.png" alt="" title="mapbezier1" width="215" height="321" class="aligncenter size-full wp-image-944" /></p><p>In order to create a curved path for our series we need to determine suitable control points for our Bézier segments. After a bit of googling I stumbled upon an excellent article by Kerem Kat which describes how to use <a href="http://www.codeproject.com/KB/silverlight/MapBezier.aspx">Bézier curves with Bing Maps</a>. The article sourcecode has a method that will return the data points required to render a smoothed line as a Bézier Curve, using <a href="http://www.mvps.org/directx/articles/catmull/">Catmull-Rom</a> splines. </p><p>Modifying our series to use Bézier Curves, via the <code>GetBezierPoints</code> method described in the above article, is pretty straightforward:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">void</span> InvalidateInternal<span style="color: #008000;">(</span><span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
  RootZoomCanvas<span style="color: #008000;">.</span><span style="color: #0000FF;">Children</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Clear</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
  Path path <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> Path<span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  PathGeometry geometry <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> PathGeometry<span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  PathFigure figure <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> PathFigure<span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
  <span style="color: #008080; font-style: italic;">// obtain the render position of each point</span>
  <span style="color: #0600FF; font-weight: bold;">var</span> renderPoints <span style="color: #008000;">=</span> GetRenderPoints<span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
  <span style="color: #008080; font-style: italic;">// create the bezier points as per:</span>
  <span style="color: #008080; font-style: italic;">// http://www.codeproject.com/KB/silverlight/MapBezier.aspx</span>
  PointCollection bezierPoints <span style="color: #008000;">=</span> GetBezierPoints<span style="color: #008000;">(</span>renderPoints, Tension<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
  <span style="color: #008080; font-style: italic;">// create the figure composed of bezier segments</span>
  figure<span style="color: #008000;">.</span><span style="color: #0000FF;">StartPoint</span> <span style="color: #008000;">=</span> bezierPoints<span style="color: #008000;">[</span><span style="color: #FF0000;">0</span><span style="color: #008000;">]</span><span style="color: #008000;">;</span>
  <span style="color: #0600FF; font-weight: bold;">for</span> <span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">int</span> i <span style="color: #008000;">=</span> <span style="color: #FF0000;">1</span><span style="color: #008000;">;</span> i <span style="color: #008000;">&lt;</span> bezierPoints<span style="color: #008000;">.</span><span style="color: #0000FF;">Count</span><span style="color: #008000;">;</span> i <span style="color: #008000;">+=</span> <span style="color: #FF0000;">3</span><span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    figure<span style="color: #008000;">.</span><span style="color: #0000FF;">Segments</span><span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Add</span><span style="color: #008000;">(</span><span style="color: #008000;">new</span> BezierSegment<span style="color: #008000;">(</span><span style="color: #008000;">)</span>
    <span style="color: #008000;">{</span>
      Point1 <span style="color: #008000;">=</span> bezierPoints<span style="color: #008000;">[</span>i<span style="color: #008000;">]</span>,       
      Point2 <span style="color: #008000;">=</span> bezierPoints<span style="color: #008000;">[</span>i <span style="color: #008000;">+</span> <span style="color: #FF0000;">1</span><span style="color: #008000;">]</span>,   
      Point3 <span style="color: #008000;">=</span> bezierPoints<span style="color: #008000;">[</span>i <span style="color: #008000;">+</span> <span style="color: #FF0000;">2</span><span style="color: #008000;">]</span>    
    <span style="color: #008000;">}</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  <span style="color: #008000;">}</span>
&nbsp;
  geometry<span style="color: #008000;">.</span><span style="color: #0000FF;">Figures</span><span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Add</span><span style="color: #008000;">(</span>figure<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  path<span style="color: #008000;">.</span><span style="color: #0000FF;">Data</span> <span style="color: #008000;">=</span> geometry<span style="color: #008000;">;</span>
  path<span style="color: #008000;">.</span><span style="color: #0000FF;">StrokeThickness</span> <span style="color: #008000;">=</span> <span style="color: #FF0000;">2</span><span style="color: #008000;">;</span>
  path<span style="color: #008000;">.</span><span style="color: #0000FF;">Stroke</span> <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> SolidColorBrush<span style="color: #008000;">(</span>Colors<span style="color: #008000;">.</span><span style="color: #0000FF;">Black</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  ZoomCanvas<span style="color: #008000;">.</span><span style="color: #0000FF;">SetIsScaledPath</span><span style="color: #008000;">(</span>path, <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
  RootZoomCanvas<span style="color: #008000;">.</span><span style="color: #0000FF;">Children</span><span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Add</span><span style="color: #008000;">(</span>path<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>Note the <code>Tension</code> property which is passed to the <code>GetBezierPoints</code> method, this is a property of Catmull-Rom splines which describes how ‘smoothed’ the line should be. The <code>SplineSeries</code> exposes this as a dependency property, as shown in the example below:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;vis:Chart</span> <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">"chart"</span> <span style="color: #000066;">LegendVisibility</span>=<span style="color: #ff0000;">"Collapsed"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;vis:Chart.Series<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:SplineSeries</span> <span style="color: #000066;">Tension</span>=<span style="color: #ff0000;">"{Binding Path=Value, ElementName=tensionSlider}"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/vis:Chart.Series<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/vis:Chart<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;StackPanel</span> <span style="color: #000066;">Orientation</span>=<span style="color: #ff0000;">"Horizontal"</span> <span style="color: #000066;">Grid.Row</span>=<span style="color: #ff0000;">"1"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBlock</span> <span style="color: #000066;">Text</span>=<span style="color: #ff0000;">"Tension:"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Slider</span> <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">"tensionSlider"</span></span>
<span style="color: #009900;">        <span style="color: #000066;">Maximum</span>=<span style="color: #ff0000;">"5.0"</span> <span style="color: #000066;">Minimum</span>=<span style="color: #ff0000;">"1.0"</span> <span style="color: #000066;">Value</span>=<span style="color: #ff0000;">"2.0"</span> </span>
<span style="color: #009900;">        <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">"100"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBlock</span> <span style="color: #000066;">Text</span>=<span style="color: #ff0000;">"{Binding Path=Value, ElementName=tensionSlider}"</span></span>
<span style="color: #009900;">              <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">"18"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/StackPanel<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>You can see the effect of changing the tension on the spline:</p><div style="text-align: center;"><object width="300" height="300" data="data:application/x-silverlight," type="application/x-silverlight-2"><param name="source" value="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2010/11/VisibloxSplineSeriesThree2.xap" /><a href="http://go.microsoft.com/fwlink/?LinkID=124807" style="text-decoration: none;"> <img src="http://go.microsoft.com/fwlink/?LinkId=108181" alt="Get Microsoft Silverlight" style="border-style: none;" /></a></object></div><h2>For a Bit Of Fun …</h2><p>I thought it would be fun to visualise the Catmull-Rom spline construction by also rendering the control points for each Bézier curve. You can see the results below:</p><div style="text-align: center;"><object width="300" height="300" data="data:application/x-silverlight," type="application/x-silverlight-2"><param name="source" value="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2010/11/VisibloxSplineSeriesFour2.xap" /><a href="http://go.microsoft.com/fwlink/?LinkID=124807" style="text-decoration: none;"> <img src="http://go.microsoft.com/fwlink/?LinkId=108181" alt="Get Microsoft Silverlight" style="border-style: none;" /></a></object></div><p>You can download the full sourcecode for the article here: <a href="{{ site.url }}/blog/colin/wp-content/uploads/2010/11/VisibloxSplineSeries.zip">VisibloxSplineSeries.zip</a></p><p>To run the examples you will also need to download the Visiblox charts from <a href="http://www.visiblox.com">www.visiblox.com</a>.</p><p>Regards, Colin E.</p></div>