---
author: Colin Eberhardt
tags: attached behaviour, binding, silverlight
permalink: /blog/colin/2009/02/relativesource-binding-in-silverlight/index.html
layout: colineberhardt-blog
---
<div class="entry"><div class="topsy_widget_data topsy_theme_light-green" style="float: right; margin-left: 0.75em; background: url(data:,%7B%20%22url%22%3A%20%22http%253A%252F%252Fwww.scottlogic.co.uk%252Fblog%252Fcolin%252F2009%252F02%252Frelativesource-binding-in-silverlight%252F%22%2C%20%22style%22%3A%20%22big%22%2C%20%22title%22%3A%20%22Implementing%20RelativeSource%20binding%20in%20Silverlight%20%23%22%20%7D);"></div><p>In my <a href="{{ site.url }}/blog/colin/2009/02/elementname-binding-in-silverlight-via-attached-behaviours/">previous post</a> I demonstrated how an the WPF ElementName style binding can be emulated with Silverlight via an attached behaviour. As a brief recap, the technique involved creating an attached property, which when bound, adds a handler for the elements Loaded event. When the element is loaded, the even handler locates the named element and constructs a binding via a relay object. Here is the attached property in use:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Rectangle</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"20"</span> <span style="color: #000066;">Fill</span>=<span style="color: #ff0000;">"Green"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:BindingHelper.Binding<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:BindingProperties</span> <span style="color: #000066;">ElementName</span>=<span style="color: #ff0000;">"Slider"</span> <span style="color: #000066;">SourceProperty</span>=<span style="color: #ff0000;">"Value"</span> <span style="color: #000066;">TargetProperty</span>=<span style="color: #ff0000;">"Width"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:BindingHelper.Binding<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Rectangle<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Slider</span> <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">"Slider"</span> <span style="color: #000066;">Value</span>=<span style="color: #ff0000;">"20"</span> <span style="color: #000066;">Minimum</span>=<span style="color: #ff0000;">"0"</span> <span style="color: #000066;">Maximum</span>=<span style="color: #ff0000;">"300"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span></pre></td></tr></table></div><p>Where the Rectangle’s Width is bound to the Slider’s Value. For details, and sourcecode, visit <a href="{{ site.url }}/blog/colin/2009/02/elementname-binding-in-silverlight-via-attached-behaviours/">this blog post</a>. Here I am going to extend this attached behaviour in order to emulate WPF’s RelativeSource binding.</p><p>For much of the time you will want to bind your visual elements to your data objects via their DataContext property. However, there are often times when you want too perform a binding for pure presentation purposes, for example, binding the width of two elements together. In this context WPFs RelativeSource and ElementName binding prove to be powerful and useful features of the binding framework.</p><p>Here I will extend the attached behaviour I described in my previous post to add RelativeSource binding capabilities. The properties of the attached property type have been extended:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> BindingProperties
<span style="color: #008000;">{</span>
    <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">string</span> SourceProperty <span style="color: #008000;">{</span> <span style="color: #0600FF; font-weight: bold;">get</span><span style="color: #008000;">;</span> <span style="color: #0600FF; font-weight: bold;">set</span><span style="color: #008000;">;</span> <span style="color: #008000;">}</span>
    <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">string</span> ElementName <span style="color: #008000;">{</span> <span style="color: #0600FF; font-weight: bold;">get</span><span style="color: #008000;">;</span> <span style="color: #0600FF; font-weight: bold;">set</span><span style="color: #008000;">;</span> <span style="color: #008000;">}</span>
    <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">string</span> TargetProperty <span style="color: #008000;">{</span> <span style="color: #0600FF; font-weight: bold;">get</span><span style="color: #008000;">;</span> <span style="color: #0600FF; font-weight: bold;">set</span><span style="color: #008000;">;</span> <span style="color: #008000;">}</span>
    <span style="color: #0600FF; font-weight: bold;">public</span> IValueConverter Converter <span style="color: #008000;">{</span> <span style="color: #0600FF; font-weight: bold;">get</span><span style="color: #008000;">;</span> <span style="color: #0600FF; font-weight: bold;">set</span><span style="color: #008000;">;</span> <span style="color: #008000;">}</span>
    <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">object</span> ConverterParameter <span style="color: #008000;">{</span> <span style="color: #0600FF; font-weight: bold;">get</span><span style="color: #008000;">;</span> <span style="color: #0600FF; font-weight: bold;">set</span><span style="color: #008000;">;</span> <span style="color: #008000;">}</span>
    <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">bool</span> RelativeSourceSelf <span style="color: #008000;">{</span> <span style="color: #0600FF; font-weight: bold;">get</span><span style="color: #008000;">;</span> <span style="color: #0600FF; font-weight: bold;">set</span><span style="color: #008000;">;</span> <span style="color: #008000;">}</span>
    <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">string</span> RelativeSourceAncestorType <span style="color: #008000;">{</span> <span style="color: #0600FF; font-weight: bold;">get</span><span style="color: #008000;">;</span> <span style="color: #0600FF; font-weight: bold;">set</span><span style="color: #008000;">;</span> <span style="color: #008000;">}</span>
    <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">int</span> RelativeSourceAncestorLevel <span style="color: #008000;">{</span> <span style="color: #0600FF; font-weight: bold;">get</span><span style="color: #008000;">;</span> <span style="color: #0600FF; font-weight: bold;">set</span><span style="color: #008000;">;</span> <span style="color: #008000;">}</span>
&nbsp;
    <span style="color: #0600FF; font-weight: bold;">public</span> BindingProperties<span style="color: #008000;">(</span><span style="color: #008000;">)</span>
    <span style="color: #008000;">{</span>
        RelativeSourceAncestorLevel <span style="color: #008000;">=</span> <span style="color: #FF0000;">1</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>With the RelativeSourceSelf, RelativeSourceAncestorType and RelativeSourceAncestorLevel properties being used for relative source bindings. Taking RelativeSourceSelf as our first example, within WPF a <a href="http://msdn.microsoft.com/en-us/library/system.windows.data.relativesource.self.aspx">RelativeSource.Self</a> property indicates that the source of a binding should be the element which the binding is associated with. (I know – it sounds a bit crazy, but search <a href="http://www.google.co.uk/search?q=RelativeSource+Self">google</a>, it is surprisingly useful!).</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #6666cc; font-weight: bold;">void</span> OnBinding<span style="color: #008000;">(</span>
    DependencyObject depObj, DependencyPropertyChangedEventArgs e<span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
    FrameworkElement targetElement <span style="color: #008000;">=</span> depObj <span style="color: #0600FF; font-weight: bold;">as</span> FrameworkElement<span style="color: #008000;">;</span>
&nbsp;
    targetElement<span style="color: #008000;">.</span><span style="color: #0000FF;">Loaded</span> <span style="color: #008000;">+=</span> <span style="color: #008000;">new</span> RoutedEventHandler<span style="color: #008000;">(</span>TargetElement_Loaded<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
<span style="color: #008000;">}</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #6666cc; font-weight: bold;">void</span> TargetElement_Loaded<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">object</span> sender, RoutedEventArgs e<span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
    FrameworkElement targetElement <span style="color: #008000;">=</span> sender <span style="color: #0600FF; font-weight: bold;">as</span> FrameworkElement<span style="color: #008000;">;</span>
&nbsp;
    <span style="color: #008080; font-style: italic;">// get the value of our attached property</span>
    BindingProperties bindingProperties <span style="color: #008000;">=</span> GetBinding<span style="color: #008000;">(</span>targetElement<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
    <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">(</span>bindingProperties<span style="color: #008000;">.</span><span style="color: #0000FF;">ElementName</span> <span style="color: #008000;">!=</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">)</span>
    <span style="color: #008000;">{</span>
        <span style="color: #008080; font-style: italic;">// perform our 'ElementName' lookup</span>
        <span style="color: #008000;">...</span>
    <span style="color: #008000;">}</span>
    <span style="color: #0600FF; font-weight: bold;">else</span> <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">(</span>bindingProperties<span style="color: #008000;">.</span><span style="color: #0000FF;">RelativeSourceSelf</span><span style="color: #008000;">)</span>
    <span style="color: #008000;">{</span>
        <span style="color: #008080; font-style: italic;">// bind an element to itself.</span>
        CreateRelayBinding<span style="color: #008000;">(</span>targetElement, targetElement, bindingProperties<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>When the attached property becomes attached to our target element it adds a handler for the elements Loaded event (this is the <em>attached behaviour</em>). Within the event handler, we determine whether this is a relative source binding. If this is the case, the CreateRelayBinding method is invoked where the source and target element parameters are the same element. For details of how the CreateRelayBinding method works, see the <a href="{{ site.url }}/blog/colin/2009/02/elementname-binding-in-silverlight-via-attached-behaviours/">previous blog post</a>.  An example of a relative-source self binding is show below, where a TextBox’s Width property is bound to its Text, if you trype in a new text value, the TextBox Width adjusts accordingly.</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBox</span> <span style="color: #000066;">Text</span>=<span style="color: #ff0000;">"200"</span> <span style="color: #000066;">Margin</span>=<span style="color: #ff0000;">"0,5,0,0"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:BindingHelper.Binding<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:BindingProperties</span> <span style="color: #000066;">TargetProperty</span>=<span style="color: #ff0000;">"Width"</span> <span style="color: #000066;">SourceProperty</span>=<span style="color: #ff0000;">"Text"</span></span>
<span style="color: #009900;">                                 <span style="color: #000066;">RelativeSourceSelf</span>=<span style="color: #ff0000;">"True"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>                                
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:BindingHelper.Binding<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/TextBox<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>The next type of RelativeSource binding I am going to tackle is the FindAncestor mode. You use this type of binding when you want to bind to an element of a specific type that is located further up the visual tree that the target element. The following code snippet shows how the attached behaviour achieves this type of binding:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #6666cc; font-weight: bold;">void</span> TargetElement_Loaded<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">object</span> sender, RoutedEventArgs e<span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
    FrameworkElement targetElement <span style="color: #008000;">=</span> sender <span style="color: #0600FF; font-weight: bold;">as</span> FrameworkElement<span style="color: #008000;">;</span>
&nbsp;
    <span style="color: #008080; font-style: italic;">// get the value of our attached property</span>
    BindingProperties bindingProperties <span style="color: #008000;">=</span> GetBinding<span style="color: #008000;">(</span>targetElement<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
    <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">(</span>bindingProperties<span style="color: #008000;">.</span><span style="color: #0000FF;">ElementName</span> <span style="color: #008000;">!=</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">)</span>
    <span style="color: #008000;">{</span>
        <span style="color: #008080; font-style: italic;">// perform our 'ElementName' lookup</span>
        <span style="color: #008000;">...</span>
    <span style="color: #008000;">}</span>
    <span style="color: #0600FF; font-weight: bold;">else</span> <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">(</span>bindingProperties<span style="color: #008000;">.</span><span style="color: #0000FF;">RelativeSourceSelf</span><span style="color: #008000;">)</span>
    <span style="color: #008000;">{</span>
        <span style="color: #008080; font-style: italic;">// bind an element to itself.</span>
        <span style="color: #008000;">...</span>
    <span style="color: #008000;">}</span>
    <span style="color: #0600FF; font-weight: bold;">else</span> <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">(</span><span style="color: #008000;">!</span><span style="color: #6666cc; font-weight: bold;">string</span><span style="color: #008000;">.</span><span style="color: #0000FF;">IsNullOrEmpty</span><span style="color: #008000;">(</span>bindingProperties<span style="color: #008000;">.</span><span style="color: #0000FF;">RelativeSourceAncestorType</span><span style="color: #008000;">)</span><span style="color: #008000;">)</span>
    <span style="color: #008000;">{</span>
&nbsp;
        <span style="color: #008080; font-style: italic;">// navigate up the tree to find the type</span>
        DependencyObject currentObject <span style="color: #008000;">=</span> targetElement<span style="color: #008000;">;</span>
&nbsp;
        <span style="color: #6666cc; font-weight: bold;">int</span> currentLevel <span style="color: #008000;">=</span> <span style="color: #FF0000;">0</span><span style="color: #008000;">;</span>
        <span style="color: #0600FF; font-weight: bold;">while</span> <span style="color: #008000;">(</span>currentLevel <span style="color: #008000;">&lt;</span> bindingProperties<span style="color: #008000;">.</span><span style="color: #0000FF;">RelativeSourceAncestorLevel</span><span style="color: #008000;">)</span>
        <span style="color: #008000;">{</span>
            <span style="color: #0600FF; font-weight: bold;">do</span>
            <span style="color: #008000;">{</span>
                currentObject <span style="color: #008000;">=</span> VisualTreeHelper<span style="color: #008000;">.</span><span style="color: #0000FF;">GetParent</span><span style="color: #008000;">(</span>currentObject<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
            <span style="color: #008000;">}</span>
            <span style="color: #0600FF; font-weight: bold;">while</span> <span style="color: #008000;">(</span>currentObject<span style="color: #008000;">.</span><span style="color: #0000FF;">GetType</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Name</span> <span style="color: #008000;">!=</span> bindingProperties<span style="color: #008000;">.</span><span style="color: #0000FF;">RelativeSourceAncestorType</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
            currentLevel<span style="color: #008000;">++;</span>
        <span style="color: #008000;">}</span>
&nbsp;
        FrameworkElement sourceElement <span style="color: #008000;">=</span> currentObject <span style="color: #0600FF; font-weight: bold;">as</span> FrameworkElement<span style="color: #008000;">;</span>
&nbsp;
        <span style="color: #008080; font-style: italic;">// bind them</span>
        CreateRelayBinding<span style="color: #008000;">(</span>targetElement, sourceElement, bindingProperties<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>The code above simply navigates up the visual tree to find the n’th element of a given type. When the given type has been located, the relay binding between the two is constructed.</p><p>This type of binding is incredibly flexible, the following shows a number of examples:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;UserControl</span> <span style="color: #000066;">x:Class</span>=<span style="color: #ff0000;">"SilverlightBinding.PageTwo"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
&nbsp;
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;UserControl.Resources<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:VisibilityConverter</span> <span style="color: #000066;">x:Key</span>=<span style="color: #ff0000;">"VisibilityConverter"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/UserControl.Resources<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;StackPanel</span> <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">"TheOuterStackPanel"</span> <span style="color: #000066;">Background</span>=<span style="color: #ff0000;">"White"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span> 
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;StackPanel</span> <span style="color: #000066;">Name</span>=<span style="color: #ff0000;">"theInnerStackPanel"</span> <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">"400"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
            <span style="color: #808080; font-style: italic;">&lt;!-- bind the textbox width to its text property --&gt;</span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBox</span> <span style="color: #000066;">Text</span>=<span style="color: #ff0000;">"200"</span> <span style="color: #000066;">Margin</span>=<span style="color: #ff0000;">"0,5,0,0"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:BindingHelper.Binding<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:BindingProperties</span> <span style="color: #000066;">TargetProperty</span>=<span style="color: #ff0000;">"Width"</span> <span style="color: #000066;">SourceProperty</span>=<span style="color: #ff0000;">"Text"</span></span>
<span style="color: #009900;">                                             <span style="color: #000066;">RelativeSourceSelf</span>=<span style="color: #ff0000;">"True"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>                                
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:BindingHelper.Binding<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/TextBox<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #808080; font-style: italic;">&lt;!-- bind the textbox text to this UserControls width property --&gt;</span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBox</span> <span style="color: #000066;">Margin</span>=<span style="color: #ff0000;">"0,5,0,0"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:BindingHelper.Binding<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:BindingProperties</span> <span style="color: #000066;">TargetProperty</span>=<span style="color: #ff0000;">"Text"</span> <span style="color: #000066;">SourceProperty</span>=<span style="color: #ff0000;">"Width"</span></span>
<span style="color: #009900;">                                             <span style="color: #000066;">RelativeSourceAncestorType</span>=<span style="color: #ff0000;">"PageTwo"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>                                
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:BindingHelper.Binding<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/TextBox<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #808080; font-style: italic;">&lt;!-- bind the textbox text to the inner stack panels name property --&gt;</span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBox</span> <span style="color: #000066;">Margin</span>=<span style="color: #ff0000;">"0,5,0,0"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:BindingHelper.Binding<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:BindingProperties</span> <span style="color: #000066;">TargetProperty</span>=<span style="color: #ff0000;">"Text"</span> <span style="color: #000066;">SourceProperty</span>=<span style="color: #ff0000;">"Name"</span></span>
<span style="color: #009900;">                                             <span style="color: #000066;">RelativeSourceAncestorType</span>=<span style="color: #ff0000;">"StackPanel"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>                                
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:BindingHelper.Binding<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/TextBox<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #808080; font-style: italic;">&lt;!-- bind the textbox text to the outer stack panels name property --&gt;</span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBox</span> <span style="color: #000066;">Margin</span>=<span style="color: #ff0000;">"0,5,0,0"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:BindingHelper.Binding<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:BindingProperties</span> <span style="color: #000066;">TargetProperty</span>=<span style="color: #ff0000;">"Text"</span> <span style="color: #000066;">SourceProperty</span>=<span style="color: #ff0000;">"Name"</span></span>
<span style="color: #009900;">                                             <span style="color: #000066;">RelativeSourceAncestorType</span>=<span style="color: #ff0000;">"StackPanel"</span></span>
<span style="color: #009900;">                                             <span style="color: #000066;">RelativeSourceAncestorLevel</span>=<span style="color: #ff0000;">"2"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>                                
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:BindingHelper.Binding<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/TextBox<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #808080; font-style: italic;">&lt;!-- bind a slider's value to its parent grid's height property  --&gt;</span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"30"</span>  <span style="color: #000066;">Margin</span>=<span style="color: #ff0000;">"0,5,0,0"</span> <span style="color: #000066;">Background</span>=<span style="color: #ff0000;">"CadetBlue"</span> <span style="color: #000066;">HorizontalAlignment</span>=<span style="color: #ff0000;">"Left"</span> <span style="color: #000000; font-weight: bold;">&gt;</span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Slider</span> <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">"400"</span>  <span style="color: #000066;">HorizontalAlignment</span>=<span style="color: #ff0000;">"Left"</span> <span style="color: #000066;">Minimum</span>=<span style="color: #ff0000;">"10"</span> <span style="color: #000066;">Maximum</span>=<span style="color: #ff0000;">"40"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
                    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:BindingHelper.Binding<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:BindingProperties</span> <span style="color: #000066;">TargetProperty</span>=<span style="color: #ff0000;">"Value"</span> <span style="color: #000066;">SourceProperty</span>=<span style="color: #ff0000;">"Height"</span></span>
<span style="color: #009900;">                                             <span style="color: #000066;">RelativeSourceAncestorType</span>=<span style="color: #ff0000;">"Grid"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
                    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:BindingHelper.Binding<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Slider<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/StackPanel<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>     
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/StackPanel<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/UserControl<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>You can see in the above XAML, examples of relative-source self and find ancestor bindings with a variety of types and ancestor-levels. And here it is in action:</p><div id="slPluginHost"> <object id="SilverlightPlugin" width="400" height="200" data="data:application/x-silverlight," type="application/x-silverlight-2"><param name="source" value="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2009/02/silverlightbinding2.xap" /><a href="http://go.microsoft.com/fwlink/?LinkID=124807" style="text-decoration: none;"> <img src="http://go.microsoft.com/fwlink/?LinkId=108181" alt="Get Microsoft Silverlight" style="border-style: none;" /></a></object></div><p>If you type in a new value in the top text box its width will change, or move the slider to see the height of its parent grid changing. And all without any code-behind of course!</p><p>Many of these effects shown above could be performed via element-name bindings. However, you are not always the creator, or template provider for all the visual elements rendered to screen. One common example is that of the ItemsControl, the ListBox being an example of this type of control. Here you supply a DataTemplate, with your visual elements being rendered inside a ListBoxItem container. Therefore, there is no way to bind to the ListBoxItem via an element name or otherwise. However, you can reach the ListBoxItem by navigating up the tree using a relative-source binding as show below:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ListBox</span> <span style="color: #000066;">Name</span>=<span style="color: #ff0000;">"grid"</span> <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">"200"</span> <span style="color: #000066;">HorizontalAlignment</span>=<span style="color: #ff0000;">"Left"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ListBox.ItemTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;DataTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid</span> <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">"180"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBlock</span> <span style="color: #000066;">Text</span>=<span style="color: #ff0000;">"{Binding Forename}"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
&nbsp;
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Ellipse</span> <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">"10"</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"10"</span> <span style="color: #000066;">Fill</span>=<span style="color: #ff0000;">"Red"</span> <span style="color: #000066;">HorizontalAlignment</span>=<span style="color: #ff0000;">"Right"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
                    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:BindingHelper.Binding<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:BindingProperties</span> <span style="color: #000066;">TargetProperty</span>=<span style="color: #ff0000;">"Visibility"</span> <span style="color: #000066;">SourceProperty</span>=<span style="color: #ff0000;">"IsSelected"</span></span>
<span style="color: #009900;">                                                 <span style="color: #000066;">Converter</span>=<span style="color: #ff0000;">"{StaticResource VisibilityConverter}"</span></span>
<span style="color: #009900;">                                                 <span style="color: #000066;">RelativeSourceAncestorType</span>=<span style="color: #ff0000;">"ListBoxItem"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
                    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:BindingHelper.Binding<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Ellipse<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/DataTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ListBox.ItemTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ListBox<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>In the above example we have a DataTemplate which contains an ellipse. As the ListBox generates each ‘row’, it creates a ListBoxItem and populates it with the visual elements from our data template. When our ellipse is created, and loaded, the attached behaviour fires, navigating up the visual tree to find the first ListBoxItem it encounters. When it finds it, it creates a single instance of our relay object, binding both the ListBoxItem.IsSelected and Ellipse.Visibilty (via a suitable value converter) together via the relay object.</p><p>And here it is in action (click an item to see the ellipse) …</p><div id="slPluginHost"> <object id="SilverlightPlugin" width="400" height="150" data="data:application/x-silverlight," type="application/x-silverlight-2"><param name="source" value="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2009/02/silverlightbinding1.xap" /><a href="http://go.microsoft.com/fwlink/?LinkID=124807" style="text-decoration: none;"> <img src="http://go.microsoft.com/fwlink/?LinkId=108181" alt="Get Microsoft Silverlight" style="border-style: none;" /></a></object></div><p>You can download a visual studio project with all the sourcecode: <a href="{{ site.url }}/blog/colin/wp-content/uploads/2009/02/silverlightrelativesourcebinding.zip">silverlightrelativesourcebinding.zip</a>.</p><p>Enjoy, Colin E.</p></div>