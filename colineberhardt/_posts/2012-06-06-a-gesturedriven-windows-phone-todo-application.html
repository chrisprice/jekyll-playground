---
author: Colin Eberhardt
tags: 
permalink: /blog/colin/2012/06/a-gesture-driven-windows-phone-to-do-application/index.html
layout: colineberhardt-blog
---
<div class="entry"><div class="topsy_widget_data topsy_theme_light-green" style="float: right; margin-left: 0.75em; background: url(data:,%7B%20%22url%22%3A%20%22http%253A%252F%252Fwww.scottlogic.co.uk%252Fblog%252Fcolin%252F2012%252F06%252Fa-gesture-driven-windows-phone-to-do-application%252F%22%2C%20%22style%22%3A%20%22big%22%2C%20%22title%22%3A%20%22A%20gesture-driven%20Windows%20Phone%20to-do%20application%20%23%22%20%7D);"></div><p>This blog post describes the implementation of a gesture-based todo-list application. The simple interface is controlled entirely by drag, flick and swipe:</p><p><iframe width="480" height="360" src="http://www.youtube.com/embed/pBO75351RS4" frameborder="0" allowfullscreen="allowfullscreen"></iframe></p><p>So far the application supports deletion and completion of tasks, but not the addition of new ones. I’ll get to this in a later blog post!</p><h2>Introduction – gestures, why don’t we use them more?</h2><p>I think it is fair to say that most Windows Phone applications (and mobile applications in general) have user-interfaces that are a close reflection of how we interact with a desktop computer. Mobile applications have the same buttons, checkboxes and input controls as their desktop equivalent, with the user interacting with the majority of these controls via simple clicks / taps.</p><p>The mobile multi-touch interface allows for much more control and expression than a simple mouse pointer device. Standard gestures have been developed such as pinch/stretch, flick, pan, tap-and-hold, however these are quite rarely used; one notable exception being pinch/stretch which is the standard mechanism for manipulating images.<br />
When an application comes along that makes great use of gestures, it really stands out from the crowds. One such application is the iPhone ‘Clear’ application, a simple todo-list with not one button or checkbox in sight. You can see the app in action below:</p><p><iframe width="560" height="315" src="http://www.youtube.com/embed/5BC_bAaA1og" frameborder="0" allowfullscreen="allowfullscreen"></iframe></p><p>Interestingly, its use of pinch to navigate the three levels of menu is similar to the <a href="{{ site.url }}/blog/colin/2011/11/an-introduction-to-semantic-zoom-in-windows-8-metro/">Windows 8 concept of ‘semantic zoom’</a>.<br />
When I first saw Clear – the clean, clutter-free interface immediately spoke ‘Metro’ to me! This blog post looks at how to recreate some of the features of Clear using Silverlight for Windows Phone, in order to create a gesture-driven todo application.</p><p>NOTE: All of the work on my blog is under a Creative Commons Share-alike licence. For this blog post I just want to add that I do <em>not </em>want someone to take this code in order to release a ‘Clear’ clone on the Windows Phone marketplace. This blog post is for fun and education, to make people think more about the possibilities of gestures.</p><h2>Rendering the to-do items</h2><p>I haven’t followed the MVVM pattern for this simple application (I don’t need to unit test or collaborate with a designer!), but have followed the standard approach of using databinding. Each item is represented by an instance of the <code>ToDoItem </code>class which has properties of <code>Text</code>, <code>Completed </code>and <code>Color </code>and implemented <code>INotifyPropertyChanged</code>.  A collection of these items is bound to an <code>ItemsControl </code>in order to render the list:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsControl</span> <span style="color: #000066;">ItemsSource</span>=<span style="color: #ff0000;">"{Binding}"</span> <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">"todoList"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsControl.ItemTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;DataTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Border</span> <span style="color: #000066;">Background</span>=<span style="color: #ff0000;">"{Binding Path=Color, Converter={StaticResource ColorToBrushConverter}}"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid.Background<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #808080; font-style: italic;">&lt;!-- create a subtle gradient that overlays the background --&gt;</span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;LinearGradientBrush</span> <span style="color: #000066;">EndPoint</span>=<span style="color: #ff0000;">"0,1"</span> <span style="color: #000066;">StartPoint</span>=<span style="color: #ff0000;">"0,0"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
              <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;GradientStop</span> <span style="color: #000066;">Color</span>=<span style="color: #ff0000;">"#22FFFFFF"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
              <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;GradientStop</span> <span style="color: #000066;">Color</span>=<span style="color: #ff0000;">"#00000000"</span> <span style="color: #000066;">Offset</span>=<span style="color: #ff0000;">"0.1"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
              <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;GradientStop</span> <span style="color: #000066;">Color</span>=<span style="color: #ff0000;">"#00000000"</span> <span style="color: #000066;">Offset</span>=<span style="color: #ff0000;">"0.7"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
              <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;GradientStop</span> <span style="color: #000066;">Color</span>=<span style="color: #ff0000;">"#22000000"</span> <span style="color: #000066;">Offset</span>=<span style="color: #ff0000;">"1"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/LinearGradientBrush<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid.Background<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
          <span style="color: #808080; font-style: italic;">&lt;!-- task text --&gt;</span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBlock</span> <span style="color: #000066;">Text</span>=<span style="color: #ff0000;">"{Binding Text}"</span> <span style="color: #000066;">Margin</span>=<span style="color: #ff0000;">"15,15,0,15"</span> <span style="color: #000066;">FontSize</span>=<span style="color: #ff0000;">"30"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Border<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/DataTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsControl.ItemTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsControl.Template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ControlTemplate</span> <span style="color: #000066;">TargetType</span>=<span style="color: #ff0000;">"ItemsControl"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ScrollViewer<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsPresenter</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ScrollViewer<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ControlTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsControl.Template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsControl<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>The items control is template to host the <code>ItemsPanel</code> within a <code>ScrollViewer</code>, the default panel, a vertically-oriented <code>StackPanel</code>, is used here. The template to render each item is a simple <code>Border</code>, <code>Grid </code>and <code>TextBlock</code>. The code-behind iterates over the <code>ToDoItem </code>instances setting their <code>Color </code>property to produce a pretty looking gradient from red to orange, representing the priority of each item:</p><p><img src="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2012/06/list.jpg" alt="" title="list" width="300" height="545" class="aligncenter size-full wp-image-2160" /></p><h2>Handling gestures</h2><p>Silverlight for Windows Phone provides manipulation events which you can handle in order to track when a user places one or more fingers on the screen and moves them around. Turning low-level manipulation events into high-level gestures is actually quite tricky. Touch devices give a much greater control when dragging objects, or flicking them, but have a much lower accuracy for the more commonplace task of trying to hit a specific spot on the screen. For this reason, gestures have a built in tolerance. As an example, a drag manipulation gesture is not initiated if the user’s finger moves by a single pixel.</p><p>Fortunately, the <a href="http://silverlight.codeplex.com/">Silverlight Toolkit</a> contains a <code>GestureListener </code>which handles manipulation events and turns them into the standard gesture events for you. Unless you need a quite fancy gesture (two-finger-swipe for example), the <code>GestureListener </code>probably gives you all you need. To use this class, simply attach it to the element that you want to handle gestures on, then add handlers to the events that the <code>GestureListener</code> provides.</p><p>We’ll add a <code>GestureListener </code>to the template that is used to render each <code>ToDoItem</code>:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsControl</span> <span style="color: #000066;">ItemsSource</span>=<span style="color: #ff0000;">"{Binding}"</span> <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">"todoList"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsControl.ItemTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;DataTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Border</span> <span style="color: #000066;">Background</span>=<span style="color: #ff0000;">"{Binding Path=Color, Converter={StaticResource ColorToBrushConverter}}"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
        <span style="color: #808080; font-style: italic;">&lt;!-- handle gestures for the ToDoItem element --&gt;</span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;toolkit:GestureService.GestureListener<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;toolkit:GestureListener</span></span>
<span style="color: #009900;">                    <span style="color: #000066;">DragStarted</span>=<span style="color: #ff0000;">"GestureListener_DragStarted"</span></span>
<span style="color: #009900;">                    <span style="color: #000066;">DragDelta</span>=<span style="color: #ff0000;">"GestureListener_DragDelta"</span></span>
<span style="color: #009900;">                    <span style="color: #000066;">DragCompleted</span>=<span style="color: #ff0000;">"GestureListener_DragCompleted"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/toolkit:GestureService.GestureListener<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
          ...
&nbsp;
          <span style="color: #808080; font-style: italic;">&lt;!-- task text --&gt;</span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBlock</span> <span style="color: #000066;">Text</span>=<span style="color: #ff0000;">"{Binding Text}"</span> <span style="color: #000066;">Margin</span>=<span style="color: #ff0000;">"15,15,0,15"</span> <span style="color: #000066;">FontSize</span>=<span style="color: #ff0000;">"30"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
&nbsp;
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Border<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/DataTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsControl.ItemTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
  ...
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsControl<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>The events produced by the <code>GestureListener </code>are used to indicate that a user has dragged their finger across the screen, but they do not actually move the element that the listener is associated with. We need to handle these events and move the element ourselves:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> GestureListener_DragStarted<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">object</span> sender, DragStartedGestureEventArgs e<span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
  <span style="color: #008080; font-style: italic;">// initialize the drag</span>
  FrameworkElement fe <span style="color: #008000;">=</span> sender <span style="color: #0600FF; font-weight: bold;">as</span> FrameworkElement<span style="color: #008000;">;</span>
  fe<span style="color: #008000;">.</span><span style="color: #0000FF;">SetHorizontalOffset</span><span style="color: #008000;">(</span><span style="color: #FF0000;">0</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>  
<span style="color: #008000;">}</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> GestureListener_DragDelta<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">object</span> sender, DragDeltaGestureEventArgs e<span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
  <span style="color: #008080; font-style: italic;">// handle the drag to offset the element</span>
  FrameworkElement fe <span style="color: #008000;">=</span> sender <span style="color: #0600FF; font-weight: bold;">as</span> FrameworkElement<span style="color: #008000;">;</span>
  <span style="color: #6666cc; font-weight: bold;">double</span> offset <span style="color: #008000;">=</span> fe<span style="color: #008000;">.</span><span style="color: #0000FF;">GetHorizontalOffset</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Value</span> <span style="color: #008000;">+</span> e<span style="color: #008000;">.</span><span style="color: #0000FF;">HorizontalChange</span><span style="color: #008000;">;</span>
  fe<span style="color: #008000;">.</span><span style="color: #0000FF;">SetHorizontalOffset</span><span style="color: #008000;">(</span>offset<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
<span style="color: #008000;">}</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> GestureListener_DragCompleted<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">object</span> sender, DragCompletedGestureEventArgs e<span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
  ToDoItemBounceBack<span style="color: #008000;">(</span>fe<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>But what are these mysterious methods, <code>SetHorizontalOffset</code> and <code>GetHorizontalOffset </code>in the above code? They are not found on <code>FrameworkElement</code>. The task of offsetting an element is reasonably straightforward via a <code>TranslateTransform</code>. However, once you set the <code>RenderTransform </code>of an element, it is converted to a <code>MatrixTransform</code>, so you cannot easily retrieve the value of the offset that has just been applied.</p><p>In order to hide this slightly messy implementation, I have created a couple of extension methods that use <code>FrameworkElement.Tag</code> to store the current offset:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #6666cc; font-weight: bold;">void</span> SetHorizontalOffset<span style="color: #008000;">(</span><span style="color: #0600FF; font-weight: bold;">this</span> FrameworkElement fe, <span style="color: #6666cc; font-weight: bold;">double</span> offset<span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
  <span style="color: #0600FF; font-weight: bold;">var</span> trans <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> TranslateTransform<span style="color: #008000;">(</span><span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    X <span style="color: #008000;">=</span> offset
  <span style="color: #008000;">}</span><span style="color: #008000;">;</span>
  fe<span style="color: #008000;">.</span><span style="color: #0000FF;">RenderTransform</span> <span style="color: #008000;">=</span> trans<span style="color: #008000;">;</span>
&nbsp;
  fe<span style="color: #008000;">.</span><span style="color: #0000FF;">Tag</span> <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> Offset<span style="color: #008000;">(</span><span style="color: #008000;">)</span>
    <span style="color: #008000;">{</span>
      <span style="color: #0600FF; font-weight: bold;">Value</span> <span style="color: #008000;">=</span> offset,
      Transform  <span style="color: #008000;">=</span> trans
    <span style="color: #008000;">}</span><span style="color: #008000;">;</span>
<span style="color: #008000;">}</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">static</span> Offset GetHorizontalOffset<span style="color: #008000;">(</span><span style="color: #0600FF; font-weight: bold;">this</span> FrameworkElement fe<span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
  <span style="color: #0600FF; font-weight: bold;">return</span> fe<span style="color: #008000;">.</span><span style="color: #0000FF;">Tag</span> <span style="color: #008000;">==</span> <span style="color: #0600FF; font-weight: bold;">null</span> <span style="color: #008000;">?</span> <span style="color: #008000;">new</span> Offset<span style="color: #008000;">(</span><span style="color: #008000;">)</span> <span style="color: #008000;">:</span> <span style="color: #008000;">(</span>Offset<span style="color: #008000;">)</span>fe<span style="color: #008000;">.</span><span style="color: #0000FF;">Tag</span><span style="color: #008000;">;</span>
<span style="color: #008000;">}</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">struct</span> Offset
<span style="color: #008000;">{</span>
  <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">double</span> <span style="color: #0600FF; font-weight: bold;">Value</span> <span style="color: #008000;">{</span> <span style="color: #0600FF; font-weight: bold;">get</span><span style="color: #008000;">;</span> <span style="color: #0600FF; font-weight: bold;">set</span><span style="color: #008000;">;</span> <span style="color: #008000;">}</span>
  <span style="color: #0600FF; font-weight: bold;">public</span> TranslateTransform Transform <span style="color: #008000;">{</span> <span style="color: #0600FF; font-weight: bold;">get</span><span style="color: #008000;">;</span> <span style="color: #0600FF; font-weight: bold;">set</span><span style="color: #008000;">;</span> <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>Yes, I know, <code>Tag </code>is never an elegant solution, but at least the above code is hidden behind extension methods, so feel free to replace with a more elegant implementation using attached properties if you wish!</p><p>When the drag stops we want the item to bounce back into place:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> ToDoItemBounceBack<span style="color: #008000;">(</span>FrameworkElement fe<span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
  <span style="color: #0600FF; font-weight: bold;">var</span> trans <span style="color: #008000;">=</span> fe<span style="color: #008000;">.</span><span style="color: #0000FF;">GetHorizontalOffset</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Transform</span><span style="color: #008000;">;</span>
&nbsp;
  trans<span style="color: #008000;">.</span><span style="color: #0000FF;">Animate</span><span style="color: #008000;">(</span>trans<span style="color: #008000;">.</span><span style="color: #0000FF;">X</span>, <span style="color: #FF0000;">0</span>, TranslateTransform<span style="color: #008000;">.</span><span style="color: #0000FF;">XProperty</span>, <span style="color: #FF0000;">300</span>, <span style="color: #FF0000;">0</span>, <span style="color: #008000;">new</span> BounceEase<span style="color: #008000;">(</span><span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    Bounciness <span style="color: #008000;">=</span> <span style="color: #FF0000;">5</span>,
    Bounces <span style="color: #008000;">=</span> <span style="color: #FF0000;">2</span>
  <span style="color: #008000;">}</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p><code>Animate </code>is another extension method which I created in order to quickly create <code>DoubleAnimations </code>for the properties of an element:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #6666cc; font-weight: bold;">void</span> Animate<span style="color: #008000;">(</span><span style="color: #0600FF; font-weight: bold;">this</span> DependencyObject target, <span style="color: #6666cc; font-weight: bold;">double</span> <span style="color: #0600FF; font-weight: bold;">from</span>, <span style="color: #6666cc; font-weight: bold;">double</span> to,
                          <span style="color: #6666cc; font-weight: bold;">object</span> propertyPath, <span style="color: #6666cc; font-weight: bold;">int</span> duration, <span style="color: #6666cc; font-weight: bold;">int</span> startTime,
                          IEasingFunction easing <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">null</span>, Action completed <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
  <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">(</span>easing <span style="color: #008000;">==</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    easing <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> SineEase<span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  <span style="color: #008000;">}</span>
&nbsp;
  <span style="color: #0600FF; font-weight: bold;">var</span> db <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> DoubleAnimation<span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  db<span style="color: #008000;">.</span><span style="color: #0000FF;">To</span> <span style="color: #008000;">=</span> to<span style="color: #008000;">;</span>
  db<span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">From</span> <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">from</span><span style="color: #008000;">;</span>
  db<span style="color: #008000;">.</span><span style="color: #0000FF;">EasingFunction</span> <span style="color: #008000;">=</span> easing<span style="color: #008000;">;</span>
  db<span style="color: #008000;">.</span><span style="color: #0000FF;">Duration</span> <span style="color: #008000;">=</span> TimeSpan<span style="color: #008000;">.</span><span style="color: #0000FF;">FromMilliseconds</span><span style="color: #008000;">(</span>duration<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  Storyboard<span style="color: #008000;">.</span><span style="color: #0000FF;">SetTarget</span><span style="color: #008000;">(</span>db, target<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  Storyboard<span style="color: #008000;">.</span><span style="color: #0000FF;">SetTargetProperty</span><span style="color: #008000;">(</span>db, <span style="color: #008000;">new</span> PropertyPath<span style="color: #008000;">(</span>propertyPath<span style="color: #008000;">)</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
  <span style="color: #0600FF; font-weight: bold;">var</span> sb <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> Storyboard<span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  sb<span style="color: #008000;">.</span><span style="color: #0000FF;">BeginTime</span> <span style="color: #008000;">=</span> TimeSpan<span style="color: #008000;">.</span><span style="color: #0000FF;">FromMilliseconds</span><span style="color: #008000;">(</span>startTime<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
  <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">(</span>completed <span style="color: #008000;">!=</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    sb<span style="color: #008000;">.</span><span style="color: #0000FF;">Completed</span> <span style="color: #008000;">+=</span> <span style="color: #008000;">(</span>s, e<span style="color: #008000;">)</span> <span style="color: #008000;">=&gt;</span> completed<span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  <span style="color: #008000;">}</span>
&nbsp;
  sb<span style="color: #008000;">.</span><span style="color: #0000FF;">Children</span><span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Add</span><span style="color: #008000;">(</span>db<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  sb<span style="color: #008000;">.</span><span style="color: #0000FF;">Begin</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>With the above code in place, we can drag items to one side or the other, then release and watch them bounce back into place.</p><h2>Mark as complete</h2><p>When an item is dragged sufficiently far to the right, we’d like to have it marked as complete. To implement this, we’ll check how far an item was dragged when the user releases their finger. If it was dragged more than half way, we’ll mark the item as complete:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> GestureListener_DragCompleted<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">object</span> sender, DragCompletedGestureEventArgs e<span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>  
  FrameworkElement fe <span style="color: #008000;">=</span> sender <span style="color: #0600FF; font-weight: bold;">as</span> FrameworkElement<span style="color: #008000;">;</span>
  <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">(</span>e<span style="color: #008000;">.</span><span style="color: #0000FF;">HorizontalChange</span> <span style="color: #008000;">&gt;</span> fe<span style="color: #008000;">.</span><span style="color: #0000FF;">ActualWidth</span> <span style="color: #008000;">/</span> <span style="color: #FF0000;">2</span><span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    ToDoItemCompletedAction<span style="color: #008000;">(</span>fe<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  <span style="color: #008000;">}</span>
  <span style="color: #0600FF; font-weight: bold;">else</span>
  <span style="color: #008000;">{</span>
    ToDoItemBounceBack<span style="color: #008000;">(</span>fe<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> ToDoItemCompletedAction<span style="color: #008000;">(</span>FrameworkElement fe<span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
  <span style="color: #008080; font-style: italic;">// set the ToDoItem to complete</span>
  ToDoItem completedItem <span style="color: #008000;">=</span> fe<span style="color: #008000;">.</span><span style="color: #0000FF;">DataContext</span> <span style="color: #0600FF; font-weight: bold;">as</span> ToDoItem<span style="color: #008000;">;</span>
  completedItem<span style="color: #008000;">.</span><span style="color: #0000FF;">Completed</span> <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">;</span>
  completedItem<span style="color: #008000;">.</span><span style="color: #0000FF;">Color</span> <span style="color: #008000;">=</span> Colors<span style="color: #008000;">.</span><span style="color: #0000FF;">Green</span><span style="color: #008000;">;</span>
&nbsp;
  <span style="color: #008080; font-style: italic;">// bounce back into place</span>
  ToDoItemBounceBack<span style="color: #008000;">(</span>fe<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>The bindings take care of updating the UI so that our item is now green. I also added a <code>Line</code> element which has its <code>Visibility </code>bound to the <code>Completed </code>property of the <code>ToDoItem</code>:</p><p><img src="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2012/06/complete.jpg" alt="" title="complete" width="300" height="544" class="aligncenter size-full wp-image-2159" /></p><h2>Deleting an item</h2><p>If instead the use slides the item to the left we’d like to delete it. The <code>DragCompleted</code> event handler can easily be extended to check whether the item was dragged more than half-way across the screen in the other direction. The method that performs the deletion is shown below:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> ToDoItemDeletedAction<span style="color: #008000;">(</span>FrameworkElement deletedElement<span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
  <span style="color: #0600FF; font-weight: bold;">var</span> trans <span style="color: #008000;">=</span> deletedElement<span style="color: #008000;">.</span><span style="color: #0000FF;">GetHorizontalOffset</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Transform</span><span style="color: #008000;">;</span>
  trans<span style="color: #008000;">.</span><span style="color: #0000FF;">Animate</span><span style="color: #008000;">(</span>trans<span style="color: #008000;">.</span><span style="color: #0000FF;">X</span>, <span style="color: #008000;">-</span><span style="color: #008000;">(</span>deletedElement<span style="color: #008000;">.</span><span style="color: #0000FF;">ActualWidth</span> <span style="color: #008000;">+</span> <span style="color: #FF0000;">50</span><span style="color: #008000;">)</span>,
                TranslateTransform<span style="color: #008000;">.</span><span style="color: #0000FF;">XProperty</span>, <span style="color: #FF0000;">300</span>, <span style="color: #FF0000;">0</span>, <span style="color: #008000;">new</span> SineEase<span style="color: #008000;">(</span><span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    EasingMode <span style="color: #008000;">=</span> EasingMode<span style="color: #008000;">.</span><span style="color: #0000FF;">EaseOut</span>
  <span style="color: #008000;">}</span>,
  <span style="color: #008000;">(</span><span style="color: #008000;">)</span> <span style="color: #008000;">=&gt;</span>
  <span style="color: #008000;">{</span>
    <span style="color: #008080; font-style: italic;">// find the model object that was deleted</span>
    ToDoItem deletedItem <span style="color: #008000;">=</span> deletedElement<span style="color: #008000;">.</span><span style="color: #0000FF;">DataContext</span> <span style="color: #0600FF; font-weight: bold;">as</span> ToDoItem<span style="color: #008000;">;</span>
&nbsp;
    <span style="color: #008080; font-style: italic;">// determine how much we have to 'shuffle' up by</span>
    <span style="color: #6666cc; font-weight: bold;">double</span> elementOffset <span style="color: #008000;">=</span> <span style="color: #008000;">-</span>deletedElement<span style="color: #008000;">.</span><span style="color: #0000FF;">ActualHeight</span><span style="color: #008000;">;</span>
&nbsp;
    <span style="color: #008080; font-style: italic;">// find the items in view, and the location of the deleted item in this list</span>
    <span style="color: #0600FF; font-weight: bold;">var</span> itemsInView <span style="color: #008000;">=</span> todoList<span style="color: #008000;">.</span><span style="color: #0000FF;">GetItemsInView</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">.</span><span style="color: #0000FF;">ToList</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
    <span style="color: #0600FF; font-weight: bold;">var</span> lastItem <span style="color: #008000;">=</span> itemsInView<span style="color: #008000;">.</span><span style="color: #0000FF;">Last</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
    <span style="color: #6666cc; font-weight: bold;">int</span> startTime <span style="color: #008000;">=</span> <span style="color: #FF0000;">0</span><span style="color: #008000;">;</span>
    <span style="color: #6666cc; font-weight: bold;">int</span> deletedItemIndex <span style="color: #008000;">=</span> itemsInView<span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Select</span><span style="color: #008000;">(</span>i <span style="color: #008000;">=&gt;</span> i<span style="color: #008000;">.</span><span style="color: #0000FF;">DataContext</span><span style="color: #008000;">)</span>
                                      <span style="color: #008000;">.</span><span style="color: #0000FF;">ToList</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">.</span><span style="color: #0000FF;">IndexOf</span><span style="color: #008000;">(</span>deletedItem<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
    <span style="color: #008080; font-style: italic;">// iterate over each item</span>
    <span style="color: #0600FF; font-weight: bold;">foreach</span> <span style="color: #008000;">(</span>FrameworkElement element <span style="color: #0600FF; font-weight: bold;">in</span> itemsInView<span style="color: #008000;">.</span><span style="color: #0000FF;">Skip</span><span style="color: #008000;">(</span>deletedItemIndex<span style="color: #008000;">)</span><span style="color: #008000;">)</span>
    <span style="color: #008000;">{</span>
      <span style="color: #008080; font-style: italic;">// for the last item, create an action that deletes the model object</span>
      <span style="color: #008080; font-style: italic;">// and re-renders the list</span>
      Action action <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">;</span>
      <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">(</span>element <span style="color: #008000;">==</span> lastItem<span style="color: #008000;">)</span>
      <span style="color: #008000;">{</span>
        action <span style="color: #008000;">=</span> <span style="color: #008000;">(</span><span style="color: #008000;">)</span> <span style="color: #008000;">=&gt;</span>
        <span style="color: #008000;">{</span>
          <span style="color: #008080; font-style: italic;">// clone the list</span>
          <span style="color: #0600FF; font-weight: bold;">var</span> items <span style="color: #008000;">=</span> _todoItems<span style="color: #008000;">.</span><span style="color: #0000FF;">ToList</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
          items<span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Remove</span><span style="color: #008000;">(</span>deletedItem<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
          <span style="color: #008080; font-style: italic;">// re-populate our ObservableCollection</span>
          _todoItems<span style="color: #008000;">.</span><span style="color: #0000FF;">Clear</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
          _todoItems<span style="color: #008000;">.</span><span style="color: #0000FF;">AddRange</span><span style="color: #008000;">(</span>items<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
          UpdateToDoColors<span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
        <span style="color: #008000;">}</span><span style="color: #008000;">;</span>
      <span style="color: #008000;">}</span>
&nbsp;
      <span style="color: #008080; font-style: italic;">// shuffle this item up</span>
      TranslateTransform elementTrans <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> TranslateTransform<span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
      element<span style="color: #008000;">.</span><span style="color: #0000FF;">RenderTransform</span> <span style="color: #008000;">=</span> elementTrans<span style="color: #008000;">;</span>
      elementTrans<span style="color: #008000;">.</span><span style="color: #0000FF;">Animate</span><span style="color: #008000;">(</span><span style="color: #FF0000;">0</span>, elementOffset, TranslateTransform<span style="color: #008000;">.</span><span style="color: #0000FF;">YProperty</span>, <span style="color: #FF0000;">200</span>, startTime, <span style="color: #0600FF; font-weight: bold;">null</span>, action<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
      startTime <span style="color: #008000;">+=</span> <span style="color: #FF0000;">10</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">}</span>
  <span style="color: #008000;">}</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>There’s actually rather a lot going on in that method. Firstly the deleted item is animated so that it flies off the screen to the left. Once this animation is complete, we’d like to make the items below ‘shuffle’ up to fill the space. In order to do this, we measure the size of the deleted items, then iterate over all the items within the current view, that are below the deleted item, and apply an animation to each one. The code makes use of the <code>GetItemsInView</code> extension method that I wrote for the <a href="{{ site.url }}/blog/colin/2011/01/a-windows-phone-7-jump-list-control/" title="A Windows Phone 7 Jump List Control">WP7 JumpList control</a> – it returns a list of items that are currently visible to the user, taking vertical scroll into consideration. </p><p>Once all the elements have shuffled up, our UI now contains a number of <code>ToDoItems </code>that have been ‘artificially’ offset. Rather than try to keep track of how each item is offset, at this point we force the <code>ItemsControl </code>to re-render the entire list. </p><p>The result looks pretty cool …</p><p><img src="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2012/06/delete.jpg" alt="" title="delete" width="600" height="337" class="aligncenter size-full wp-image-2154" /></p></div>