---
author: Colin Eberhardt
tags: bing maps, codeproject, google sky, maps, Windows Phone 7
permalink: /blog/colin/2011/02/google-sky-on-windows-phone-7/index.html
layout: colineberhardt-blog
---
<div class="entry"><div class="topsy_widget_data topsy_theme_light-green" style="float: right; margin-left: 0.75em; background: url(data:,%7B%20%22url%22%3A%20%22http%253A%252F%252Fwww.scottlogic.co.uk%252Fblog%252Fcolin%252F2011%252F02%252Fgoogle-sky-on-windows-phone-7%252F%22%2C%20%22style%22%3A%20%22big%22%2C%20%22title%22%3A%20%22Google%20Sky%20on%20Windows%20Phone%207%20%23%22%20%7D);"></div><p><i>This blog post shows just how easy it is to use Google Sky as a tile source for Bing Maps, bringing the universe to Windows Phone 7!</i></p><p><iframe title="YouTube video player" width="480" height="390" src="http://www.youtube.com/embed/a_NIm6baP_s?rel=0" frameborder="0" allowfullscreen="allowfullscreen"></iframe></p><p>Personally I think mapping is one of the most exciting forms of application for mobile devices – the fantastic imagery available from Bing and Google maps, coupled with GPS technology, results in some pretty amazing tools. As a Windows Phone 7 developer, I have spent a fair bit of time poking round the <a href="http://msdn.microsoft.com/en-us/library/ff955762.aspx">Silverlight Bing Maps APIs</a>. A really cool feature of the Bing Maps control is that it accepts custom tile-sources. You can find code elsewhere that explains how to use this to render<a href="http://www.codeproject.com/KB/windows-phone-7/mapcode.aspx"> Google Maps data via a Bing maps chart control</a>. For a bit of fun I decided to use this approach to render Google Sky on WP7 …</p><p>Finding the correct URL format is as easy as opening up firebug and looking at the HTTP traffic when using Google Sky:</p><p><a href="{{ site.url }}/blog/colin/wp-content/uploads/2011/02/googlesky.png"><img src="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2011/02/googlesky-300x276.png" alt="" title="googlesky" width="300" height="276" class="aligncenter size-medium wp-image-1232" /></a></p><p>With this knowledge, creating a custom tile source for Bing maps is pretty trivial</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> GoogleTile <span style="color: #008000;">:</span> Microsoft<span style="color: #008000;">.</span><span style="color: #0000FF;">Phone</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Controls</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Maps</span><span style="color: #008000;">.</span><span style="color: #0000FF;">TileSource</span>
<span style="color: #008000;">{</span>
    <span style="color: #0600FF; font-weight: bold;">public</span> GoogleTile<span style="color: #008000;">(</span><span style="color: #008000;">)</span>
    <span style="color: #008000;">{</span>
        UriFormat <span style="color: #008000;">=</span> <span style="color: #666666;">@"http://mw1.google.com/mw-planetary/sky/skytiles_v1/{0}_{1}_{2}.jpg"</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">}</span>
&nbsp;
    <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">override</span> Uri GetUri<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">int</span> x, <span style="color: #6666cc; font-weight: bold;">int</span> y, <span style="color: #6666cc; font-weight: bold;">int</span> zoomLevel<span style="color: #008000;">)</span>
    <span style="color: #008000;">{</span>
        <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">(</span>zoomLevel <span style="color: #008000;">&gt;</span> <span style="color: #FF0000;">0</span><span style="color: #008000;">)</span>
        <span style="color: #008000;">{</span>
            <span style="color: #0600FF; font-weight: bold;">var</span> Url <span style="color: #008000;">=</span> <span style="color: #6666cc; font-weight: bold;">string</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Format</span><span style="color: #008000;">(</span>UriFormat, x, y, zoomLevel<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
            <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #008000;">new</span> Uri<span style="color: #008000;">(</span>Url<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
        <span style="color: #008000;">}</span>
        <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>And associating your tile source with a map control is as simple as this …</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;map:Map</span> <span style="color: #000066;">Name</span>=<span style="color: #ff0000;">"map"</span></span>
<span style="color: #009900;">    <span style="color: #000066;">CopyrightVisibility</span>=<span style="color: #ff0000;">"Collapsed"</span> <span style="color: #000066;">LogoVisibility</span>=<span style="color: #ff0000;">"Collapsed"</span> <span style="color: #000066;">ScaleVisibility</span>=<span style="color: #ff0000;">"Collapsed"</span></span>
<span style="color: #009900;">    <span style="color: #000066;">ZoomLevel</span>=<span style="color: #ff0000;">"2"</span></span>
<span style="color: #009900;">    <span style="color: #000066;">CredentialsProvider</span>=<span style="color: #ff0000;">"-- YOUR API KEY GOES HERE!!! ---"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;map:Map.Mode<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;mapCore:MercatorMode</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/map:Map.Mode<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;map:MapTileLayer<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;map:MapTileLayer.TileSources<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:GoogleTile</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/map:MapTileLayer.TileSources<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/map:MapTileLayer<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/map:Map<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>When exploring the sky, funnily enough, it becomes pretty obvious that most of it is black! In order to make this a more interesting application I added a little ‘menu’ across the bottom that allows you to select from the list of <a href="http://en.wikipedia.org/wiki/Messier_object">110 Messier Objects</a>, a catalogue of interesting astronomical objects that are not comets. The thumbnail images for each object were scraped from <a href="http://en.wikipedia.org/wiki/List_of_Messier_objects">Wikipedia</a>, and the coordinates retrieved from the <a href="http://maps.forum.nu/gm_sky.html">SIMBAD astronomical database</a> via a little C# command line app. </p><p>They are rendered in the UI via an ItemsControl:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsControl</span> <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">"MessierObjects"</span></span>
<span style="color: #009900;">                <span style="color: #000066;">Grid.Row</span>=<span style="color: #ff0000;">"2"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsControl.ItemsPanel<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsPanelTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;StackPanel</span> <span style="color: #000066;">Orientation</span>=<span style="color: #ff0000;">"Horizontal"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsPanelTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsControl.ItemsPanel<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsControl.ItemTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;DataTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid</span> <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">"100"</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"100"</span></span>
<span style="color: #009900;">                    <span style="color: #000066;">MouseLeftButtonUp</span>=<span style="color: #ff0000;">"Grid_MouseLeftButtonUp"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Image</span> <span style="color: #000066;">Source</span>=<span style="color: #ff0000;">"{Binding Path=ThumbSource}"</span></span>
<span style="color: #009900;">                        <span style="color: #000066;">Stretch</span>=<span style="color: #ff0000;">"Fill"</span> <span style="color: #000066;">Margin</span>=<span style="color: #ff0000;">"5"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBlock</span> <span style="color: #000066;">Text</span>=<span style="color: #ff0000;">"{Binding Path=Name}"</span></span>
<span style="color: #009900;">                            <span style="color: #000066;">Margin</span>=<span style="color: #ff0000;">"5"</span></span>
<span style="color: #009900;">                            <span style="color: #000066;">FontSize</span>=<span style="color: #ff0000;">"25"</span> <span style="color: #000066;">FontWeight</span>=<span style="color: #ff0000;">"Bold"</span></span>
<span style="color: #009900;">                            <span style="color: #000066;">Foreground</span>=<span style="color: #ff0000;">"LightGray"</span></span>
<span style="color: #009900;">                            <span style="color: #000066;">Opacity</span>=<span style="color: #ff0000;">"0.5"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/DataTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsControl.ItemTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsControl.Template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ControlTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ScrollViewer</span> <span style="color: #000066;">HorizontalScrollBarVisibility</span>=<span style="color: #ff0000;">"Visible"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsPresenter</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ScrollViewer<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ControlTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsControl.Template<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsControl<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>With a click handler that navigates the map control to the correct location:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> Grid_MouseLeftButtonUp<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">object</span> sender, MouseButtonEventArgs e<span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
    <span style="color: #0600FF; font-weight: bold;">var</span> messier <span style="color: #008000;">=</span> <span style="color: #008000;">(</span><span style="color: #008000;">(</span>FrameworkElement<span style="color: #008000;">)</span>sender<span style="color: #008000;">)</span><span style="color: #008000;">.</span><span style="color: #0000FF;">DataContext</span> <span style="color: #0600FF; font-weight: bold;">as</span> MessierObject<span style="color: #008000;">;</span>
&nbsp;
    map<span style="color: #008000;">.</span><span style="color: #0000FF;">SetView</span><span style="color: #008000;">(</span>messier<span style="color: #008000;">.</span><span style="color: #0000FF;">Coords</span>, <span style="color: #FF0000;">11</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>I would love to build this application further, however, usage of Google Maps tiles outside of their service is a violation of their terms and conditions. For that reason, this code is shown just for a bit of fun, it shows easy it is to bring together two different technologies, Bing Maps and the Google Sky tile imagery, to create something cool with very few lines of code.</p><p>As an aside, I would have liked to have used the data from the less well know <a href="http://en.wikipedia.org/wiki/WorldWide_Telescope">Microsoft WorldWide Telescope</a>, which is accessible through Bing Maps, but just couldn’t work out the tile URL format. This is a shame, I would be happier building this application further based on a Microsoft datasource.</p><p>You can download the sourcecode here: <a href="{{ site.url }}/blog/colin/wp-content/uploads/2011/02/GoogleSkyWP7.zip">GoogleSkyWP7.zip</a></p><p>Regards,<br />
Colin E.</p></div>