---
author: Colin Eberhardt
tags: attached behaviour, silverlight
permalink: /blog/colin/2009/05/silverlight-cliptobounds-can-i-clip-it-yes-you-can/index.html
layout: colineberhardt-blog
---
<div class="entry"><div class="topsy_widget_data topsy_theme_light-green" style="float: right; margin-left: 0.75em; background: url(data:,%7B%20%22url%22%3A%20%22http%253A%252F%252Fwww.scottlogic.co.uk%252Fblog%252Fcolin%252F2009%252F05%252Fsilverlight-cliptobounds-can-i-clip-it-yes-you-can%252F%22%2C%20%22style%22%3A%20%22big%22%2C%20%22title%22%3A%20%22Silverlight%20ClipToBounds%20-%20Can%20I%20Clip%20It%3F%2C%20Yes%20You%20Can%21%20%23%22%20%7D);"></div><p>With Silverlight, Panels do not clip their contents by default. See the following example:</p><p><a href="{{ site.url }}/blog/colin/wp-content/uploads/2009/05/noclip.png"><img class="aligncenter size-full wp-image-293" title="noclip" src="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2009/05/noclip.png" alt="noclip" width="292" height="187" /></a></p><p>Where we have a Grid containing another Grid which itself contains an ellipse, and a Canvas which contains an ellipse:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid</span> <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">"LayoutRoot"</span> <span style="color: #000066;">Background</span>=<span style="color: #ff0000;">"White"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid.ColumnDefinitions<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ColumnDefinition</span> <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">"*"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ColumnDefinition</span> <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">"*"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid.ColumnDefinitions<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid</span> <span style="color: #000066;">Grid.Column</span>=<span style="color: #ff0000;">"0"</span> <span style="color: #000066;">Background</span>=<span style="color: #ff0000;">"Blue"</span> <span style="color: #000066;">Margin</span>=<span style="color: #ff0000;">"20"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>                        
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid</span> <span style="color: #000066;">Background</span>=<span style="color: #ff0000;">"Yellow"</span> <span style="color: #000066;">Margin</span>=<span style="color: #ff0000;">"20,40,-20,20"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Ellipse</span> <span style="color: #000066;">Fill</span>=<span style="color: #ff0000;">"LightGreen"</span> <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">"80"</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"80"</span> <span style="color: #000066;">Margin</span>=<span style="color: #ff0000;">"-40, -40, 0, 0"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Canvas</span> <span style="color: #000066;">Grid.Column</span>=<span style="color: #ff0000;">"1"</span>  <span style="color: #000066;">Background</span>=<span style="color: #ff0000;">"Aqua"</span> <span style="color: #000066;">Margin</span>=<span style="color: #ff0000;">"20"</span> <span style="color: #000000; font-weight: bold;">&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Ellipse</span> <span style="color: #000066;">Fill</span>=<span style="color: #ff0000;">"Red"</span> <span style="color: #000066;">Canvas.Top</span>=<span style="color: #ff0000;">"-10"</span> <span style="color: #000066;">Canvas.Left</span>=<span style="color: #ff0000;">"-10"</span> <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">"130"</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"130"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Canvas<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>Often this is not the desired effect (although it is actually quite a useful feature of Canvas; You can simply add a Canvas to your visual tree without explicitly or implicitly setting its Size and use it as a mechanism for absolute positioning its children).</p><p>Fortunately Silverlight provides a Clip property on UIElement, allowing you to provide the clipping geometry for the element:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid</span> <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">"200"</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"100"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>       
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid.Clip<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;RectangleGeometry</span> <span style="color: #000066;">Rect</span>=<span style="color: #ff0000;">"0, 0, 200, 100"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid.Clip<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>The above example creates a clipping geometry which matches the rectangular geometry of the Grid itself. Clearly more funky clipping geometries can be created, allowing for really cool effects, however most of the time I simply want my Panel clipped so that its children cannot escape!</p><p>The above example has a few problems, Firstly, it is a bit long-winded having to explicitly create the geometry each time I want to clip; Secondly, if my Grid’s size is calculated from its parent’s layout, how can I define the clip geometry in my XAML?; Finally, if my Grid’s geometry changes, its clipped geometry does not change.</p><p>In order to solve this problem I created a simple little <a href="http://www.codeproject.com/KB/WPF/AttachedBehaviors.aspx">attached behaviour</a>, which allows you to define the clipping using the attached property Clip.ToBounds as illustrated below:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;UserControl</span> <span style="color: #000066;">x:Class</span>=<span style="color: #ff0000;">"SilverlightClipToBounds.Page"</span></span>
<span style="color: #009900;">    <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span> </span>
<span style="color: #009900;">    <span style="color: #000066;">xmlns:x</span>=<span style="color: #ff0000;">"http://schemas.microsoft.com/winfx/2006/xaml"</span> </span>
<span style="color: #009900;">    <span style="color: #000066;">xmlns:util</span>=<span style="color: #ff0000;">"clr-namespace:Util"</span> <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">"300"</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"200"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid</span> <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">"LayoutRoot"</span> <span style="color: #000066;">Background</span>=<span style="color: #ff0000;">"White"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid.ColumnDefinitions<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ColumnDefinition</span> <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">"*"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ColumnDefinition</span> <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">"*"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid.ColumnDefinitions<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid</span> <span style="color: #000066;">Grid.Column</span>=<span style="color: #ff0000;">"0"</span> <span style="color: #000066;">Background</span>=<span style="color: #ff0000;">"Blue"</span> <span style="color: #000066;">Margin</span>=<span style="color: #ff0000;">"20"</span> <span style="color: #000066;">util:Clip.ToBounds</span>=<span style="color: #ff0000;">"true"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>       
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid</span> <span style="color: #000066;">Background</span>=<span style="color: #ff0000;">"Yellow"</span> <span style="color: #000066;">Margin</span>=<span style="color: #ff0000;">"20,40,-20,20"</span> <span style="color: #000066;">util:Clip.ToBounds</span>=<span style="color: #ff0000;">"true"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
                <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Ellipse</span> <span style="color: #000066;">Fill</span>=<span style="color: #ff0000;">"LightGreen"</span> <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">"80"</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"80"</span> <span style="color: #000066;">Margin</span>=<span style="color: #ff0000;">"-40, -40, 0, 0"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Canvas</span> <span style="color: #000066;">Grid.Column</span>=<span style="color: #ff0000;">"1"</span>  <span style="color: #000066;">Background</span>=<span style="color: #ff0000;">"Aqua"</span> <span style="color: #000066;">Margin</span>=<span style="color: #ff0000;">"20"</span> <span style="color: #000066;">util:Clip.ToBounds</span>=<span style="color: #ff0000;">"true"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Ellipse</span> <span style="color: #000066;">Fill</span>=<span style="color: #ff0000;">"Red"</span> <span style="color: #000066;">Canvas.Top</span>=<span style="color: #ff0000;">"-10"</span> <span style="color: #000066;">Canvas.Left</span>=<span style="color: #ff0000;">"-10"</span> <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">"130"</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"130"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Canvas<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/UserControl<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>The result can be seen below:</p><p><a href="{{ site.url }}/blog/colin/wp-content/uploads/2009/05/crop.png"><img src="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2009/05/crop.png" alt="crop" title="crop" width="277" height="179" class="aligncenter size-full wp-image-296" /></a></p><p>And here is the code for the attached behaviour itself:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> Clip
<span style="color: #008000;">{</span>
    <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #6666cc; font-weight: bold;">bool</span> GetToBounds<span style="color: #008000;">(</span>DependencyObject depObj<span style="color: #008000;">)</span>
    <span style="color: #008000;">{</span>
        <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">bool</span><span style="color: #008000;">)</span>depObj<span style="color: #008000;">.</span><span style="color: #0000FF;">GetValue</span><span style="color: #008000;">(</span>ToBoundsProperty<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">}</span>
&nbsp;
    <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #6666cc; font-weight: bold;">void</span> SetToBounds<span style="color: #008000;">(</span>DependencyObject depObj, <span style="color: #6666cc; font-weight: bold;">bool</span> clipToBounds<span style="color: #008000;">)</span>
    <span style="color: #008000;">{</span>
        depObj<span style="color: #008000;">.</span><span style="color: #0000FF;">SetValue</span><span style="color: #008000;">(</span>ToBoundsProperty, clipToBounds<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">}</span>
&nbsp;
    <span style="color: #008080; font-style: italic;">/// &lt;summary&gt;</span>
    <span style="color: #008080; font-style: italic;">/// Identifies the ToBounds Dependency Property.</span>
    <span style="color: #008080; font-style: italic;">/// &lt;summary&gt;</span>
    <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #0600FF; font-weight: bold;">readonly</span> DependencyProperty ToBoundsProperty <span style="color: #008000;">=</span>
        DependencyProperty<span style="color: #008000;">.</span><span style="color: #0000FF;">RegisterAttached</span><span style="color: #008000;">(</span><span style="color: #666666;">"ToBounds"</span>, <span style="color: #008000;">typeof</span><span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">bool</span><span style="color: #008000;">)</span>,
        <span style="color: #008000;">typeof</span><span style="color: #008000;">(</span>Clip<span style="color: #008000;">)</span>, <span style="color: #008000;">new</span> PropertyMetadata<span style="color: #008000;">(</span><span style="color: #0600FF; font-weight: bold;">false</span>, OnToBoundsPropertyChanged<span style="color: #008000;">)</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
&nbsp;
    <span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #6666cc; font-weight: bold;">void</span> OnToBoundsPropertyChanged<span style="color: #008000;">(</span>DependencyObject d,
        DependencyPropertyChangedEventArgs e<span style="color: #008000;">)</span>
    <span style="color: #008000;">{</span>
        FrameworkElement fe <span style="color: #008000;">=</span> d <span style="color: #0600FF; font-weight: bold;">as</span> FrameworkElement<span style="color: #008000;">;</span>
        <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">(</span>fe <span style="color: #008000;">!=</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">)</span>
        <span style="color: #008000;">{</span>
            ClipToBounds<span style="color: #008000;">(</span>fe<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
            <span style="color: #008080; font-style: italic;">// whenever the element which this property is attached to is loaded</span>
            <span style="color: #008080; font-style: italic;">// or re-sizes, we need to update its clipping geometry</span>
            fe<span style="color: #008000;">.</span><span style="color: #0000FF;">Loaded</span> <span style="color: #008000;">+=</span> <span style="color: #008000;">new</span> RoutedEventHandler<span style="color: #008000;">(</span>fe_Loaded<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
            fe<span style="color: #008000;">.</span><span style="color: #0000FF;">SizeChanged</span> <span style="color: #008000;">+=</span> <span style="color: #008000;">new</span> SizeChangedEventHandler<span style="color: #008000;">(</span>fe_SizeChanged<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
        <span style="color: #008000;">}</span>
    <span style="color: #008000;">}</span>
&nbsp;
    <span style="color: #008080; font-style: italic;">/// &lt;summary&gt;</span>
    <span style="color: #008080; font-style: italic;">/// Creates a rectangular clipping geometry which matches the geometry of the</span>
    <span style="color: #008080; font-style: italic;">/// passed element</span>
    <span style="color: #008080; font-style: italic;">/// &lt;/summary&gt;</span>
    <span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #6666cc; font-weight: bold;">void</span> ClipToBounds<span style="color: #008000;">(</span>FrameworkElement fe<span style="color: #008000;">)</span>
    <span style="color: #008000;">{</span>
        <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">(</span>GetToBounds<span style="color: #008000;">(</span>fe<span style="color: #008000;">)</span><span style="color: #008000;">)</span>
        <span style="color: #008000;">{</span>
            fe<span style="color: #008000;">.</span><span style="color: #0000FF;">Clip</span> <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> RectangleGeometry<span style="color: #008000;">(</span><span style="color: #008000;">)</span>
            <span style="color: #008000;">{</span>
                Rect <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> Rect<span style="color: #008000;">(</span><span style="color: #FF0000;">0</span>, <span style="color: #FF0000;">0</span>, fe<span style="color: #008000;">.</span><span style="color: #0000FF;">ActualWidth</span>, fe<span style="color: #008000;">.</span><span style="color: #0000FF;">ActualHeight</span><span style="color: #008000;">)</span>
            <span style="color: #008000;">}</span><span style="color: #008000;">;</span>
        <span style="color: #008000;">}</span>
        <span style="color: #0600FF; font-weight: bold;">else</span>
        <span style="color: #008000;">{</span>
            fe<span style="color: #008000;">.</span><span style="color: #0000FF;">Clip</span> <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">;</span>
        <span style="color: #008000;">}</span>
    <span style="color: #008000;">}</span>
&nbsp;
    <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #6666cc; font-weight: bold;">void</span> fe_SizeChanged<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">object</span> sender, SizeChangedEventArgs e<span style="color: #008000;">)</span>
    <span style="color: #008000;">{</span>
        ClipToBounds<span style="color: #008000;">(</span>sender <span style="color: #0600FF; font-weight: bold;">as</span> FrameworkElement<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">}</span>
&nbsp;
    <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #6666cc; font-weight: bold;">void</span> fe_Loaded<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">object</span> sender, RoutedEventArgs e<span style="color: #008000;">)</span>
    <span style="color: #008000;">{</span>
        ClipToBounds<span style="color: #008000;">(</span>sender <span style="color: #0600FF; font-weight: bold;">as</span> FrameworkElement<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">}</span>    
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>When the <code>ToBounds</code> property is associated with an element, <code>ClipToBounds</code> is invoked to create a rectangular clip geometry. We also add event handlers for <code>Loaded</code>, which is a very useful event which is fired when an element has been laid out and rendered, in other words it’s size will have been computed, and <code>SizeChanged</code>. In the event handlers for both we simply update the clipping geometry.</p><p>This can be seen in action here, where clicking on the Grids or Canvas increases their size, with the clipping geometry growing accordingly:</p><div id="slPluginHost"> <object id="SilverlightPlugin" width="300" height="300" data="data:application/x-silverlight," type="application/x-silverlight-2"><param name="source" value="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2009/05/silverlightcliptobounds.xap" /><a href="http://go.microsoft.com/fwlink/?LinkID=124807" style="text-decoration: none;"> <img src="http://go.microsoft.com/fwlink/?LinkId=108181" alt="Get Microsoft Silverlight" style="border-style: none;" /></a></object></div><p>You can download a demo project here: <a href="{{ site.url }}/blog/colin/wp-content/uploads/2009/05/sliverlightcliptobounds.zip">sliverlightcliptobounds.zip</a></p><p>Can I Clip It?, Yes You Can!</p><p>Regards, Colin E.</p></div>