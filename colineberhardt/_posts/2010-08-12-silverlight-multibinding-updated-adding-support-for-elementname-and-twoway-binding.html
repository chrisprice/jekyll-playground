---
author: Colin Eberhardt
tags: binding, multibinding, silverlight, virtual branch, WPF
permalink: /blog/colin/2010/08/silverlight-multibinding-updated-adding-support-for-elementname-and-twoway-binding/index.html
layout: colineberhardt-blog
---
<div class="entry"><div class="topsy_widget_data topsy_theme_light-green" style="float: right; margin-left: 0.75em; background: url(data:,%7B%20%22url%22%3A%20%22http%253A%252F%252Fwww.scottlogic.co.uk%252Fblog%252Fcolin%252F2010%252F08%252Fsilverlight-multibinding-updated-adding-support-for-elementname-and-twoway-binding%252F%22%2C%20%22style%22%3A%20%22big%22%2C%20%22title%22%3A%20%22Silverlight%20MultiBinding%20updated%2C%20adding%20support%20for%20ElementName%20and%20TwoWay%20binding%20%23%22%20%7D);"></div><p><em>This blog post describes an update to the Silverlight 4 MultiBinding technique I blogged about a couple of months ago to add support for ElementName binding and TwoWay binding.</em></p><p>A few months ago I posted an update to my MultiBinding solution for Silverlight 4. This technique allows you to perform the same kind of multibindings which are possible in WPF, where a property value is bound to multiple sources via a special value converter that implements the IMultiValueConverter interface, which describes how these values are combined. This update proved popular once again, and I received a few requests to add support for ElementName and TwoWay binding. I like challenge! This blog post describes how these two features were implemented, but if you just want to grab the code, you will find the link at the end of this article.</p><p><strong>A brief recap</strong></p><p>Before I go into the implementation details for the new features I will provide a brief recap of how my multibinding solution works. The XAML for creating a multibinding looks like the following:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBlock</span> <span style="color: #000066;">Foreground</span>=<span style="color: #ff0000;">"White"</span> </span>
<span style="color: #009900;">  <span style="color: #000000; font-weight: bold;">&lt;local:BindingUtil.MultiBindings<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:MultiBindings<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:MultiBinding</span> <span style="color: #000066;">TargetProperty</span>=<span style="color: #ff0000;">"Text"</span></span>
<span style="color: #009900;">                          <span style="color: #000066;">Converter</span>=<span style="color: #ff0000;">"{StaticResource TitleConverter}"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:BindingCollection<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Binding</span> <span style="color: #000066;">Path</span>=<span style="color: #ff0000;">"Surname"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Binding</span> <span style="color: #000066;">Path</span>=<span style="color: #ff0000;">"Forename"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:BindingCollection<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:MultiBinding<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:MultiBinding</span> <span style="color: #000066;">TargetProperty</span>=<span style="color: #ff0000;">"ToolTipService.ToolTip"</span></span>
<span style="color: #009900;">                          <span style="color: #000066;">Converter</span>=<span style="color: #ff0000;">"{StaticResource TitleConverter}"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:BindingCollection<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Binding</span> <span style="color: #000066;">Path</span>=<span style="color: #ff0000;">"Surname"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Binding</span> <span style="color: #000066;">Path</span>=<span style="color: #ff0000;">"Forename"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:BindingCollection<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:MultiBinding<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:MultiBindings<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:BindingUtil.MultiBindings<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/TextBlock<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>Here the Text property and attached ToolTip property of the TextBlock are bound to both the Surname and Forename property of the business object which is set as the DataContext of our view.</p><p>The value converter is as follows:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> TitleConverter <span style="color: #008000;">:</span> IMultiValueConverter
<span style="color: #008000;">{</span>
&nbsp;
  <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">object</span> Convert<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">object</span><span style="color: #008000;">[</span><span style="color: #008000;">]</span> values, Type targetType,
    <span style="color: #6666cc; font-weight: bold;">object</span> parameter, CultureInfo culture<span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    <span style="color: #6666cc; font-weight: bold;">string</span> forename <span style="color: #008000;">=</span> values<span style="color: #008000;">[</span><span style="color: #FF0000;">0</span><span style="color: #008000;">]</span> <span style="color: #0600FF; font-weight: bold;">as</span> <span style="color: #6666cc; font-weight: bold;">string</span><span style="color: #008000;">;</span>
    <span style="color: #6666cc; font-weight: bold;">string</span> surname <span style="color: #008000;">=</span> values<span style="color: #008000;">[</span><span style="color: #FF0000;">1</span><span style="color: #008000;">]</span> <span style="color: #0600FF; font-weight: bold;">as</span> <span style="color: #6666cc; font-weight: bold;">string</span><span style="color: #008000;">;</span>
&nbsp;
    <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #6666cc; font-weight: bold;">string</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Format</span><span style="color: #008000;">(</span><span style="color: #666666;">"{0}, {1}"</span>, surname, forename<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  <span style="color: #008000;">}</span>
&nbsp;
  <span style="color: #008000;">...</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>In the example below you can see that as you change the forename or surname, the title text and tooltip are updated by the multibinding.</p><div> <object width="200" height="150" data="data:application/x-silverlight," type="application/x-silverlight-2"><param name="source" value="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2010/08/SLMultiBindingOne.xap" /><a href="http://go.microsoft.com/fwlink/?LinkID=124807" style="text-decoration: none;"> <img src="http://go.microsoft.com/fwlink/?LinkId=108181" alt="Get Microsoft Silverlight" style="border-style: none;" /></a></object></div><p>So how does this work?</p><p>When a multibinding is created and added to an element via the BindingUtil.MultiBindings attached property, the MultiBinding instance is added to a virtual-branch, this is a branch of the visual tree that obtains the DataContext of the element to which it is bound, but is not added to the visual tree itself. The MultiBinding then creates a BindingSlave instance for each of the given Bindings. These ‘slave’ elements inherit the MultiBinding DataContext and are used to evaluate each of the individual Bindings. The MultiBinding instance aggregate the results of each binding with the IMultiValueConverter used to compute the ConvertedValue property which is bound to the target property on the element to which this MultiBinding as attached.</p><p><img src="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2009/06/virtualbranch.png" alt="" title="virtualbranch" width="604" height="394" class="aligncenter size-full wp-image-355" /></p><p><strong>ElementName binding</strong></p><p>So why does the above solution not work if one of the multibindings uses ElementName to locate the source rather than using the inherited DataContext? The problem here is that the MultiBinding and its BindingSlave instances are located in a virtual branch and are therefore not in the same <a href="http://msdn.microsoft.com/en-us/library/cc189026%28VS.95%29.aspx">namescope</a> as the target element. As a result, they cannot perform look up of named elements.</p><p>In order to solve this problem I created a BindingSlave subclass specifically for ElementName binding. This slave locates the source element named via the ElementName property and sets it as the Source of the binding it uses to compute its Value property.</p><p>The only minor complication I encountered is that the MultiBinding might be constructed before the element referenced via ElementName. For this reason the binding slave must handle LayoutUpdated events to ensure that the named element is located if it is constructed after the multibinding.</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> ElementNameBindingSlave <span style="color: #008000;">:</span> BindingSlave
<span style="color: #008000;">{</span>
  <span style="color: #0600FF; font-weight: bold;">private</span> FrameworkElement _multiBindingTarget<span style="color: #008000;">;</span>
&nbsp;
  <span style="color: #008080; font-style: italic;">/// &lt;summary&gt;</span>
  <span style="color: #008080; font-style: italic;">/// The source element named in the ElementName binding</span>
  <span style="color: #008080; font-style: italic;">/// &lt;/summary&gt;</span>
  <span style="color: #0600FF; font-weight: bold;">private</span> FrameworkElement _elementNameSource<span style="color: #008000;">;</span>
&nbsp;
  <span style="color: #0600FF; font-weight: bold;">private</span> Binding _binding<span style="color: #008000;">;</span>
&nbsp;
  <span style="color: #0600FF; font-weight: bold;">public</span> ElementNameBindingSlave<span style="color: #008000;">(</span>FrameworkElement target, Binding binding<span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    _multiBindingTarget <span style="color: #008000;">=</span> target<span style="color: #008000;">;</span>
    _binding <span style="color: #008000;">=</span> binding<span style="color: #008000;">;</span>
&nbsp;
    <span style="color: #008080; font-style: italic;">// try to locate the named element</span>
    ResolveElementNameBinding<span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
    _multiBindingTarget<span style="color: #008000;">.</span><span style="color: #0000FF;">LayoutUpdated</span> <span style="color: #008000;">+=</span> MultiBindingTarget_LayoutUpdated<span style="color: #008000;">;</span>
  <span style="color: #008000;">}</span>
&nbsp;
  <span style="color: #008080; font-style: italic;">/// &lt;summary&gt;</span>
  <span style="color: #008080; font-style: italic;">/// Try to locate the named element. If the element can be located, create the required</span>
  <span style="color: #008080; font-style: italic;">/// binding.</span>
  <span style="color: #008080; font-style: italic;">/// &lt;/summary&gt;</span>
  <span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> ResolveElementNameBinding<span style="color: #008000;">(</span><span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    _elementNameSource <span style="color: #008000;">=</span> _multiBindingTarget<span style="color: #008000;">.</span><span style="color: #0000FF;">FindName</span><span style="color: #008000;">(</span>_binding<span style="color: #008000;">.</span><span style="color: #0000FF;">ElementName</span><span style="color: #008000;">)</span> <span style="color: #0600FF; font-weight: bold;">as</span> FrameworkElement<span style="color: #008000;">;</span>
    <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">(</span>_elementNameSource <span style="color: #008000;">!=</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">)</span>
    <span style="color: #008000;">{</span>
      SetBinding<span style="color: #008000;">(</span>BindingSlave<span style="color: #008000;">.</span><span style="color: #0000FF;">ValueProperty</span>, <span style="color: #008000;">new</span> Binding<span style="color: #008000;">(</span><span style="color: #008000;">)</span>
      <span style="color: #008000;">{</span>
        Source <span style="color: #008000;">=</span> _elementNameSource,
        Path <span style="color: #008000;">=</span> _binding<span style="color: #008000;">.</span><span style="color: #0000FF;">Path</span>,
        Converter <span style="color: #008000;">=</span> _binding<span style="color: #008000;">.</span><span style="color: #0000FF;">Converter</span>,
        ConverterParameter <span style="color: #008000;">=</span> _binding<span style="color: #008000;">.</span><span style="color: #0000FF;">ConverterParameter</span>
      <span style="color: #008000;">}</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">}</span>
  <span style="color: #008000;">}</span>
&nbsp;
  <span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> MultiBindingTarget_LayoutUpdated<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">object</span> sender, EventArgs e<span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    <span style="color: #008080; font-style: italic;">// try to locate the named element </span>
    ResolveElementNameBinding<span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>The example below demonstrates element name binding by binding the Value of two Slider elements to a TextBlock which displays the sum of the two values.</p><div> <object width="200" height="150" data="data:application/x-silverlight," type="application/x-silverlight-2"><param name="source" value="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2010/08/SLMultiBindingTwo.xap" /><a href="http://go.microsoft.com/fwlink/?LinkID=124807" style="text-decoration: none;"> <img src="http://go.microsoft.com/fwlink/?LinkId=108181" alt="Get Microsoft Silverlight" style="border-style: none;" /></a></object></div><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBlock</span> <span style="color: #000066;">Grid.Column</span>=<span style="color: #ff0000;">"1"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:BindingUtil.MultiBindings<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:MultiBindings<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:MultiBinding</span> <span style="color: #000066;">TargetProperty</span>=<span style="color: #ff0000;">"Text"</span></span>
<span style="color: #009900;">                          <span style="color: #000066;">Converter</span>=<span style="color: #ff0000;">"{StaticResource SliderValueConverter}"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:BindingCollection<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Binding</span> <span style="color: #000066;">ElementName</span>=<span style="color: #ff0000;">"sliderOne"</span> <span style="color: #000066;">Path</span>=<span style="color: #ff0000;">"Value"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Binding</span> <span style="color: #000066;">ElementName</span>=<span style="color: #ff0000;">"sliderTwo"</span> <span style="color: #000066;">Path</span>=<span style="color: #ff0000;">"Value"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:BindingCollection<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:MultiBinding<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:MultiBindings<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:BindingUtil.MultiBindings<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/TextBlock<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Slider</span> <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">"sliderOne"</span> <span style="color: #000066;">Value</span>=<span style="color: #ff0000;">"10"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
&nbsp;
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Slider</span> <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">"sliderTwo"</span>  <span style="color: #000066;">Value</span>=<span style="color: #ff0000;">"20"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span></pre></td></tr></table></div><p>Here is the value converter that is used to compute the sum:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> SliderValueConverter <span style="color: #008000;">:</span> IMultiValueConverter
<span style="color: #008000;">{</span>
&nbsp;
  <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">object</span> Convert<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">object</span><span style="color: #008000;">[</span><span style="color: #008000;">]</span> values, Type targetType, <span style="color: #6666cc; font-weight: bold;">object</span> parameter, <span style="color: #000000;">System.<span style="color: #0000FF;">Globalization</span></span><span style="color: #008000;">.</span><span style="color: #0000FF;">CultureInfo</span> culture<span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">(</span>values<span style="color: #008000;">.</span><span style="color: #0000FF;">Length</span> <span style="color: #008000;">!=</span> <span style="color: #FF0000;">2</span> <span style="color: #008000;">||</span>
        values<span style="color: #008000;">[</span><span style="color: #FF0000;">0</span><span style="color: #008000;">]</span> <span style="color: #008000;">==</span> <span style="color: #0600FF; font-weight: bold;">null</span> <span style="color: #008000;">||</span>
        values<span style="color: #008000;">[</span><span style="color: #FF0000;">1</span><span style="color: #008000;">]</span> <span style="color: #008000;">==</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">)</span>
      <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">;</span>
&nbsp;
    <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">double</span><span style="color: #008000;">)</span>values<span style="color: #008000;">[</span><span style="color: #FF0000;">0</span><span style="color: #008000;">]</span> <span style="color: #008000;">+</span> <span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">double</span><span style="color: #008000;">)</span>values<span style="color: #008000;">[</span><span style="color: #FF0000;">1</span><span style="color: #008000;">]</span><span style="color: #008000;">;</span>
  <span style="color: #008000;">}</span>
&nbsp;
  <span style="color: #008000;">...</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>You could of course use element name binding to combine the surname / forename in the first example in this blog post, but in this context it is more likely that you will want to back your UI with a business object. It is also possible to mix element name and regular (i.e. Source=DataContext) binding.</p><p>I find multibindings which use ElementName references most useful when creating complex UI layouts that do not lend themselves to being implemented using Panels. For a good example see my article on <a href="http://www.codeproject.com/KB/WPF/WpfWinFormsBulletGraphs.aspx">the implementation of a BulletGraph control </a>which makes extensive use of this technique in order that the layout of the control is performed entirely within XAML.</p><p><strong>TwoWay Binding</strong></p><p>A two-way multibinding must be able to handle updates to the combined value and split it up into its constituent parts in order to update the multiple source bindings. In the first example where a forename and surname property are combined into a “surname, forename” string it is possible to convert back the other way, but in the example above where the values of two Sliders are combined a reverse conversion is not possible.</p><p>Modifying this multibinding solution to permit two way binding was relatively straightforward. A property changed event handler was added to the MultiBindig.ConverterValue (which is bound to the multi binding target) so that we can determine when changes have been made. This handler then uses the IMultiValueConverter to convert the value into the multiple source properties and updates the binding slaves accordingly:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #008080; font-style: italic;">/// &lt;summary&gt;</span>
<span style="color: #008080; font-style: italic;">/// Handles property changes for the ConvertedValue property</span>
<span style="color: #008080; font-style: italic;">/// &lt;/summary&gt;</span>
<span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> OnConvertedValuePropertyChanged<span style="color: #008000;">(</span><span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
    OnPropertyChanged<span style="color: #008000;">(</span><span style="color: #666666;">"ConvertedValue"</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
    <span style="color: #008080; font-style: italic;">// if the value is being updated, but not due to one of the multibindings</span>
    <span style="color: #008080; font-style: italic;">// then the target property has changed.</span>
    <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">(</span><span style="color: #008000;">!</span>_updatingConvertedValue<span style="color: #008000;">)</span>
    <span style="color: #008000;">{</span>
      <span style="color: #008080; font-style: italic;">// convert back</span>
      <span style="color: #6666cc; font-weight: bold;">object</span><span style="color: #008000;">[</span><span style="color: #008000;">]</span> convertedValues <span style="color: #008000;">=</span> Converter<span style="color: #008000;">.</span><span style="color: #0000FF;">ConvertBack</span><span style="color: #008000;">(</span>ConvertedValue, <span style="color: #0600FF; font-weight: bold;">null</span>,
          ConverterParameter, CultureInfo<span style="color: #008000;">.</span><span style="color: #0000FF;">InvariantCulture</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
      <span style="color: #008080; font-style: italic;">// update all the binding slaves</span>
      <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">(</span>Children<span style="color: #008000;">.</span><span style="color: #0000FF;">Count</span> <span style="color: #008000;">==</span> convertedValues<span style="color: #008000;">.</span><span style="color: #0000FF;">Length</span><span style="color: #008000;">)</span>
      <span style="color: #008000;">{</span>
        <span style="color: #0600FF; font-weight: bold;">for</span> <span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">int</span> index <span style="color: #008000;">=</span> <span style="color: #FF0000;">0</span><span style="color: #008000;">;</span> index <span style="color: #008000;">&lt;</span> convertedValues<span style="color: #008000;">.</span><span style="color: #0000FF;">Length</span><span style="color: #008000;">;</span> index<span style="color: #008000;">++</span><span style="color: #008000;">)</span>
        <span style="color: #008000;">{</span>
          <span style="color: #008000;">(</span><span style="color: #008000;">(</span>BindingSlave<span style="color: #008000;">)</span>Children<span style="color: #008000;">[</span>index<span style="color: #008000;">]</span><span style="color: #008000;">)</span><span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Value</span> <span style="color: #008000;">=</span> convertedValues<span style="color: #008000;">[</span>index<span style="color: #008000;">]</span><span style="color: #008000;">;</span>
        <span style="color: #008000;">}</span>
      <span style="color: #008000;">}</span>
    <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>In order to use two way multibinding both the multibinding mode <em>and</em> the bindings within the BindingCollection must be set to TwoWay. See the example given below:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBlock</span> <span style="color: #000066;">Text</span>=<span style="color: #ff0000;">"Surname:"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBox</span>  <span style="color: #000066;">Grid.Column</span>=<span style="color: #ff0000;">"1"</span> <span style="color: #000066;">Text</span>=<span style="color: #ff0000;">"{Binding Path=Surname, Mode=TwoWay}"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
&nbsp;
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBlock</span> <span style="color: #000066;">Grid.Row</span>=<span style="color: #ff0000;">"1"</span> <span style="color: #000066;">Text</span>=<span style="color: #ff0000;">"Forename:"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBox</span> <span style="color: #000066;">Grid.Row</span>=<span style="color: #ff0000;">"1"</span>  <span style="color: #000066;">Grid.Column</span>=<span style="color: #ff0000;">"1"</span> <span style="color: #000066;">Text</span>=<span style="color: #ff0000;">"{Binding Path=Forename, Mode=TwoWay}"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
&nbsp;
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBlock</span> <span style="color: #000066;">Grid.Row</span>=<span style="color: #ff0000;">"2"</span> <span style="color: #000066;">Text</span>=<span style="color: #ff0000;">"Combined:"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBox</span> <span style="color: #000066;">Grid.Row</span>=<span style="color: #ff0000;">"2"</span>  <span style="color: #000066;">Grid.Column</span>=<span style="color: #ff0000;">"1"</span> <span style="color: #000000; font-weight: bold;">&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:BindingUtil.MultiBindings<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:MultiBindings<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:MultiBinding</span> <span style="color: #000066;">TargetProperty</span>=<span style="color: #ff0000;">"Text"</span></span>
<span style="color: #009900;">                        <span style="color: #000066;">Converter</span>=<span style="color: #ff0000;">"{StaticResource TitleConverter}"</span></span>
<span style="color: #009900;">                        <span style="color: #000066;">Mode</span>=<span style="color: #ff0000;">"TwoWay"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:BindingCollection<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Binding</span> <span style="color: #000066;">Path</span>=<span style="color: #ff0000;">"Surname"</span> <span style="color: #000066;">Mode</span>=<span style="color: #ff0000;">"TwoWay"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Binding</span> <span style="color: #000066;">Path</span>=<span style="color: #ff0000;">"Forename"</span> <span style="color: #000066;">Mode</span>=<span style="color: #ff0000;">"TwoWay"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:BindingCollection<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:MultiBinding<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:MultiBindings<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:BindingUtil.MultiBindings<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/TextBox<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>You can have  try of two way multibinding below where the values of the forename and surname text boxes are combined in the box below. However, you ca also make updates to the combined result which will then be converted back into its constituent parts:</p><div> <object width="300" height="150" data="data:application/x-silverlight," type="application/x-silverlight-2"><param name="source" value="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2010/08/SLMultiBindingThree.xap" /><a href="http://go.microsoft.com/fwlink/?LinkID=124807" style="text-decoration: none;"> <img src="http://go.microsoft.com/fwlink/?LinkId=108181" alt="Get Microsoft Silverlight" style="border-style: none;" /></a></object></div><p>And here is the value converter:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> TitleConverter <span style="color: #008000;">:</span> IMultiValueConverter
<span style="color: #008000;">{</span>
  <span style="color: #008080;">#region IMultiValueConverter Members</span>
&nbsp;
  <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">object</span> Convert<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">object</span><span style="color: #008000;">[</span><span style="color: #008000;">]</span> values, Type targetType,
    <span style="color: #6666cc; font-weight: bold;">object</span> parameter, <span style="color: #000000;">System.<span style="color: #0000FF;">Globalization</span></span><span style="color: #008000;">.</span><span style="color: #0000FF;">CultureInfo</span> culture<span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    <span style="color: #6666cc; font-weight: bold;">string</span> forename <span style="color: #008000;">=</span> values<span style="color: #008000;">[</span><span style="color: #FF0000;">0</span><span style="color: #008000;">]</span> <span style="color: #0600FF; font-weight: bold;">as</span> <span style="color: #6666cc; font-weight: bold;">string</span><span style="color: #008000;">;</span>
    <span style="color: #6666cc; font-weight: bold;">string</span> surname <span style="color: #008000;">=</span> values<span style="color: #008000;">[</span><span style="color: #FF0000;">1</span><span style="color: #008000;">]</span> <span style="color: #0600FF; font-weight: bold;">as</span> <span style="color: #6666cc; font-weight: bold;">string</span><span style="color: #008000;">;</span>
&nbsp;
    <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #6666cc; font-weight: bold;">string</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Format</span><span style="color: #008000;">(</span><span style="color: #666666;">"{0}, {1}"</span>, surname, forename<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  <span style="color: #008000;">}</span>
&nbsp;
  <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">object</span><span style="color: #008000;">[</span><span style="color: #008000;">]</span> ConvertBack<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">object</span> <span style="color: #0600FF; font-weight: bold;">value</span>, Type<span style="color: #008000;">[</span><span style="color: #008000;">]</span> targetTypes,
    <span style="color: #6666cc; font-weight: bold;">object</span> parameter, <span style="color: #000000;">System.<span style="color: #0000FF;">Globalization</span></span><span style="color: #008000;">.</span><span style="color: #0000FF;">CultureInfo</span> culture<span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    <span style="color: #6666cc; font-weight: bold;">string</span> source <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">value</span> <span style="color: #0600FF; font-weight: bold;">as</span> <span style="color: #6666cc; font-weight: bold;">string</span><span style="color: #008000;">;</span>
    <span style="color: #0600FF; font-weight: bold;">var</span> pos <span style="color: #008000;">=</span> source<span style="color: #008000;">.</span><span style="color: #0000FF;">IndexOf</span><span style="color: #008000;">(</span><span style="color: #666666;">", "</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
    <span style="color: #6666cc; font-weight: bold;">string</span> forename <span style="color: #008000;">=</span> source<span style="color: #008000;">.</span><span style="color: #0000FF;">Substring</span><span style="color: #008000;">(</span>pos <span style="color: #008000;">+</span> <span style="color: #FF0000;">2</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
    <span style="color: #6666cc; font-weight: bold;">string</span> surname <span style="color: #008000;">=</span> source<span style="color: #008000;">.</span><span style="color: #0000FF;">Substring</span><span style="color: #008000;">(</span><span style="color: #FF0000;">0</span>, pos<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
    <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #008000;">new</span> <span style="color: #6666cc; font-weight: bold;">object</span><span style="color: #008000;">[</span><span style="color: #008000;">]</span> <span style="color: #008000;">{</span> forename, surname <span style="color: #008000;">}</span><span style="color: #008000;">;</span>
  <span style="color: #008000;">}</span>
&nbsp;
  <span style="color: #008080;">#endregion</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>So, there you have it, two-way and element name multibinding <img src="http://www.scottlogic.co.uk/blog/colin/wp-includes/images/smilies/icon_smile.gif" alt=":-)" class="wp-smiley" /> </p><p>You can download the full source, including a WPF build (thanks to <a href="http://www.olsonsoft.com/blogs/stefanolson/">Stefan Olson</a>) here: <a href="{{ site.url }}/blog/colin/wp-content/uploads/2010/08/SLMultiBindingUpdated.zip">SLMultiBindingUpdated.zip</a> </p><p>Now … go forth and multibind.</p><p>Regards, Colin E.</p></div>