---
author: Colin Eberhardt
tags: charts, twitter, uksnow, visiblox
permalink: /blog/colin/2010/12/uksnow-silverlight-the-movie-happy-christmas/index.html
layout: colineberhardt-blog
---
<div class="entry"><div class="topsy_widget_data topsy_theme_light-green" style="float: right; margin-left: 0.75em; background: url(data:,%7B%20%22url%22%3A%20%22http%253A%252F%252Fwww.scottlogic.co.uk%252Fblog%252Fcolin%252F2010%252F12%252Fuksnow-silverlight-the-movie-happy-christmas%252F%22%2C%20%22style%22%3A%20%22big%22%2C%20%22title%22%3A%20%22%23uksnow%20%23silverlight%20The%20Movie%21%20-%20Happy%20Christmas.%20%23%22%20%7D);"></div><p>It’s Christmas Eve and time for some fun! A few weeks back <a href="{{ site.url }}/blog/colin/2010/11/uksnow-silverlight-an-rx-powered-twitter-bing-maps-mashup/">I published an article on Reactive Extensions</a> where I created a Bing Maps / Twitter mashup that plotted the geolocation of #uksnow twitter tags. This twitter hashtag was popularised by <a href="http://uksnowmap.com/">Ben Marsh</a> and is used by us weather obsessed brits to give a realtime update of snowfall. To use this hashtag tweet #uksnow with your postcode and the amount of snowfall out of ten (e.g. 7/10).</p><p>The snow has continued to fall in record quantities across the uk, so I thought it might be fun to create “#uksnow The Movie”, where you can replay the snowfall across the UK. You can see the finished app below. Hit the ‘play’ button, or drag the time indicator on the chart to replay the snowfall and re-live the fun! You can also mouse-over the snowflakes to see the original #uksnow tweet.</p><div style="text-align: center; margin: 0 0 40px 0;"><object width="500" height="600" data="data:application/x-silverlight," type="application/x-silverlight-2"><param name="source" value="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2010/12/UKSnowTheMovie1.xap" /><a href="http://go.microsoft.com/fwlink/?LinkID=124807" style="text-decoration: none;"> <img src="http://go.microsoft.com/fwlink/?LinkId=108181" alt="Get Microsoft Silverlight" style="border-style: none;" /></a></object></div><p>To create this application I modified my original app to extract as many #uksnow tweets from twitter as possible. Unfortunately the public search API only server tweets from the last ~ 7 days. If anyone knows of a free historic service, please let me know!</p><p>The application above contains an XML file with all the historic tweets. When it starts up, it parses the XML file.The chart displays the tweets ‘binned’ in 30 minute intervals, which is achieved via a simple <code>GroupBy</code> query:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #008080; font-style: italic;">// parse the XML file</span>
_tweets <span style="color: #008000;">=</span> doc<span style="color: #008000;">.</span><span style="color: #0000FF;">Descendants</span><span style="color: #008000;">(</span><span style="color: #666666;">"tweet"</span><span style="color: #008000;">)</span><span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Select</span><span style="color: #008000;">(</span>el <span style="color: #008000;">=&gt;</span> <span style="color: #008000;">new</span> GeoCodedUKSnowTweet<span style="color: #008000;">(</span><span style="color: #008000;">)</span>
                                  <span style="color: #008000;">{</span>
                                    Author <span style="color: #008000;">=</span> el<span style="color: #008000;">.</span><span style="color: #0000FF;">Attribute</span><span style="color: #008000;">(</span><span style="color: #666666;">"author"</span><span style="color: #008000;">)</span><span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Value</span>,
                                    Title <span style="color: #008000;">=</span> el<span style="color: #008000;">.</span><span style="color: #0000FF;">Attribute</span><span style="color: #008000;">(</span><span style="color: #666666;">"title"</span><span style="color: #008000;">)</span><span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Value</span>,
                                    ProfileImageUrl <span style="color: #008000;">=</span> el<span style="color: #008000;">.</span><span style="color: #0000FF;">Attribute</span><span style="color: #008000;">(</span><span style="color: #666666;">"profile"</span><span style="color: #008000;">)</span><span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Value</span>,
                                    Location <span style="color: #008000;">=</span> StringToPoint<span style="color: #008000;">(</span>el<span style="color: #008000;">.</span><span style="color: #0000FF;">Attribute</span><span style="color: #008000;">(</span><span style="color: #666666;">"loc"</span><span style="color: #008000;">)</span><span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Value</span><span style="color: #008000;">)</span>,
                                    SnowFactor <span style="color: #008000;">=</span> <span style="color: #6666cc; font-weight: bold;">int</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Parse</span><span style="color: #008000;">(</span>el<span style="color: #008000;">.</span><span style="color: #0000FF;">Attribute</span><span style="color: #008000;">(</span><span style="color: #666666;">"snowfactor"</span><span style="color: #008000;">)</span><span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Value</span><span style="color: #008000;">)</span>,
                                    Timestamp <span style="color: #008000;">=</span> DateTime<span style="color: #008000;">.</span><span style="color: #0000FF;">Parse</span><span style="color: #008000;">(</span>el<span style="color: #008000;">.</span><span style="color: #0000FF;">Attribute</span><span style="color: #008000;">(</span><span style="color: #666666;">"timestamp"</span><span style="color: #008000;">)</span><span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Value</span><span style="color: #008000;">)</span>
                                  <span style="color: #008000;">}</span><span style="color: #008000;">)</span>
                                  <span style="color: #008000;">.</span><span style="color: #0000FF;">OrderBy</span><span style="color: #008000;">(</span>t <span style="color: #008000;">=&gt;</span> t<span style="color: #008000;">.</span><span style="color: #0000FF;">Timestamp</span><span style="color: #008000;">)</span>                                        
                                  <span style="color: #008000;">.</span><span style="color: #0000FF;">ToList</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
<span style="color: #008080; font-style: italic;">// total the tweets per 30 minute interval</span>
<span style="color: #0600FF; font-weight: bold;">var</span> groupedByHour <span style="color: #008000;">=</span> _tweets<span style="color: #008000;">.</span><span style="color: #0000FF;">GroupBy</span><span style="color: #008000;">(</span>t <span style="color: #008000;">=&gt;</span> RoundDateToMinutes<span style="color: #008000;">(</span>t<span style="color: #008000;">.</span><span style="color: #0000FF;">Timestamp</span>, <span style="color: #FF0000;">30</span><span style="color: #008000;">)</span><span style="color: #008000;">)</span>
                          <span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Select</span><span style="color: #008000;">(</span><span style="color: #0600FF; font-weight: bold;">group</span> <span style="color: #008000;">=&gt;</span> 
                            <span style="color: #008000;">new</span> TweetsPerHour<span style="color: #008000;">(</span><span style="color: #008000;">)</span> <span style="color: #008000;">{</span>
                              Hour <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">group</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Key</span>,
                              Tweets <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">group</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Count</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span>
                            <span style="color: #008000;">}</span><span style="color: #008000;">)</span><span style="color: #008000;">.</span><span style="color: #0000FF;">ToList</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
<span style="color: #008080; font-style: italic;">// associate the above with the chart</span>
chart<span style="color: #008000;">.</span><span style="color: #0000FF;">Series</span><span style="color: #008000;">[</span><span style="color: #FF0000;">0</span><span style="color: #008000;">]</span><span style="color: #008000;">.</span><span style="color: #0000FF;">YAxis</span> <span style="color: #008000;">=</span> chart<span style="color: #008000;">.</span><span style="color: #0000FF;">SecondaryYAxis</span><span style="color: #008000;">;</span>
<span style="color: #008000;">(</span><span style="color: #008000;">(</span>BindableDataSeries<span style="color: #008000;">)</span>chart<span style="color: #008000;">.</span><span style="color: #0000FF;">Series</span><span style="color: #008000;">[</span><span style="color: #FF0000;">0</span><span style="color: #008000;">]</span><span style="color: #008000;">.</span><span style="color: #0000FF;">DataSeries</span><span style="color: #008000;">)</span><span style="color: #008000;">.</span><span style="color: #0000FF;">ItemsSource</span> <span style="color: #008000;">=</span> groupedByHour<span style="color: #008000;">;</span></pre></td></tr></table></div><p>I used the <a href="http://www.visiblox.com/">free Visiblox chart</a> to display the tweet frequency. A <code>LineSeries</code> with a <code>BindableDataSeries</code> is used to render the results of the query above using databinding.</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;vis:LineSeries.DataSeries<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;vis:BindableDataSeries</span></span>
<span style="color: #009900;">         <span style="color: #000066;">XValueBinding</span>=<span style="color: #ff0000;">"{Binding Path=Hour}"</span></span>
<span style="color: #009900;">         <span style="color: #000066;">YValueBinding</span>=<span style="color: #ff0000;">"{Binding Path=Tweets}"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/vis:LineSeries.DataSeries<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>The Visiblox chart has a pluggable behaviour concept which allows you to add interactivity to the chart. The vertical line that indicates the current time uses this behaviour framework. When the user interacts with the chart via mouse movements, these interactions are directed to any active behaviours, which can then update their state, possibly interacting with the chart or its axes. For example, when the code which updates the date as the user drags the line is shown below:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">void</span> MouseLeftButtonDown<span style="color: #008000;">(</span>Point position<span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
  <span style="color: #0600FF; font-weight: bold;">base</span><span style="color: #008000;">.</span><span style="color: #0000FF;">MouseLeftButtonDown</span><span style="color: #008000;">(</span>position<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  _mouseDown <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">;</span>
<span style="color: #008000;">}</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">void</span> MouseLeftButtonUp<span style="color: #008000;">(</span>Point position<span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
  <span style="color: #0600FF; font-weight: bold;">base</span><span style="color: #008000;">.</span><span style="color: #0000FF;">MouseLeftButtonUp</span><span style="color: #008000;">(</span>position<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  _mouseDown <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">false</span><span style="color: #008000;">;</span>
<span style="color: #008000;">}</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">void</span> MouseMove<span style="color: #008000;">(</span>Point position<span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
  <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">(</span>_mouseDown<span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    CurrentDate <span style="color: #008000;">=</span> <span style="color: #008000;">(</span>DateTime<span style="color: #008000;">)</span>Chart<span style="color: #008000;">.</span><span style="color: #0000FF;">XAxis</span><span style="color: #008000;">.</span><span style="color: #0000FF;">GetRenderPositionAsDataValueWithZoom</span><span style="color: #008000;">(</span>position<span style="color: #008000;">.</span><span style="color: #0000FF;">X</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>For the sake of simplicity, the calendar and clock controls are implemented as UserControls, for example the calendar has the following markup:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid</span> <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">"LayoutRoot"</span> <span style="color: #000066;">Background</span>=<span style="color: #ff0000;">"Transparent"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Border</span> <span style="color: #000066;">CornerRadius</span>=<span style="color: #ff0000;">"8"</span></span>
<span style="color: #009900;">            <span style="color: #000066;">Background</span>=<span style="color: #ff0000;">"White"</span></span>
<span style="color: #009900;">            <span style="color: #000066;">Margin</span>=<span style="color: #ff0000;">"5"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Border.Effect<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;DropShadowEffect</span> <span style="color: #000066;">Color</span>=<span style="color: #ff0000;">"LightGray"</span></span>
<span style="color: #009900;">                        <span style="color: #000066;">Opacity</span>=<span style="color: #ff0000;">"0.8"</span></span>
<span style="color: #009900;">                        <span style="color: #000066;">ShadowDepth</span>=<span style="color: #ff0000;">"2"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Border.Effect<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid.RowDefinitions<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;RowDefinition</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"15"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;RowDefinition</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid.RowDefinitions<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Border</span> <span style="color: #000066;">CornerRadius</span>=<span style="color: #ff0000;">"8,8,0,0"</span></span>
<span style="color: #009900;">              <span style="color: #000066;">BorderThickness</span>=<span style="color: #ff0000;">"0"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Border.Background<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;LinearGradientBrush</span> <span style="color: #000066;">StartPoint</span>=<span style="color: #ff0000;">"0,0"</span></span>
<span style="color: #009900;">                                <span style="color: #000066;">EndPoint</span>=<span style="color: #ff0000;">"0,1"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;GradientStop</span> <span style="color: #000066;">Color</span>=<span style="color: #ff0000;">"White"</span> <span style="color: #000066;">Offset</span>=<span style="color: #ff0000;">"0"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;GradientStop</span> <span style="color: #000066;">Color</span>=<span style="color: #ff0000;">"Red"</span> <span style="color: #000066;">Offset</span>=<span style="color: #ff0000;">"0.9"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;GradientStop</span> <span style="color: #000066;">Color</span>=<span style="color: #ff0000;">"DarkRed"</span> <span style="color: #000066;">Offset</span>=<span style="color: #ff0000;">"1"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/LinearGradientBrush<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Border.Background<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Border<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBlock</span> <span style="color: #000066;">Text</span>=<span style="color: #ff0000;">"Friday"</span></span>
<span style="color: #009900;">                  <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">"DayOfWeek"</span></span>
<span style="color: #009900;">                  <span style="color: #000066;">FontWeight</span>=<span style="color: #ff0000;">"Bold"</span></span>
<span style="color: #009900;">                  <span style="color: #000066;">FontSize</span>=<span style="color: #ff0000;">"8"</span></span>
<span style="color: #009900;">                  <span style="color: #000066;">HorizontalAlignment</span>=<span style="color: #ff0000;">"Center"</span></span>
<span style="color: #009900;">                  <span style="color: #000066;">VerticalAlignment</span>=<span style="color: #ff0000;">"Center"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBlock</span> <span style="color: #000066;">Text</span>=<span style="color: #ff0000;">"28"</span></span>
<span style="color: #009900;">                  <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">"Day"</span></span>
<span style="color: #009900;">                  <span style="color: #000066;">Grid.Row</span>=<span style="color: #ff0000;">"1"</span></span>
<span style="color: #009900;">                  <span style="color: #000066;">FontWeight</span>=<span style="color: #ff0000;">"Bold"</span></span>
<span style="color: #009900;">                  <span style="color: #000066;">FontSize</span>=<span style="color: #ff0000;">"20"</span></span>
<span style="color: #009900;">                  <span style="color: #000066;">HorizontalAlignment</span>=<span style="color: #ff0000;">"Center"</span></span>
<span style="color: #009900;">                  <span style="color: #000066;">VerticalAlignment</span>=<span style="color: #ff0000;">"Center"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>    
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Border<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>And the following minimal code-behind:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">partial</span> <span style="color: #6666cc; font-weight: bold;">class</span> CalendarControl <span style="color: #008000;">:</span> UserControl
<span style="color: #008000;">{</span>
  <span style="color: #0600FF; font-weight: bold;">public</span> CalendarControl<span style="color: #008000;">(</span><span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    InitializeComponent<span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  <span style="color: #008000;">}</span>
&nbsp;
  <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">void</span> SetDate<span style="color: #008000;">(</span>DateTime date<span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    DayOfWeek<span style="color: #008000;">.</span><span style="color: #0000FF;">Text</span> <span style="color: #008000;">=</span> date<span style="color: #008000;">.</span><span style="color: #0000FF;">ToString</span><span style="color: #008000;">(</span><span style="color: #666666;">"ddd"</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
    Day<span style="color: #008000;">.</span><span style="color: #0000FF;">Text</span> <span style="color: #008000;">=</span> date<span style="color: #008000;">.</span><span style="color: #0000FF;">ToString</span><span style="color: #008000;">(</span><span style="color: #666666;">"dd"</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
  <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>The clock control is very similar, using a few concepts that I wrote abut in my <a href="{{ site.url }}/blog/colin/2010/08/developing-a-very-lookless-silverlight-radial-gauge-control/">gauge control blog post</a> a few weeks back. It is good to see that Silverlight allows quick and direct implementations of controls, you do not always have to use MVVM, lookless controls and dependency properties. If it is Christmas Eve, and you are itching to get home and grab a drink, anything goes <img src="http://www.scottlogic.co.uk/blog/colin/wp-includes/images/smilies/icon_wink.gif" alt=";-)" class="wp-smiley" /> </p><p>You can download the full sourcecode here: <a href="{{ site.url }}/blog/colin/wp-content/uploads/2010/12/UKSnowTheMovie.zip">UKSnowTheMovie.zip</a></p><p>Right … I’m off home.</p><p>Regards, Colin E.</p></div>