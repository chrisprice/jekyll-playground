---
author: Colin Eberhardt
tags: attached behaviour, attached view model, bullet graph
permalink: /blog/colin/2010/10/developing-a-lookless-silverlight-gauge-control-part-2/index.html
layout: colineberhardt-blog
---
<div class="entry"><div class="topsy_widget_data topsy_theme_light-green" style="float: right; margin-left: 0.75em; background: url(data:,%7B%20%22url%22%3A%20%22http%253A%252F%252Fwww.scottlogic.co.uk%252Fblog%252Fcolin%252F2010%252F10%252Fdeveloping-a-lookless-silverlight-gauge-control-part-2%252F%22%2C%20%22style%22%3A%20%22big%22%2C%20%22title%22%3A%20%22Developing%20a%20Lookless%20Silverlight%20Gauge%20Control%20%28part%202%29%20%23%22%20%7D);"></div><p><em>In a previous blog post I described the process of creating a lookless gauge control. I introduced the concept of an attached view model which separates view specific concepts from the control. In this post I demonstrate how this allows for great flexibility when re-templating the control.</em></p><p>In <a href="{{ site.url }}/blog/colin/2010/08/developing-a-very-lookless-silverlight-radial-gauge-control/">my previous post</a> I described the development of a radial gauge control where I removed any view-specific logic and properties from the control by introducing an attached view model into the control’s template. My reasons for doing this were to create a completely lookless control in the order that this would permit greater flexibility when re-templating or themeing. The control I created was a gauge control, which in my previous blog post I rendered as a radial gauge. The ‘radial concepts’ of angle, and other derived properties are contained within the attached view model, with the Gauge control itself only containing concepts that are common across all gauges (radial or otherwise). The control is shown below:</p><div style="text-align: center;"><object width="300" height="240" data="data:application/x-silverlight," type="application/x-silverlight-2"><param name="source" value="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2010/10/GaugeControlTwo.xap" /><a href="http://go.microsoft.com/fwlink/?LinkID=124807" style="text-decoration: none;"> <img src="http://go.microsoft.com/fwlink/?LinkId=108181" alt="Get Microsoft Silverlight" style="border-style: none;" /></a></object></div><p>In this post I will create two different templates for this control. The first is a small variation on the radial gauge which is rendered as a semi-circle. The second is very different, a bullet graph, where the gauge is rendered as a linear indicator. With each, an attached view model is introduced into the controls template in order to compute properties that aid in the rendering of the control.</p><p><img src="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2010/10/BulletAndSemiGauge.jpg" alt="" title="BulletAndSemiGauge" width="400" height="126" class="aligncenter size-full wp-image-869" /></p><h2>A Semi-circular Gauge</h2><p>The original attached view model I created was hard-coded to create a radial control where the needle has a sweep angle of 300 degrees. To support a semi-circular gauge we need to be able to configure this parameter. I achieved this by simply making SweepAngle a public property of the attached view model. This property is used wherever the view model needs to convert a gauge value to a radial location (i.e. when computing the tick mark rotation angles):</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> RadialGaugeControlViewModel <span style="color: #008000;">:</span> AttachedViewModelBase
<span style="color: #008000;">{</span>
  <span style="color: #0600FF; font-weight: bold;">public</span> RadialGaugeControlViewModel<span style="color: #008000;">(</span><span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    SweepAngle <span style="color: #008000;">=</span> <span style="color: #FF0000;">300</span><span style="color: #008000;">;</span>
  <span style="color: #008000;">}</span>
&nbsp;
  <span style="color: #008080; font-style: italic;">/// &lt;summary&gt;</span>
  <span style="color: #008080; font-style: italic;">/// Gets / sets the sweep angle of the radial gauge</span>
  <span style="color: #008080; font-style: italic;">/// &lt;/summary&gt;</span>
  <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">double</span> SweepAngle
  <span style="color: #008000;">{</span> <span style="color: #0600FF; font-weight: bold;">get</span><span style="color: #008000;">;</span> <span style="color: #0600FF; font-weight: bold;">set</span><span style="color: #008000;">;</span> <span style="color: #008000;">}</span>
&nbsp;
  <span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">double</span> ValueToAngle<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">double</span> <span style="color: #0600FF; font-weight: bold;">value</span><span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    <span style="color: #6666cc; font-weight: bold;">double</span> minAngle <span style="color: #008000;">=</span> <span style="color: #008000;">-</span>SweepAngle <span style="color: #008000;">/</span> <span style="color: #FF0000;">2</span><span style="color: #008000;">;</span>
    <span style="color: #6666cc; font-weight: bold;">double</span> maxAngle <span style="color: #008000;">=</span> SweepAngle <span style="color: #008000;">/</span> <span style="color: #FF0000;">2</span><span style="color: #008000;">;</span>
    <span style="color: #6666cc; font-weight: bold;">double</span> angularRange <span style="color: #008000;">=</span> maxAngle <span style="color: #008000;">-</span> minAngle<span style="color: #008000;">;</span>
&nbsp;
    <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #008000;">(</span><span style="color: #0600FF; font-weight: bold;">value</span> <span style="color: #008000;">-</span> Gauge<span style="color: #008000;">.</span><span style="color: #0000FF;">Minimum</span><span style="color: #008000;">)</span> <span style="color: #008000;">/</span> <span style="color: #008000;">(</span>Gauge<span style="color: #008000;">.</span><span style="color: #0000FF;">Maximum</span> <span style="color: #008000;">-</span> Gauge<span style="color: #008000;">.</span><span style="color: #0000FF;">Minimum</span><span style="color: #008000;">)</span> <span style="color: #008000;">*</span>
        angularRange <span style="color: #008000;">+</span> minAngle<span style="color: #008000;">;</span>
  <span style="color: #008000;">}</span>
&nbsp;
  <span style="color: #008000;">...</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>This allows it to be set in the control template of our re-templated gauge control where the view model is instantiated and attached:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Style</span> <span style="color: #000066;">TargetType</span>=<span style="color: #ff0000;">"local:GaugeControl"</span> <span style="color: #000066;">x:Key</span>=<span style="color: #ff0000;">"themedGauge"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Setter</span> <span style="color: #000066;">Property</span>=<span style="color: #ff0000;">"FontSize"</span> <span style="color: #000066;">Value</span>=<span style="color: #ff0000;">"8"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Setter</span> <span style="color: #000066;">Property</span>=<span style="color: #ff0000;">"Template"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Setter.Value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ControlTemplate</span> <span style="color: #000066;">TargetType</span>=<span style="color: #ff0000;">"local:GaugeControl"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid</span> <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">"LayoutRoot"</span> <span style="color: #000000; font-weight: bold;">&gt;</span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #808080; font-style: italic;">&lt;!-- attach the view model --&gt;</span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:RadialGaugeControlViewModel.Attach<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
              <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:RadialGaugeControlViewModel</span></span>
<span style="color: #009900;">                     <span style="color: #000066;">SweepAngle</span>=<span style="color: #ff0000;">"180"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:RadialGaugeControlViewModel.Attach<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
            <span style="color: #808080; font-style: italic;">&lt;!-- gauge template goes here! --&gt;</span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ControlTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Setter.Value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Setter<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Style<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>This means that the various properties of the attached view model that the view binds to in order to render the various control parts, such as the needle, are now computed with a 180 degree sweep.</p><p>For the semi-circular gauge, I used a similar technique to the original radial gauge for creating the required layout, where a grid with various rows / columns with star widths / heights create a proportional layout within which elements such as the needle are placed:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #808080; font-style: italic;">&lt;!-- attach the view model --&gt;</span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:RadialGaugeControlViewModel.Attach<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:RadialGaugeControlViewModel</span> <span style="color: #000066;">SweepAngle</span>=<span style="color: #ff0000;">"180"</span> <span style="color: #000066;">Clip</span>=<span style="color: #ff0000;">"false"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:RadialGaugeControlViewModel.Attach<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
<span style="color: #808080; font-style: italic;">&lt;!-- the gauge outline --&gt;</span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Path</span> <span style="color: #000066;">Stroke</span>=<span style="color: #ff0000;">"Black"</span> <span style="color: #000066;">StrokeThickness</span>=<span style="color: #ff0000;">"3"</span> <span style="color: #000066;">StrokeLineJoin</span>=<span style="color: #ff0000;">"Round"</span></span>
<span style="color: #009900;">      <span style="color: #000066;">Stretch</span>=<span style="color: #ff0000;">"Uniform"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Path.Data<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;PathGeometry<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;PathGeometry.Figures<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;PathFigure</span> <span style="color: #000066;">IsClosed</span>=<span style="color: #ff0000;">"True"</span> </span>
<span style="color: #009900;">                    <span style="color: #000066;">StartPoint</span>=<span style="color: #ff0000;">"0.5,0"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;PathFigure.Segments<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ArcSegment</span> <span style="color: #000066;">Size</span>=<span style="color: #ff0000;">"0.5,0.5"</span> <span style="color: #000066;">RotationAngle</span>=<span style="color: #ff0000;">"45"</span> <span style="color: #000066;">IsLargeArc</span>=<span style="color: #ff0000;">"False"</span></span>
<span style="color: #009900;">                      <span style="color: #000066;">SweepDirection</span>=<span style="color: #ff0000;">"Clockwise"</span></span>
<span style="color: #009900;">                      <span style="color: #000066;">Point</span>=<span style="color: #ff0000;">"1,0.5"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;LineSegment</span> <span style="color: #000066;">Point</span>=<span style="color: #ff0000;">"1,0.55"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;LineSegment</span> <span style="color: #000066;">Point</span>=<span style="color: #ff0000;">"0,0.55"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;LineSegment</span> <span style="color: #000066;">Point</span>=<span style="color: #ff0000;">"0,0.5"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ArcSegment</span> <span style="color: #000066;">Size</span>=<span style="color: #ff0000;">"0.5,0.5"</span> <span style="color: #000066;">RotationAngle</span>=<span style="color: #ff0000;">"45"</span> <span style="color: #000066;">IsLargeArc</span>=<span style="color: #ff0000;">"False"</span></span>
<span style="color: #009900;">                            <span style="color: #000066;">SweepDirection</span>=<span style="color: #ff0000;">"Clockwise"</span></span>
<span style="color: #009900;">                            <span style="color: #000066;">Point</span>=<span style="color: #ff0000;">"0.5,0"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/PathFigure.Segments<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/PathFigure</span> <span style="color: #000000; font-weight: bold;">&gt;</span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/PathGeometry.Figures<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/PathGeometry<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Path.Data<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Path<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid</span> <span style="color: #000066;">ShowGridLines</span>=<span style="color: #ff0000;">"true"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid.RowDefinitions<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;RowDefinition</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"3.5*"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;RowDefinition</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"4*"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;RowDefinition</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">".6*"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;RowDefinition</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">".6*"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;RowDefinition</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"*"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid.RowDefinitions<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid.ColumnDefinitions<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ColumnDefinition</span> <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">"8.0*"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ColumnDefinition</span> <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">".7*"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ColumnDefinition</span> <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">".7*"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ColumnDefinition</span> <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">"8.0*"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid.ColumnDefinitions<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
  <span style="color: #808080; font-style: italic;">&lt;!-- needle --&gt;</span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Path</span> <span style="color: #000066;">Stretch</span>=<span style="color: #ff0000;">"Uniform"</span></span>
<span style="color: #009900;">    <span style="color: #000066;">Grid.Row</span>=<span style="color: #ff0000;">"1"</span> <span style="color: #000066;">Grid.Column</span>=<span style="color: #ff0000;">"1"</span></span>
<span style="color: #009900;">    <span style="color: #000066;">Grid.ColumnSpan</span>=<span style="color: #ff0000;">"2"</span> <span style="color: #000066;">Grid.RowSpan</span>=<span style="color: #ff0000;">"2"</span></span>
<span style="color: #009900;">    <span style="color: #000066;">Fill</span>=<span style="color: #ff0000;">"Black"</span></span>
<span style="color: #009900;">    <span style="color: #000066;">HorizontalAlignment</span>=<span style="color: #ff0000;">"Center"</span></span>
<span style="color: #009900;">    <span style="color: #000066;">Stroke</span>=<span style="color: #ff0000;">"Black"</span> <span style="color: #000066;">StrokeThickness</span>=<span style="color: #ff0000;">"0.5"</span></span>
<span style="color: #009900;">    <span style="color: #000066;">Data</span>=<span style="color: #ff0000;">"M 0,0 l 5,60 l -10, 0"</span></span>
<span style="color: #009900;">    <span style="color: #000066;">RenderTransformOrigin</span>=<span style="color: #ff0000;">"0.5,1"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Path.RenderTransform<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;RotateTransform</span> <span style="color: #000066;">Angle</span>=<span style="color: #ff0000;">"{Binding Path=ValueAngle}"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Path.RenderTransform<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Path<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
  <span style="color: #808080; font-style: italic;">&lt;!-- needle cover --&gt;</span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Ellipse</span> <span style="color: #000066;">Fill</span>=<span style="color: #ff0000;">"White"</span></span>
<span style="color: #009900;">            <span style="color: #000066;">Stroke</span>=<span style="color: #ff0000;">"Black"</span> <span style="color: #000066;">StrokeThickness</span>=<span style="color: #ff0000;">"2"</span></span>
<span style="color: #009900;">            <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">"13"</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"13"</span></span>
<span style="color: #009900;">            <span style="color: #000066;">HorizontalAlignment</span>=<span style="color: #ff0000;">"Center"</span> <span style="color: #000066;">VerticalAlignment</span>=<span style="color: #ff0000;">"Bottom"</span></span>
<span style="color: #009900;">            <span style="color: #000066;">Grid.Row</span>=<span style="color: #ff0000;">"2"</span> <span style="color: #000066;">Grid.Column</span>=<span style="color: #ff0000;">"1"</span></span>
<span style="color: #009900;">            <span style="color: #000066;">Grid.RowSpan</span>=<span style="color: #ff0000;">"2"</span> <span style="color: #000066;">Grid.ColumnSpan</span>=<span style="color: #ff0000;">"2"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>You can see the various gridlines below:</p><p><img src="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2010/10/semicircle.jpg" alt="" title="semicircle" width="251" height="123" class="aligncenter size-full wp-image-870" /></p><p>The code for creating the major / minor ticks and qualitative ranges are much the same as before. However, for a bit of variation I did not want the labels on this gauge to be rotated. In order to achieve this I used the same technique as before where each label is initially constructed at the same location, then a translate / rotate transform is used to move it to the correct location on the dial. In this control, the text label is rotated a second time in the opposite direction in order to bring it back to its original orientation:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsControl.ItemTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;DataTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid</span> <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">"50"</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"20"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid.RenderTransform<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TransformGroup<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TranslateTransform</span> <span style="color: #000066;">X</span>=<span style="color: #ff0000;">"-25"</span> <span style="color: #000066;">Y</span>=<span style="color: #ff0000;">"-10"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TranslateTransform</span> <span style="color: #000066;">Y</span>=<span style="color: #ff0000;">"{Binding Path=Parent.GridHeight,</span>
<span style="color: #009900;">              Converter={StaticResource ScaleFactorConverter}, ConverterParameter=-0.69}"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;RotateTransform</span> <span style="color: #000066;">Angle</span>=<span style="color: #ff0000;">"{Binding Path=Angle}"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/TransformGroup<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid.RenderTransform<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBlock</span> <span style="color: #000066;">Text</span>=<span style="color: #ff0000;">"{Binding Path=Value}"</span> </span>
<span style="color: #009900;">            <span style="color: #000066;">VerticalAlignment</span>=<span style="color: #ff0000;">"Center"</span> <span style="color: #000066;">HorizontalAlignment</span>=<span style="color: #ff0000;">"Center"</span></span>
<span style="color: #009900;">            <span style="color: #000066;">RenderTransformOrigin</span>=<span style="color: #ff0000;">"0.5, 0.5"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
        <span style="color: #808080; font-style: italic;">&lt;!-- rotate the labels by '-Angle' to return to their original orientation --&gt;</span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBlock.RenderTransform<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;RotateTransform</span> <span style="color: #000066;">Angle</span>=<span style="color: #ff0000;">"{Binding Path=Angle,</span>
<span style="color: #009900;">                Converter={StaticResource ScaleFactorConverter}, ConverterParameter=-1}"</span> <span style="color: #000000; font-weight: bold;">/&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/TextBlock.RenderTransform<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/TextBlock<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/DataTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsControl.ItemTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>The finished semi-circular gauge can be seen here next to my original radial gauge control:</p><div style="text-align: center;"><object width="400" height="240" data="data:application/x-silverlight," type="application/x-silverlight-2"><param name="source" value="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2010/10/GaugeAndSemiGauge.xap" /><a href="http://go.microsoft.com/fwlink/?LinkID=124807" style="text-decoration: none;"> <img src="http://go.microsoft.com/fwlink/?LinkId=108181" alt="Get Microsoft Silverlight" style="border-style: none;" /></a></object></div><p>So, the original control has proven to be pretty versatile in that it can be re-templated to look quite different. To allow this, the attached view model was modified to expose a few view-centric properties that could be set when it is created and attached within the template.</p><p>However, the example above is still a radial gauge. A much bigger challenge would be to re-template the control to look completely different. That was my next challenge!</p><h2>A Bullet Graph Template</h2><p>Radial gauge controls look very pretty; however they eat up a lot of screen real-estate, and are not the best way of visualising a one-dimensional metric. A much clearer visualisation can be achieved by using a linear gauge, a <a href="http://en.wikipedia.org/wiki/Bullet_graph">bullet-graph</a> for example. This section describes how a new attached view model can be applied to the gauge control, to support a template which produces a bullet graph.</p><p>Using the same process as in the above example, the basic structure of the control is defined using a Grid:</p><p><img src="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2010/10/bulletLayout.png" alt="" title="bulletLayout" width="235" height="99" class="aligncenter size-full wp-image-872" /></p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Style</span> <span style="color: #000066;">TargetType</span>=<span style="color: #ff0000;">"local:GaugeControl"</span> <span style="color: #000066;">x:Key</span>=<span style="color: #ff0000;">"bulletGraphGauge"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Setter</span> <span style="color: #000066;">Property</span>=<span style="color: #ff0000;">"FontSize"</span> <span style="color: #000066;">Value</span>=<span style="color: #ff0000;">"8"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Setter</span> <span style="color: #000066;">Property</span>=<span style="color: #ff0000;">"Template"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Setter.Value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ControlTemplate</span> <span style="color: #000066;">TargetType</span>=<span style="color: #ff0000;">"local:GaugeControl"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid</span> <span style="color: #000066;">x:Name</span>=<span style="color: #ff0000;">"LayoutRoot"</span> <span style="color: #000066;">Background</span>=<span style="color: #ff0000;">"LightBlue"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid</span> <span style="color: #000066;">ShowGridLines</span>=<span style="color: #ff0000;">"True"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
            <span style="color: #808080; font-style: italic;">&lt;!-- attach the view model --&gt;</span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:RadialGaugeControlViewModel.Attach<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
              <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;local:BulletGraphGaugeViewModel</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/local:RadialGaugeControlViewModel.Attach<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
            <span style="color: #808080; font-style: italic;">&lt;!--the grid layout --&gt;</span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid.RowDefinitions<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
              <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;RowDefinition</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"3*"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
              <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;RowDefinition</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"*"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
              <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;RowDefinition</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"2*"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
              <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;RowDefinition</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"*"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
              <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;RowDefinition</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"3*"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid.RowDefinitions<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>                
&nbsp;
            <span style="color: #808080; font-style: italic;">&lt;!-- featured measure indicator --&gt;</span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Rectangle</span> <span style="color: #000066;">Fill</span>=<span style="color: #ff0000;">"Black"</span></span>
<span style="color: #009900;">                        <span style="color: #000066;">Grid.Row</span>=<span style="color: #ff0000;">"2"</span></span>
<span style="color: #009900;">                        <span style="color: #000066;">HorizontalAlignment</span>=<span style="color: #ff0000;">"Left"</span></span>
<span style="color: #009900;">                        <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">"{Binding Path=FeaturedMeasureLength}"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ControlTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Setter.Value<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Setter<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Style<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>The ‘featured measure’, which is a thermometer-like bar which indicates the current value of the gauge has its Width property bound to the view model which is attached at the top of the template. To simplify the code, I refactored the attached view model concept to extract a base class which is shared by both the radial and bullet-graph subclasses. This base class takes care of attaching to its parents DataContext, adapting the control’s properties, exposing the actual width / height of the control and the other bits and pieces I described in my previous blog post. The bullet graph view model is then much simpler as a result. In the code below you can see how the FeaturedMeasureLength is computed in the view model:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> BulletGraphGaugeViewModel <span style="color: #008000;">:</span> AttachedViewModelBase
<span style="color: #008000;">{</span>
  <span style="color: #0600FF; font-weight: bold;">public</span> BulletGraphGaugeViewModel<span style="color: #008000;">(</span><span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
  <span style="color: #008000;">}</span>
&nbsp;
  <span style="color: #0600FF; font-weight: bold;">private</span> GaugeControl Gauge
  <span style="color: #008000;">{</span>
    <span style="color: #008080; font-style: italic;">// the view model’s DataContext is bound to the Gauge</span>
    <span style="color: #0600FF; font-weight: bold;">get</span> <span style="color: #008000;">{</span> <span style="color: #0600FF; font-weight: bold;">return</span> DataContext <span style="color: #008000;">!=</span> <span style="color: #0600FF; font-weight: bold;">null</span> <span style="color: #008000;">?</span> <span style="color: #008000;">(</span>GaugeControl<span style="color: #008000;">)</span>DataContext <span style="color: #008000;">:</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">;</span> <span style="color: #008000;">}</span>
  <span style="color: #008000;">}</span>
&nbsp;
  <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">double</span> FeaturedMeasureLength
  <span style="color: #008000;">{</span>
    <span style="color: #0600FF; font-weight: bold;">get</span>
    <span style="color: #008000;">{</span>
      <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">(</span>Gauge <span style="color: #008000;">==</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">)</span>
        <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #FF0000;">0</span><span style="color: #008000;">;</span>
&nbsp;
      <span style="color: #0600FF; font-weight: bold;">return</span> ValueToWidth<span style="color: #008000;">(</span>Gauge<span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Value</span> <span style="color: #008000;">-</span> Gauge<span style="color: #008000;">.</span><span style="color: #0000FF;">Minimum</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">}</span>
  <span style="color: #008000;">}</span>
&nbsp;
  <span style="color: #008080; font-style: italic;">/// &lt;summary&gt;</span>
  <span style="color: #008080; font-style: italic;">/// Converts the given value (which should be between Gauge.Maximum / Gauge.Minimum)</span>
  <span style="color: #008080; font-style: italic;">/// into suitable width for rendering within the view.</span>
  <span style="color: #008080; font-style: italic;">/// &lt;/summary&gt;</span>
  <span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">double</span> ValueToWidth<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">double</span> <span style="color: #0600FF; font-weight: bold;">value</span><span style="color: #008000;">)</span>
  <span style="color: #008000;">{</span>
    <span style="color: #6666cc; font-weight: bold;">double</span> range <span style="color: #008000;">=</span> Gauge<span style="color: #008000;">.</span><span style="color: #0000FF;">Maximum</span> <span style="color: #008000;">-</span> Gauge<span style="color: #008000;">.</span><span style="color: #0000FF;">Minimum</span><span style="color: #008000;">;</span>
    <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #008000;">(</span><span style="color: #0600FF; font-weight: bold;">value</span><span style="color: #008000;">)</span> <span style="color: #008000;">/</span> range <span style="color: #008000;">*</span> ElementWidth<span style="color: #008000;">;</span>
  <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>Next we’ll add the ‘qualitative range’ scale:</p><p><img src="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2010/10/bulletRanges.png" alt="" title="bulletRanges" width="229" height="98" class="aligncenter size-full wp-image-874" /></p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #808080; font-style: italic;">&lt;!-- Qualitative ranges --&gt;</span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsControl</span> <span style="color: #000066;">ItemsSource</span>=<span style="color: #ff0000;">"{Binding Path=Ranges}"</span></span>
<span style="color: #009900;">              <span style="color: #000066;">Grid.Row</span>=<span style="color: #ff0000;">"1"</span> <span style="color: #000066;">Grid.RowSpan</span>=<span style="color: #ff0000;">"3"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsControl.ItemsPanel<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsPanelTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;StackPanel</span> <span style="color: #000066;">Orientation</span>=<span style="color: #ff0000;">"Horizontal"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsPanelTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsControl.ItemsPanel<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsControl.ItemTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;DataTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Rectangle</span> <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">"{Binding Path=Width}"</span></span>
<span style="color: #009900;">                  <span style="color: #000066;">Stroke</span>=<span style="color: #ff0000;">"Black"</span> <span style="color: #000066;">StrokeThickness</span>=<span style="color: #ff0000;">"0.2"</span></span>
<span style="color: #009900;">                  <span style="color: #000066;">Fill</span>=<span style="color: #ff0000;">"{Binding Path=Color, Converter={StaticResource ColorToBrushConverter}}"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/DataTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsControl.ItemTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsControl<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Border</span> <span style="color: #000066;">BorderBrush</span>=<span style="color: #ff0000;">"Black"</span> <span style="color: #000066;">BorderThickness</span>=<span style="color: #ff0000;">"1.0"</span></span>
<span style="color: #009900;">        <span style="color: #000066;">Grid.Row</span>=<span style="color: #ff0000;">"1"</span> <span style="color: #000066;">Grid.RowSpan</span>=<span style="color: #ff0000;">"3"</span> <span style="color: #000066;">Margin</span>=<span style="color: #ff0000;">"-1"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span></pre></td></tr></table></div><p>Once again, the attached view model is used to adapt the properties exposed by the control in order to provide properties which are easier to bind to in order to create the required UI. Here the Gauge controls QualitativeRange is adapted to expose a Range property, which the ItemsControl in the XAML above binds to, this property is an enumeration of RangeItems which each have the correct width and colour for our UI:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> IEnumerable<span style="color: #008000;">&lt;</span>RangeItem<span style="color: #008000;">&gt;</span> Ranges
<span style="color: #008000;">{</span>
  <span style="color: #0600FF; font-weight: bold;">get</span>
  <span style="color: #008000;">{</span>
    <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">(</span>Gauge <span style="color: #008000;">==</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">)</span>
      <span style="color: #0600FF; font-weight: bold;">yield</span> <span style="color: #0600FF; font-weight: bold;">break</span><span style="color: #008000;">;</span>
&nbsp;
    <span style="color: #0600FF; font-weight: bold;">for</span> <span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">int</span> i <span style="color: #008000;">=</span> <span style="color: #FF0000;">0</span><span style="color: #008000;">;</span> i <span style="color: #008000;">&lt;</span> Gauge<span style="color: #008000;">.</span><span style="color: #0000FF;">QualitativeRange</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Count</span><span style="color: #008000;">;</span> i<span style="color: #008000;">++</span><span style="color: #008000;">)</span>
    <span style="color: #008000;">{</span>
      <span style="color: #0600FF; font-weight: bold;">var</span> range <span style="color: #008000;">=</span> Gauge<span style="color: #008000;">.</span><span style="color: #0000FF;">QualitativeRange</span><span style="color: #008000;">[</span>i<span style="color: #008000;">]</span><span style="color: #008000;">;</span>
      <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">(</span>i <span style="color: #008000;">==</span> <span style="color: #FF0000;">0</span><span style="color: #008000;">)</span>
      <span style="color: #008000;">{</span>
        <span style="color: #008080; font-style: italic;">// first RangeItem, width is determined from the first range value</span>
        <span style="color: #0600FF; font-weight: bold;">yield</span> <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #008000;">new</span> RangeItem<span style="color: #008000;">(</span><span style="color: #008000;">)</span>
        <span style="color: #008000;">{</span>
          Color <span style="color: #008000;">=</span> range<span style="color: #008000;">.</span><span style="color: #0000FF;">Color</span>,
          Width <span style="color: #008000;">=</span> ValueToWidth<span style="color: #008000;">(</span>range<span style="color: #008000;">.</span><span style="color: #0000FF;">Maximum</span> <span style="color: #008000;">-</span> Gauge<span style="color: #008000;">.</span><span style="color: #0000FF;">Minimum</span><span style="color: #008000;">)</span>
        <span style="color: #008000;">}</span><span style="color: #008000;">;</span>
      <span style="color: #008000;">}</span>
      <span style="color: #0600FF; font-weight: bold;">else</span>
      <span style="color: #008000;">{</span>
        <span style="color: #008080; font-style: italic;">// subsequent items, width computed as the difference between the</span>
        <span style="color: #008080; font-style: italic;">// current value and its predecessor</span>
        <span style="color: #0600FF; font-weight: bold;">var</span> previousRange <span style="color: #008000;">=</span> Gauge<span style="color: #008000;">.</span><span style="color: #0000FF;">QualitativeRange</span><span style="color: #008000;">[</span>i <span style="color: #008000;">-</span> <span style="color: #FF0000;">1</span><span style="color: #008000;">]</span><span style="color: #008000;">;</span>
        <span style="color: #0600FF; font-weight: bold;">yield</span> <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #008000;">new</span> RangeItem<span style="color: #008000;">(</span><span style="color: #008000;">)</span>
        <span style="color: #008000;">{</span>
          Color <span style="color: #008000;">=</span> range<span style="color: #008000;">.</span><span style="color: #0000FF;">Color</span>,
          Width <span style="color: #008000;">=</span> ValueToWidth<span style="color: #008000;">(</span>range<span style="color: #008000;">.</span><span style="color: #0000FF;">Maximum</span> <span style="color: #008000;">-</span> previousRange<span style="color: #008000;">.</span><span style="color: #0000FF;">Maximum</span><span style="color: #008000;">)</span>
        <span style="color: #008000;">}</span><span style="color: #008000;">;</span>
      <span style="color: #008000;">}</span>
    <span style="color: #008000;">}</span>
  <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span>
&nbsp;
<span style="color: #008000;">...</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> RangeItem
<span style="color: #008000;">{</span>
  <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">double</span> Width <span style="color: #008000;">{</span> <span style="color: #0600FF; font-weight: bold;">get</span><span style="color: #008000;">;</span> <span style="color: #0600FF; font-weight: bold;">set</span><span style="color: #008000;">;</span> <span style="color: #008000;">}</span>
  <span style="color: #0600FF; font-weight: bold;">public</span> Color Color <span style="color: #008000;">{</span> <span style="color: #0600FF; font-weight: bold;">get</span><span style="color: #008000;">;</span> <span style="color: #0600FF; font-weight: bold;">set</span><span style="color: #008000;">;</span> <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span></pre></td></tr></table></div><p>Finally, the scales are added:</p><p><img src="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2010/10/bulletscale.png" alt="" title="bulletscale" width="237" height="99" class="aligncenter size-full wp-image-875" /></p><div class="wp_syntax"><table><tr><td class="code"><pre class="xml" style="font-family: monospace;"><span style="color: #808080; font-style: italic;">&lt;!-- upper scale --&gt;</span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsControl</span> <span style="color: #000066;">ItemsSource</span>=<span style="color: #ff0000;">"{Binding Path=MajorTicks}"</span></span>
<span style="color: #009900;">              <span style="color: #000066;">VerticalAlignment</span>=<span style="color: #ff0000;">"Center"</span></span>
<span style="color: #009900;">              <span style="color: #000066;">Grid.Row</span>=<span style="color: #ff0000;">"0"</span></span>
<span style="color: #009900;">              <span style="color: #000066;">ItemsPanel</span>=<span style="color: #ff0000;">"{StaticResource CanvasTemplate}"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsControl.ItemTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;DataTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid</span> <span style="color: #000066;">Width</span>=<span style="color: #ff0000;">"50"</span> <span style="color: #000066;">Height</span>=<span style="color: #ff0000;">"20"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Grid.RenderTransform<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TransformGroup<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
            <span style="color: #808080; font-style: italic;">&lt;!-- centre the labels --&gt;</span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TranslateTransform</span> <span style="color: #000066;">X</span>=<span style="color: #ff0000;">"-25"</span> <span style="color: #000066;">Y</span>=<span style="color: #ff0000;">"-10"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
            <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TranslateTransform</span> <span style="color: #000066;">X</span>=<span style="color: #ff0000;">"{Binding Path=Position}"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
          <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/TransformGroup<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid.RenderTransform<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
        <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;TextBlock</span> <span style="color: #000066;">Text</span>=<span style="color: #ff0000;">"{Binding Path=Label}"</span></span>
<span style="color: #009900;">                    <span style="color: #000066;">VerticalAlignment</span>=<span style="color: #ff0000;">"Center"</span></span>
<span style="color: #009900;">                    <span style="color: #000066;">HorizontalAlignment</span>=<span style="color: #ff0000;">"Center"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Grid<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/DataTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsControl.ItemTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsControl<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
<span style="color: #808080; font-style: italic;">&lt;!-- major ticks --&gt;</span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsControl</span> <span style="color: #000066;">ItemsSource</span>=<span style="color: #ff0000;">"{Binding Path=MajorTicks}"</span></span>
<span style="color: #009900;">              <span style="color: #000066;">VerticalAlignment</span>=<span style="color: #ff0000;">"Bottom"</span></span>
<span style="color: #009900;">              <span style="color: #000066;">Grid.Row</span>=<span style="color: #ff0000;">"0"</span></span>
<span style="color: #009900;">              <span style="color: #000066;">ItemsPanel</span>=<span style="color: #ff0000;">"{StaticResource CanvasTemplate}"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsControl.ItemTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;DataTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Line</span> <span style="color: #000066;">X1</span>=<span style="color: #ff0000;">"{Binding Path=Position}"</span> <span style="color: #000066;">Y1</span>=<span style="color: #ff0000;">"0"</span> <span style="color: #000066;">X2</span>=<span style="color: #ff0000;">"{Binding Path=Position}"</span> <span style="color: #000066;">Y2</span>=<span style="color: #ff0000;">"-5"</span></span>
<span style="color: #009900;">            <span style="color: #000066;">Stroke</span>=<span style="color: #ff0000;">"Black"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/DataTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsControl.ItemTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsControl<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
&nbsp;
<span style="color: #808080; font-style: italic;">&lt;!-- minor ticks --&gt;</span>          
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsControl</span> <span style="color: #000066;">ItemsSource</span>=<span style="color: #ff0000;">"{Binding Path=MinorTicks}"</span></span>
<span style="color: #009900;">              <span style="color: #000066;">VerticalAlignment</span>=<span style="color: #ff0000;">"Bottom"</span></span>
<span style="color: #009900;">              <span style="color: #000066;">Grid.Row</span>=<span style="color: #ff0000;">"0"</span></span>
<span style="color: #009900;">              <span style="color: #000066;">ItemsPanel</span>=<span style="color: #ff0000;">"{StaticResource CanvasTemplate}"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;ItemsControl.ItemTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;DataTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Line</span> <span style="color: #000066;">X1</span>=<span style="color: #ff0000;">"{Binding}"</span> <span style="color: #000066;">Y1</span>=<span style="color: #ff0000;">"0"</span> <span style="color: #000066;">X2</span>=<span style="color: #ff0000;">"{Binding}"</span> <span style="color: #000066;">Y2</span>=<span style="color: #ff0000;">"-3"</span></span>
<span style="color: #009900;">            <span style="color: #000066;">Stroke</span>=<span style="color: #ff0000;">"Black"</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/DataTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsControl.ItemTemplate<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/ItemsControl<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div><p>Again, exactly the same pattern is employed, with the MajorTicks and MinorTicks properties exposed by the attached view model, each providing an enumeration of simple value objects with a Position and Label properties, which are bound to the three ItemsControls above to create the required UI.</p><p>The complete bullet graph template is shown below next to the original radial gauge:</p><div style="text-align: center;"><object width="400" height="240" data="data:application/x-silverlight," type="application/x-silverlight-2"><param name="source" value="http://www.scottlogic.co.uk/blog/colin/wp-content/uploads/2010/10/GaugeAndBullet.xap" /><a href="http://go.microsoft.com/fwlink/?LinkID=124807" style="text-decoration: none;"> <img src="http://go.microsoft.com/fwlink/?LinkId=108181" alt="Get Microsoft Silverlight" style="border-style: none;" /></a></object></div><p>In conclusion, the use of an attached view model provides a mechanism for exposing view-specific properties to the view logic within the XAML template. This enables the construction of a control which really is entirely lookless.</p><p>You can download the sourcecode for this project:  <a href="{{ site.url }}/blog/colin/wp-content/uploads/2010/10/GaugeControl.zip">GaugeControl.zip</a></p><p>Regards, Colin E.</p></div>