---
author: Rolf Baxter
tags: 
permalink: /2012/10/pdf-generation-and-printing-in-net-2/index.html
layout: blog
---
<div class="entry"><p style="text-align: justify;"><em>In this post I’m going to talk about creating PDF documents in C#. I will primarily focus on the PdfSharp and MigraDoc libraries, which are free C# libraries available from <a href="http://www.pdfsharp.net/">http://www.pdfsharp.net/</a>. I recently became acquainted with them while investigating .NET exporting functionality and wanted to blog about my experience and add some praise for these excellent libraries.</em></p><h3>Choice of Library</h3><p style="text-align: justify;">To provide a little context – my interest in these libraries stemmed from a desire to export a .NET DataGridView component. Unlike DataTables, which are purely data containers (and often used as an underlying data source), DataGridViews are visual components that allow display formatting attributes to be applied (e.g. font type, size, style, etc.). However, rather than rendering a DataGridView to the screen, my goal was to be able to render the component to both a printer and PDF document.</p><p style="text-align: justify;">My initial research into this subject identified the excellent <a href="http://www.codeproject.com/Articles/18042/Another-DataGridView-Printer">DGVPrinter</a> library, which renders DataGridViews to a printer by drawing on a Graphics context provided by the .NET Framework’s System.Drawing.Printing.PrintDocument class. The library provides an extensive set of formatting options to allow the developer to tune the printing operation. However, the library does not contain any inherent ability to export to PDF.</p><p style="text-align: justify;">Further research identified a number of .NET libraries focused on PDF document generation. Three libraries in particular (iTextSharp, PdfSharp and MigraDoc) stood out from this group as being the most complete, feature-rich and well documented options.</p><p style="text-align: justify;">The <a href="http://www.itextpdf.com">iTextSharp</a> library is a C# port of iText;&nbsp; a well known and long established Java library for PDF creation. iTextSharp is free for non-commercial use but requires a license for commercial development. Although my research probably wouldn’t have counted as commercial development, I was sufficiently motivated to experiment with PdfSharp and Migradoc first, which are released under the MIT license (free for any use). In doing so I established that these two libraries were very well written, easy to use and very well documented. The objective of this post is thus to publicise my experience with these libraries and to encourage their use by other developers requiring PDF export functionality.</p><h3>An API to suit the developer</h3><p style="text-align: justify;">The key difference between PdfSharp and Migradoc is the level of control available to the developer. In PdfSharp you are responsible for controlling every aspect of the rendering process which is done by drawing lines, strings and shapes at specified coordinates on a PDF graphics context. The library authors have mimicked the Microsoft GDI+ interface (see <a href="http://msdn.microsoft.com/en-us/library/d420az6e(v=vs.110).aspx">here</a> for further details) and thus many of the method names and objects will be familiar to developers with GDI+ experience.</p><p style="text-align: justify;">The only drawback with PdfSharp is that it requires the developer to do a lot of work. For some applications the level of control required by the developer will necessitate the use of this library, but for other occasions, the MigraDoc library is here to help. Migradoc provides a domain model for document generation and allows you to construct a document using sections, paragraphs and tables, etc. This library vastly simplifies document generation by automating many of the rendering tasks, with the obvious limitation of reduced rendering control. For simple documents this may not be a problem, but can be an issue if more complex output is required. For example, my experimentation with Migradoc found that the edges of a wide table were truncated if the columns did not fit onto a single page. I thus implemented a more sophisticated rendering mechanism loosely based on the algorithms found in <a href="http://www.codeproject.com/Articles/18042/Another-DataGridView- Printer">DGVPrinter</a>, which separates a table’s columns onto multiple pages.</p><p style="text-align: justify;">The most appropriate library to use is thus very much dependent on the task at hand. If you are performing simple PDF rendering Migradoc may well suit your needs. However, for those more complex situations the lower-level PdfSharp library is always available. Because the two libraries are so closely related you can also render a single document by using a combination of both libraries, although I did encounter some limitations with this (to be discussed later).</p><h3>Excellent Documentation</h3><p style="text-align: justify;">The availability of documentation was a considerable factor in deciding to experiment with PdfSharp and Migradoc. The numerous examples available on the support <a href="http://www.pdfsharp.net/Support.ashx">website</a> provide an excellent developer resource when combined with the extensive sample applications bundled with the libraries. In my opinion the same cannot be said of iTextSharp, which largely relies on the Java-based iText documentation and a commercially published book. Furthermore, because Migradoc is built upon PdfSharp this is another excellent source for examples.</p><h3>Document Generation</h3><p>In this section I will briefly illustrate how a PDF document is generated using PdfSharp and Migradoc, highlighting both the overall simplicity and some of the differences between the two approaches.</p><h4><em>PdfSharp</em></h4><p style="text-align: justify;">PdfSharp utilises a PdfDocument object, to which we add and render individual pages. In the example below I create a new document and set some of the available document information properties before adding a single A4 page. I then proceed by obtaining an XGraphics object and render to it using low-level methods. In the example I draw two strings of text in roughly the centre of the page using a specified font. I then draw two horizontal lines above and below the text, save the document and display it to the user.</p><div class="wp_syntax"><div class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #008080; font-style: italic;">// Create a new document and add a page</span>
&nbsp;
PdfDocument document <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> PdfDocument<span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
document<span style="color: #008000;">.</span><span style="color: #0000FF;">Info</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Author</span> <span style="color: #008000;">=</span> <span style="color: #666666;">"Rolf Baxter"</span><span style="color: #008000;">;</span>
document<span style="color: #008000;">.</span><span style="color: #0000FF;">Info</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Keywords</span> <span style="color: #008000;">=</span> <span style="color: #666666;">"PdfSharp, Examples, C#"</span><span style="color: #008000;">;</span>
&nbsp;
PdfPage page <span style="color: #008000;">=</span> document<span style="color: #008000;">.</span><span style="color: #0000FF;">AddPage</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
page<span style="color: #008000;">.</span><span style="color: #0000FF;">Size</span> <span style="color: #008000;">=</span> PageSize<span style="color: #008000;">.</span><span style="color: #0000FF;">A4</span><span style="color: #008000;">;</span>
&nbsp;
<span style="color: #008080; font-style: italic;">// Obtain an XGraphics object to render to</span>
XGraphics gfx <span style="color: #008000;">=</span> XGraphics<span style="color: #008000;">.</span><span style="color: #0000FF;">FromPdfPage</span><span style="color: #008000;">(</span>page<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
<span style="color: #008080; font-style: italic;">// Create a font</span>
<span style="color: #6666cc; font-weight: bold;">double</span> fontHeight <span style="color: #008000;">=</span> <span style="color: #FF0000;">36</span><span style="color: #008000;">;</span>
XFont font <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> XFont<span style="color: #008000;">(</span><span style="color: #666666;">"Times New Roman"</span>, fontHeight, XFontStyle<span style="color: #008000;">.</span><span style="color: #0000FF;">BoldItalic</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
<span style="color: #008080; font-style: italic;">// Get the centre of the page</span>
<span style="color: #6666cc; font-weight: bold;">double</span> y <span style="color: #008000;">=</span> page<span style="color: #008000;">.</span><span style="color: #0000FF;">Height</span><span style="color: #008000;">/</span><span style="color: #FF0000;">2</span><span style="color: #008000;">;</span>
<span style="color: #6666cc; font-weight: bold;">int</span> lineCount <span style="color: #008000;">=</span> <span style="color: #FF0000;">0</span><span style="color: #008000;">;</span>
<span style="color: #6666cc; font-weight: bold;">double</span> linePadding <span style="color: #008000;">=</span> <span style="color: #FF0000;">10</span><span style="color: #008000;">;</span>
&nbsp;
<span style="color: #008080; font-style: italic;">// Create a rectangle to draw the text in and draw in it</span>
XRect rect <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> XRect<span style="color: #008000;">(</span><span style="color: #FF0000;">0</span>, y, page<span style="color: #008000;">.</span><span style="color: #0000FF;">Width</span>, fontHeight<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
gfx<span style="color: #008000;">.</span><span style="color: #0000FF;">DrawString</span><span style="color: #008000;">(</span><span style="color: #666666;">"Hello, World! "</span>, font,
               XBrushes<span style="color: #008000;">.</span><span style="color: #0000FF;">Black</span>, rect, XStringFormats<span style="color: #008000;">.</span><span style="color: #0000FF;">Center</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
lineCount<span style="color: #008000;">++;</span>
y <span style="color: #008000;">+=</span> fontHeight<span style="color: #008000;">;</span>
&nbsp;
rect <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> XRect<span style="color: #008000;">(</span><span style="color: #FF0000;">0</span>, y, page<span style="color: #008000;">.</span><span style="color: #0000FF;">Width</span>, fontHeight<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
gfx<span style="color: #008000;">.</span><span style="color: #0000FF;">DrawString</span><span style="color: #008000;">(</span><span style="color: #666666;">"This is some long text that will not auto-wrap when the
               edge of the page is reached"</span>,
               font, XBrushes<span style="color: #008000;">.</span><span style="color: #0000FF;">Black</span>,
               rect, XStringFormats<span style="color: #008000;">.</span><span style="color: #0000FF;">TopLeft</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
lineCount<span style="color: #008000;">++;</span>
y <span style="color: #008000;">+=</span> fontHeight<span style="color: #008000;">;</span>
&nbsp;
<span style="color: #6666cc; font-weight: bold;">double</span> topY <span style="color: #008000;">=</span> y <span style="color: #008000;">-</span> <span style="color: #008000;">(</span>lineCount <span style="color: #008000;">*</span> fontHeight<span style="color: #008000;">)</span> <span style="color: #008000;">-</span> linePadding<span style="color: #008000;">;</span>
&nbsp;
<span style="color: #008080; font-style: italic;">// Draw a line below the text</span>
gfx<span style="color: #008000;">.</span><span style="color: #0000FF;">DrawLine</span><span style="color: #008000;">(</span>XPens<span style="color: #008000;">.</span><span style="color: #0000FF;">Black</span>, <span style="color: #FF0000;">0</span>, y, page<span style="color: #008000;">.</span><span style="color: #0000FF;">Width</span>, y <span style="color: #008000;">+</span> linePadding<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
<span style="color: #008080; font-style: italic;">// Draw a line above the text</span>
gfx<span style="color: #008000;">.</span><span style="color: #0000FF;">DrawLine</span><span style="color: #008000;">(</span>XPens<span style="color: #008000;">.</span><span style="color: #0000FF;">Black</span>, <span style="color: #FF0000;">0</span>, topY, page<span style="color: #008000;">.</span><span style="color: #0000FF;">Width</span>, topY<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
<span style="color: #008080; font-style: italic;">// Save and show the document</span>
document<span style="color: #008000;">.</span><span style="color: #0000FF;">Save</span><span style="color: #008000;">(</span><span style="color: #666666;">"TestDocument.pdf"</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
Process<span style="color: #008000;">.</span><span style="color: #0000FF;">Start</span><span style="color: #008000;">(</span><span style="color: #666666;">"TestDocument.pdf"</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span></pre></div></div><p>&nbsp;</p><p>&nbsp;</p><p>The output of this document looks as follows:</p><p><a href="{{ site.url }}/wp-content/uploads/2012/10/PdfSharpCapture2.png"><img class="size-full wp-image-160303 aligncenter" title="Pdf Sharp Sample Document" src="http://www.scottlogic.co.uk/wp-content/uploads/2012/10/PdfSharpCapture2.png" alt="Pdf Sharp Sample Document" width="239" height="334" /></a></p><p style="text-align: justify;">As can be seen, one of the drawbacks of PdfSharp is that features such as text-wrapping are not implemented.&nbsp; To achieve text wrapping one must manually measure the lengths of strings and wrap the text accordingly.&nbsp; Furthermore, the current document y position must also be tracked as rendering is performed.&nbsp; In this simple example tracking the y position is trivial, although rendering does become slightly more challenging when more complex rendering is performed (e.g. drawing a custom table of data).</p><h4><em>Migradoc</em></h4><p style="text-align: justify;">Re-generating the above document in Migradoc is useful for demonstrating both the pros and cons of each library.&nbsp; Unlike PdfSharp, Migradoc uses a Document object to which document elements (e.g. paragraphs) are added. The document is rendered using a PdfDocumentRenderer.&nbsp; However, complications arise when one tries to do anything out of the ordinary.&nbsp; For example, individual lines cannot be drawn in MigraDoc so the only way to re-produce the example above is to use a table containing a single column and enabling/disabling different cell borders.&nbsp; Similarly, there is no way to position the table in a specific location (i.e. half way down the page), and thus one can only achieve this by applying a large ‘top’ margin to the section. However, Migradoc does perform text-wrapping for us, which is clearly beneficial when rendering large amounts of text.</p><div class="wp_syntax"><div class="code"><pre class="csharp" style="font-family: monospace;">Document document <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> Document<span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
document<span style="color: #008000;">.</span><span style="color: #0000FF;">Info</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Author</span> <span style="color: #008000;">=</span> <span style="color: #666666;">"Rolf Baxter"</span><span style="color: #008000;">;</span>
document<span style="color: #008000;">.</span><span style="color: #0000FF;">Info</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Keywords</span> <span style="color: #008000;">=</span> <span style="color: #666666;">"MigraDoc, Examples, C#"</span><span style="color: #008000;">;</span>
&nbsp;
<span style="color: #008080; font-style: italic;">// Get the A4 page size</span>
Unit width, height<span style="color: #008000;">;</span>
PageSetup<span style="color: #008000;">.</span><span style="color: #0000FF;">GetPageSize</span><span style="color: #008000;">(</span>PageFormat<span style="color: #008000;">.</span><span style="color: #0000FF;">A4</span>, <span style="color: #0600FF; font-weight: bold;">out</span> width, <span style="color: #0600FF; font-weight: bold;">out</span> height<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
<span style="color: #008080; font-style: italic;">// Add a section to the document and configure it such that it will be in the centre</span>
<span style="color: #008080; font-style: italic;">// of the page</span>
Section section <span style="color: #008000;">=</span> document<span style="color: #008000;">.</span><span style="color: #0000FF;">AddSection</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
section<span style="color: #008000;">.</span><span style="color: #0000FF;">PageSetup</span><span style="color: #008000;">.</span><span style="color: #0000FF;">PageHeight</span> <span style="color: #008000;">=</span> height<span style="color: #008000;">;</span>
section<span style="color: #008000;">.</span><span style="color: #0000FF;">PageSetup</span><span style="color: #008000;">.</span><span style="color: #0000FF;">PageWidth</span> <span style="color: #008000;">=</span> width<span style="color: #008000;">;</span>
section<span style="color: #008000;">.</span><span style="color: #0000FF;">PageSetup</span><span style="color: #008000;">.</span><span style="color: #0000FF;">LeftMargin</span> <span style="color: #008000;">=</span> <span style="color: #FF0000;">0</span><span style="color: #008000;">;</span>
section<span style="color: #008000;">.</span><span style="color: #0000FF;">PageSetup</span><span style="color: #008000;">.</span><span style="color: #0000FF;">RightMargin</span> <span style="color: #008000;">=</span> <span style="color: #FF0000;">0</span><span style="color: #008000;">;</span>
section<span style="color: #008000;">.</span><span style="color: #0000FF;">PageSetup</span><span style="color: #008000;">.</span><span style="color: #0000FF;">TopMargin</span> <span style="color: #008000;">=</span> height<span style="color: #008000;">/</span><span style="color: #FF0000;">2</span><span style="color: #008000;">;</span> 
&nbsp;
<span style="color: #008080; font-style: italic;">// Create a table so that we can draw the horizontal lines</span>
Table table <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> Table<span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
table<span style="color: #008000;">.</span><span style="color: #0000FF;">Borders</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Width</span> <span style="color: #008000;">=</span> <span style="color: #FF0000;">1</span><span style="color: #008000;">;</span> <span style="color: #008080; font-style: italic;">// Default to show borders 1 pixel wide Column</span>
column <span style="color: #008000;">=</span> table<span style="color: #008000;">.</span><span style="color: #0000FF;">AddColumn</span><span style="color: #008000;">(</span>width<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
column<span style="color: #008000;">.</span><span style="color: #0000FF;">Format</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Alignment</span> <span style="color: #008000;">=</span> ParagraphAlignment<span style="color: #008000;">.</span><span style="color: #0000FF;">Center</span><span style="color: #008000;">;</span>
&nbsp;
<span style="color: #6666cc; font-weight: bold;">double</span> fontHeight <span style="color: #008000;">=</span> <span style="color: #FF0000;">36</span><span style="color: #008000;">;</span>
Font font <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> Font<span style="color: #008000;">(</span><span style="color: #666666;">"Times New Roman"</span>, fontHeight<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
<span style="color: #008080; font-style: italic;">// Add a row with a single cell for the first line</span>
Row row <span style="color: #008000;">=</span> table<span style="color: #008000;">.</span><span style="color: #0000FF;">AddRow</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
Cell cell <span style="color: #008000;">=</span> row<span style="color: #008000;">.</span><span style="color: #0000FF;">Cells</span><span style="color: #008000;">[</span><span style="color: #FF0000;">0</span><span style="color: #008000;">]</span><span style="color: #008000;">;</span>
&nbsp;
cell<span style="color: #008000;">.</span><span style="color: #0000FF;">Format</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Font</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Color</span> <span style="color: #008000;">=</span> Colors<span style="color: #008000;">.</span><span style="color: #0000FF;">Black</span><span style="color: #008000;">;</span>
cell<span style="color: #008000;">.</span><span style="color: #0000FF;">Format</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Font</span><span style="color: #008000;">.</span><span style="color: #0000FF;">ApplyFont</span><span style="color: #008000;">(</span>font<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
cell<span style="color: #008000;">.</span><span style="color: #0000FF;">Borders</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Left</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Visible</span> <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">false</span><span style="color: #008000;">;</span>
cell<span style="color: #008000;">.</span><span style="color: #0000FF;">Borders</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Right</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Visible</span> <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">false</span><span style="color: #008000;">;</span>
cell<span style="color: #008000;">.</span><span style="color: #0000FF;">Borders</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Bottom</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Visible</span> <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">false</span><span style="color: #008000;">;</span>
&nbsp;
cell<span style="color: #008000;">.</span><span style="color: #0000FF;">AddParagraph</span><span style="color: #008000;">(</span><span style="color: #666666;">"Hello, World!"</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
<span style="color: #008080; font-style: italic;">// Add a row with a single cell for the second line</span>
row <span style="color: #008000;">=</span> table<span style="color: #008000;">.</span><span style="color: #0000FF;">AddRow</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
cell <span style="color: #008000;">=</span> row<span style="color: #008000;">.</span><span style="color: #0000FF;">Cells</span><span style="color: #008000;">[</span><span style="color: #FF0000;">0</span><span style="color: #008000;">]</span><span style="color: #008000;">;</span>
&nbsp;
cell<span style="color: #008000;">.</span><span style="color: #0000FF;">Format</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Font</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Color</span> <span style="color: #008000;">=</span> Colors<span style="color: #008000;">.</span><span style="color: #0000FF;">Black</span><span style="color: #008000;">;</span>
cell<span style="color: #008000;">.</span><span style="color: #0000FF;">Format</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Alignment</span> <span style="color: #008000;">=</span> ParagraphAlignment<span style="color: #008000;">.</span><span style="color: #0000FF;">Left</span><span style="color: #008000;">;</span>
cell<span style="color: #008000;">.</span><span style="color: #0000FF;">Format</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Font</span><span style="color: #008000;">.</span><span style="color: #0000FF;">ApplyFont</span><span style="color: #008000;">(</span>font<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
cell<span style="color: #008000;">.</span><span style="color: #0000FF;">Borders</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Left</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Visible</span> <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">false</span><span style="color: #008000;">;</span>
cell<span style="color: #008000;">.</span><span style="color: #0000FF;">Borders</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Right</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Visible</span> <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">false</span><span style="color: #008000;">;</span>
cell<span style="color: #008000;">.</span><span style="color: #0000FF;">Borders</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Top</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Visible</span> <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">false</span><span style="color: #008000;">;</span>
&nbsp;
cell<span style="color: #008000;">.</span><span style="color: #0000FF;">AddParagraph</span><span style="color: #008000;">(</span><span style="color: #666666;">"This is some long text that *will* auto-wrap when the
                   edge of the page is reached"</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
document<span style="color: #008000;">.</span><span style="color: #0000FF;">LastSection</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Add</span><span style="color: #008000;">(</span>table<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
<span style="color: #008080; font-style: italic;">// Create a renderer</span>
PdfDocumentRenderer pdfRenderer <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> PdfDocumentRenderer<span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
<span style="color: #008080; font-style: italic;">// Associate the MigraDoc document with a renderer</span>
pdfRenderer<span style="color: #008000;">.</span><span style="color: #0000FF;">Document</span> <span style="color: #008000;">=</span> document<span style="color: #008000;">;</span>
&nbsp;
<span style="color: #008080; font-style: italic;">// Layout and render document to PDF</span>
pdfRenderer<span style="color: #008000;">.</span><span style="color: #0000FF;">RenderDocument</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
<span style="color: #008080; font-style: italic;">// Save and show the document</span>
pdfRenderer<span style="color: #008000;">.</span><span style="color: #0000FF;">PdfDocument</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Save</span>
&nbsp;
<span style="color: #008000;">(</span><span style="color: #666666;">"TestDocument.pdf"</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
Process<span style="color: #008000;">.</span><span style="color: #0000FF;">Start</span><span style="color: #008000;">(</span><span style="color: #666666;">"TestDocument.pdf"</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span></pre></div></div><p>This produces the following output:</p><p><a href="http://www.scottlogic.co.uk/wp-content/uploads/2012/10/MigradocCapture2.png"><img class="size-full wp-image-160307 aligncenter" title="Migradoc example document" src="http://www.scottlogic.co.uk/wp-content/uploads/2012/10/MigradocCapture2.png" alt="" width="238" height="329" /></a></p><p style="text-align: justify;">One can clearly see that the best library to use will depend on the output you wish to produce. However, do keep in mind that mixing both libraries is also possible (see the PdfSharp Samples project or <a href="http://www.pdfsharp.com/PDFsharp/index.php?option=com_content&amp;task=view&amp;id=34&amp;Itemid=45">here</a> for an example).</p><h3>Document Printing</h3><p style="text-align: justify;">As mentioned previously, my interest in PdfSharp stemmed from a desire to export a DataGridView via both PDF and printing.&nbsp; Correspondingly, part of my investigation focused on the printing aspects of PdfSharp, for which I identified two options.&nbsp; The first approach I considered was the PdfFilePrinter component of the PdfSharp library, which uses the Adobe Acrobat reader to print a document.&nbsp; This approach is particularly neat and simple, as demonstrated by the following example:</p><div class="wp_syntax"><div class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #008080; font-style: italic;">// Define or otherwise determine the path of the Adobe reader</span>
PdfFilePrinter<span style="color: #008000;">.</span><span style="color: #0000FF;">AdobeReaderPath</span> <span style="color: #008000;">=</span> <span style="color: #666666;">@"C:\Program Files\Adobe\Reader 9.0\Reader\AcroRd32.exe"</span><span style="color: #008000;">;</span>
&nbsp;
<span style="color: #008080; font-style: italic;">// Present a Printer settings dialog to the user so that they may select the printer</span>
<span style="color: #008080; font-style: italic;">// to use.</span>
PrinterSettings settings <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> PrinterSettings<span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
settings<span style="color: #008000;">.</span><span style="color: #0000FF;">Collate</span> <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">false</span><span style="color: #008000;">;</span>
PrintDialog printerDialog <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> PrintDialog<span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
printerDialog<span style="color: #008000;">.</span><span style="color: #0000FF;">AllowSomePages</span> <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">false</span><span style="color: #008000;">;</span>
printerDialog<span style="color: #008000;">.</span><span style="color: #0000FF;">ShowHelp</span> <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">false</span><span style="color: #008000;">;</span>
printerDialog<span style="color: #008000;">.</span><span style="color: #0000FF;">PrinterSettings</span> <span style="color: #008000;">=</span> settings<span style="color: #008000;">;</span>
printerDialog<span style="color: #008000;">.</span><span style="color: #0000FF;">AllowPrintToFile</span> <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">;</span>
printerDialog<span style="color: #008000;">.</span><span style="color: #0000FF;">PrinterSettings</span><span style="color: #008000;">.</span><span style="color: #0000FF;">PrintToFile</span> <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">;</span>
DialogResult result <span style="color: #008000;">=</span> printerDialog<span style="color: #008000;">.</span><span style="color: #0000FF;">ShowDialog</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">(</span>result <span style="color: #008000;">==</span> DialogResult<span style="color: #008000;">.</span><span style="color: #0000FF;">OK</span><span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
   <span style="color: #008080; font-style: italic;">// Print the document on the selected printer (We are ignoring all other print</span>
   <span style="color: #008080; font-style: italic;">// options here</span>
   PdfFilePrinter printer <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> PdfFilePrinter<span style="color: #008000;">(</span><span style="color: #666666;">"HelloWorld.pdf"</span>, settings<span style="color: #008000;">.</span><span style="color: #0000FF;">PrinterName</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
   <span style="color: #0600FF; font-weight: bold;">try</span>
   <span style="color: #008000;">{</span>
      printer<span style="color: #008000;">.</span><span style="color: #0000FF;">Print</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
   <span style="color: #008000;">}</span>
   <span style="color: #0600FF; font-weight: bold;">catch</span> <span style="color: #008000;">(</span>Exception ex<span style="color: #008000;">)</span>
   <span style="color: #008000;">{</span>
      Console<span style="color: #008000;">.</span><span style="color: #0000FF;">WriteLine</span><span style="color: #008000;">(</span><span style="color: #666666;">"Error: "</span> <span style="color: #008000;">+</span> ex<span style="color: #008000;">.</span><span style="color: #0000FF;">Message</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
   <span style="color: #008000;">}</span>
<span style="color: #008000;">}</span></pre></div></div><p style="text-align: justify;">In this example we present a printer dialog to the user so that they may select the printing device to use, and then use the PdfFilePrinter to print the document on their chosen printer.&nbsp; When printing in this way the PdfFilePrinter invokes the Adobe Acrobat reader, but unfortunately this also has the side effect of opening the PDF file in an Adobe window while printing.</p><p style="text-align: justify;">I was unhappy with this side-effect and looked inside the PdfFilePrinter class to see if the operation could be tweaked.&nbsp; I identified a number of flags that could be passed to Adobe Reader to request<br />
that it hide its window while printing, although experimenting with these flags did not yield a better experience. I don’t believe I ever succeeded in getting Adobe to respond to all of the parameters specified.</p><p style="text-align: justify;">Unsatisfied with the above approach I investigated further options for PDF printing.&nbsp; The next technique actually comes from within the Migradoc library&nbsp;(MigraDoc.Rendering.Printing.MigraDocPrintDocument ) itself and is the approach I recommend.&nbsp; The class provides a simplified printing process for MigraDoc documents and fundamentally, it integrates with the .NET framework’s printing provisions, rendering the PDF one page at a time on a Graphics object. This is possible because PdfSharp has a particularly useful feature: the ability to wrap a GDI+ Graphics object (as used by the .NET framework).&nbsp; This means that you can render PDF components to a PDF file, a printer or even to the screen (e.g. to create a ‘preview’).&nbsp; This is a great<br />
little feature, and incidentally, is not one that is present in iTextSharp.</p><p style="text-align: justify;">There are two steps to printing a PDF document using this approach.&nbsp; The first step is to obtain the target printer settings.&nbsp; This can be done using a PrintDialog as shown previously. However, the key difference from the previous approach is that we now utilise a PrintDocument object rather than a PdfFilePrinter.&nbsp; This is shown in the example below:</p><div class="wp_syntax"><div class="code"><pre class="csharp" style="font-family: monospace;">PrintDialog printerDialog <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> PrintDialog<span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
printerDialog<span style="color: #008000;">.</span><span style="color: #0000FF;">AllowSomePages</span> <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">;</span>
printerDialog<span style="color: #008000;">.</span><span style="color: #0000FF;">ShowHelp</span> <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">false</span><span style="color: #008000;">;</span>
printerDialog<span style="color: #008000;">.</span><span style="color: #0000FF;">PrinterSettings</span> <span style="color: #008000;">=</span> settings<span style="color: #008000;">;</span>
printerDialog<span style="color: #008000;">.</span><span style="color: #0000FF;">AllowPrintToFile</span> <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">;</span>
printerDialog<span style="color: #008000;">.</span><span style="color: #0000FF;">PrinterSettings</span><span style="color: #008000;">.</span><span style="color: #0000FF;">PrintToFile</span> <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">;</span>
&nbsp;
DialogResult result <span style="color: #008000;">=</span> printerDialog<span style="color: #008000;">.</span><span style="color: #0000FF;">ShowDialog</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
<span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">(</span>result <span style="color: #008000;">==</span> DialogResult<span style="color: #008000;">.</span><span style="color: #0000FF;">OK</span><span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
   var printDoc <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> PrintDocument<span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
   printDoc<span style="color: #008000;">.</span><span style="color: #0000FF;">PrintPage</span> <span style="color: #008000;">+=</span> printDoc_PrintPage<span style="color: #008000;">;</span>
   printDoc<span style="color: #008000;">.</span><span style="color: #0000FF;">PrinterSettings</span> <span style="color: #008000;">=</span> printerDialog<span style="color: #008000;">.</span><span style="color: #0000FF;">PrinterSettings</span><span style="color: #008000;">;</span>
   printDoc<span style="color: #008000;">.</span><span style="color: #0000FF;">Print</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
<span style="color: #008000;">}</span></pre></div></div><p style="text-align: justify;">Note that we subscribe to the PrintPage event just as we would if we were handling regular document printing.&nbsp; The code extract below shows that the PrintPage delegate is called with a set of System.Drawing.Printing.PrintPageEventArgs, from which a System.Drawing.Graphics objects can be extracted.</p><p style="text-align: justify;">The Graphics object must then be wrapped by an instance of Pdf Sharp’s XGraphics object.&nbsp; During this process we ensure that the graphics context is trimmed to adhere to any physical limitations of the printer, which can be determined by calling the Windows API function GetDeviceCaps. One can then render to the XGraphics object in the same way irrespective of whether the source is a PDF document, printer or screen.</p><p style="text-align: justify;">It is important to note that we set the ‘HasMorePages’ property of the PrintPageEventArgs before the method exits because this property it used to determine when printing is complete.&nbsp; The PrintPage event will continue to be raised until this property is set to false and thus it is essential that you can determine when your rendering process is complete.</p><div class="wp_syntax"><div class="code"><pre class="csharp" style="font-family: monospace;"><span style="color: #008000;">[</span>DllImport<span style="color: #008000;">(</span><span style="color: #666666;">"gdi32.dll"</span><span style="color: #008000;">)</span><span style="color: #008000;">]</span>
<span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #0600FF; font-weight: bold;">extern</span> <span style="color: #6666cc; font-weight: bold;">int</span> GetDeviceCaps<span style="color: #008000;">(</span>IntPtr hdc, <span style="color: #6666cc; font-weight: bold;">int</span> capability<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
<span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #0600FF; font-weight: bold;">const</span> <span style="color: #6666cc; font-weight: bold;">int</span> PHYSICALOFFSETX <span style="color: #008000;">=</span> <span style="color: #FF0000;">112</span><span style="color: #008000;">;</span> <span style="color: #008080; font-style: italic;">// Physical Printable Area x margin</span>
<span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #0600FF; font-weight: bold;">const</span> <span style="color: #6666cc; font-weight: bold;">int</span> PHYSICALOFFSETY <span style="color: #008000;">=</span> <span style="color: #FF0000;">113</span><span style="color: #008000;">;</span> <span style="color: #008080; font-style: italic;">// Physical Printable Area y margin</span>
<span style="color: #008000;">.</span>
<span style="color: #008000;">.</span>
<span style="color: #008000;">.</span>
<span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #6666cc; font-weight: bold;">void</span> printDoc_PrintPage<span style="color: #008000;">(</span><span style="color: #6666cc; font-weight: bold;">object</span> sender, PrintPageEventArgs e<span style="color: #008000;">)</span>
<span style="color: #008000;">{</span>
   <span style="color: #008080; font-style: italic;">// Get an XGraphics object for the page</span>
   Graphics graphics <span style="color: #008000;">=</span> e<span style="color: #008000;">.</span><span style="color: #0000FF;">Graphics</span><span style="color: #008000;">;</span>
   IntPtr hdc <span style="color: #008000;">=</span> graphics<span style="color: #008000;">.</span><span style="color: #0000FF;">GetHdc</span><span style="color: #008000;">(</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
   <span style="color: #6666cc; font-weight: bold;">int</span> xOffset <span style="color: #008000;">=</span> GetDeviceCaps<span style="color: #008000;">(</span>hdc, PHYSICALOFFSETX<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
   <span style="color: #6666cc; font-weight: bold;">int</span> yOffset <span style="color: #008000;">=</span> GetDeviceCaps<span style="color: #008000;">(</span>hdc, PHYSICALOFFSETY<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
   graphics<span style="color: #008000;">.</span><span style="color: #0000FF;">ReleaseHdc</span><span style="color: #008000;">(</span>hdc<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
   <span style="color: #6666cc; font-weight: bold;">float</span> hardMarginX <span style="color: #008000;">=</span> xOffset <span style="color: #008000;">*</span> <span style="color: #FF0000;">100</span> <span style="color: #008000;">/</span> graphics<span style="color: #008000;">.</span><span style="color: #0000FF;">DpiX</span><span style="color: #008000;">;</span>
   <span style="color: #6666cc; font-weight: bold;">float</span> hardMarginY <span style="color: #008000;">=</span> yOffset <span style="color: #008000;">*</span> <span style="color: #FF0000;">100</span> <span style="color: #008000;">/</span> graphics<span style="color: #008000;">.</span><span style="color: #0000FF;">DpiY</span><span style="color: #008000;">;</span>
   graphics<span style="color: #008000;">.</span><span style="color: #0000FF;">TranslateTransform</span><span style="color: #008000;">(</span><span style="color: #008000;">-</span>hardMarginX, <span style="color: #008000;">-</span>hardMarginY<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
   <span style="color: #008080; font-style: italic;">// Recall: Width and Height are exchanged when settings.Landscape is true.</span>
   XSize pageSize <span style="color: #008000;">=</span> <span style="color: #008000;">new</span> XSize<span style="color: #008000;">(</span>e<span style="color: #008000;">.</span><span style="color: #0000FF;">PageSettings</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Bounds</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Width</span> <span style="color: #008000;">/</span> <span style="color: #FF0000;">100.0</span> <span style="color: #008000;">*</span> <span style="color: #FF0000;">72</span>,
                              e<span style="color: #008000;">.</span><span style="color: #0000FF;">PageSettings</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Bounds</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Height</span> <span style="color: #008000;">/</span> <span style="color: #FF0000;">100.0</span> <span style="color: #008000;">*</span> <span style="color: #FF0000;">72</span><span style="color: #008000;">)</span><span style="color: #008000;">;</span>
   <span style="color: #6666cc; font-weight: bold;">float</span> scale <span style="color: #008000;">=</span> 100f <span style="color: #008000;">/</span> 72f<span style="color: #008000;">;</span> <span style="color: #008080; font-style: italic;">// Taken from the MigraDoc/PdfSharp documentation</span>
   graphics<span style="color: #008000;">.</span><span style="color: #0000FF;">ScaleTransform</span><span style="color: #008000;">(</span>scale, scale<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
&nbsp;
   XGraphics gfx <span style="color: #008000;">=</span> XGraphics<span style="color: #008000;">.</span><span style="color: #0000FF;">FromGraphics</span><span style="color: #008000;">(</span>graphics, pageSize<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
   e<span style="color: #008000;">.</span><span style="color: #0000FF;">HasMorePages</span> <span style="color: #008000;">=</span> Render<span style="color: #008000;">(</span>gfx<span style="color: #008000;">)</span><span style="color: #008000;">;</span>
<span style="color: #008000;">}</span></pre></div></div><h3>Limitations</h3><p style="text-align: justify;">Although my experimentation with these libraries has not been exhaustive one problem I did encounter was the integration of Migradoc and PdfSharp. As mentioned earlier, the two libraries can be jointly employed to render a single document, however, there seems to be some incompatibility between each library’s core document object which means some components of Migradoc cannot be used under some conditions.</p><p style="text-align: justify;">For example, I wanted to use PdfSharp to construct a document and to then use the document preview User Control provided by Migradoc. When rendering a document with PdfSharp a PdfSharp.PdfDocument.PdfDocument object is used, however, MiigraDoc uses the Migradoc.DocumentObjectModel.Document object and the preview control requires such a document. Because PdfSharp does not use a document object model (you can render anything anywhere), there is no way of converting from one document type to another and thus one cannot utilise the Migradoc preview control in this way. In this scenario I do not believe there is any reason for requiring a document object model for rendering a preview, and I suspect that there are other components of Migradoc that cannot be used for similar reasons. Either way, anybody intending to mix the two libraries should keep in mind that such problems do arise, and thus one cannot assume that the two libraries can be fully integrated.</p><h3>Closing Remarks</h3><p style="text-align: justify;">Drawing this post to a close I want to reiterate that my experiences with PdfSharp and Migradoc have been largely positive. I would not hesitate to use them again in the future and I would encourage their use by any developer requiring .NET PDF export functionality. Without performing a side-by-side comparison of PdfSharp and Migradoc with other solutions (e.g. iTextSharp) I cannot comment on their relative merits, however, I will say that one should not be put off by the fact that PdfSharp and Migradoc are free. My experience with these libraries has shown them to be very well written and documented and I expect that very little would be gained by opting for a commercially licensed solution.</p></div>